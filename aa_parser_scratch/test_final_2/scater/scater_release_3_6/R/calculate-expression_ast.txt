<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
<exprlist>
  <COMMENT line1="1" col1="1" line2="1" col2="71" start="87" end="157">## A set of functions for calculating and summarising expression values</COMMENT>
  <COMMENT line1="4" col1="1" line2="4" col2="77" start="345" end="421">#' Calculate which features are expressed in which cells using a threshold on</COMMENT>
  <COMMENT line1="5" col1="1" line2="5" col2="73" start="431" end="503">#' observed counts, transcripts-per-million, counts-per-million, FPKM, or</COMMENT>
  <COMMENT line1="6" col1="1" line2="6" col2="29" start="517" end="545">#' defined expression levels.</COMMENT>
  <COMMENT line1="7" col1="1" line2="7" col2="2" start="603" end="604">#'</COMMENT>
  <COMMENT line1="8" col1="1" line2="8" col2="77" start="689" end="765">#' @param object a \code{\link{SingleCellExperiment}} object with expression </COMMENT>
  <COMMENT line1="9" col1="1" line2="9" col2="21" start="775" end="795">#' and/or count data.</COMMENT>
  <COMMENT line1="10" col1="1" line2="10" col2="80" start="861" end="940">#' @param lowerDetectionLimit numeric scalar giving the minimum expression level</COMMENT>
  <COMMENT line1="11" col1="1" line2="11" col2="74" start="947" end="1020">#' for an expression observation in a cell for it to qualify as expressed.</COMMENT>
  <COMMENT line1="12" col1="1" line2="12" col2="73" start="1033" end="1105">#' @param exprs_values character scalar indicating whether the count data</COMMENT>
  <COMMENT line1="13" col1="1" line2="13" col2="74" start="1119" end="1192">#' (\code{"counts"}), the log-transformed count data (\code{"logcounts"}),</COMMENT>
  <COMMENT line1="14" col1="1" line2="14" col2="78" start="1205" end="1282">#' transcript-per-million (\code{"tpm"}), counts-per-million (\code{"cpm"}) or</COMMENT>
  <COMMENT line1="15" col1="1" line2="15" col2="79" start="1291" end="1369">#' FPKM (\code{"fpkm"}) should be used to define if an observation is expressed</COMMENT>
  <COMMENT line1="16" col1="1" line2="16" col2="72" start="1377" end="1448">#' or not. Defaults to the first available value of those options in the</COMMENT>
  <COMMENT line1="17" col1="1" line2="17" col2="15" start="1463" end="1477">#' order shown.</COMMENT>
  <COMMENT line1="18" col1="1" line2="18" col2="79" start="1549" end="1627">#' @return a logical matrix indicating whether or not a feature in a particular</COMMENT>
  <COMMENT line1="19" col1="1" line2="19" col2="21" start="1635" end="1655">#' cell is expressed.</COMMENT>
  <COMMENT line1="20" col1="1" line2="20" col2="3" start="1721" end="1723">#' </COMMENT>
  <COMMENT line1="21" col1="1" line2="21" col2="10" start="1807" end="1816">#' @export</COMMENT>
  <COMMENT line1="22" col1="1" line2="22" col2="12" start="1893" end="1904">#' @examples</COMMENT>
  <COMMENT line1="23" col1="1" line2="23" col2="28" start="1979" end="2006">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="24" col1="1" line2="24" col2="31" start="2065" end="2095">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="25" col1="1" line2="25" col2="39" start="2151" end="2189">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="26" col1="1" line2="26" col2="77" start="2237" end="2313">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="27" col1="1" line2="27" col2="62" start="2323" end="2384">#' assay(example_sce, "is_exprs") &lt;- calcIsExprs(example_sce, </COMMENT>
  <COMMENT line1="28" col1="1" line2="28" col2="52" start="2409" end="2460">#' lowerDetectionLimit = 1, exprs_values = "counts")</COMMENT>
  <expr line1="29" col1="1" line2="32" col2="1" start="2495" end="2753">
    <expr line1="29" col1="1" line2="29" col2="11" start="2495" end="2505">
      <SYMBOL line1="29" col1="1" line2="29" col2="11" start="2495" end="2505">calcIsExprs</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="29" col1="13" line2="29" col2="14" start="2507" end="2508">&lt;-</LEFT_ASSIGN>
    <expr line1="29" col1="16" line2="32" col2="1" start="2510" end="2753">
      <FUNCTION line1="29" col1="16" line2="29" col2="23" start="2510" end="2517">function</FUNCTION>
      <OP-LEFT-PAREN line1="29" col1="24" line2="29" col2="24" start="2518" end="2518">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="29" col1="25" line2="29" col2="30" start="2519" end="2524">object</SYMBOL_FORMALS>
      <OP-COMMA line1="29" col1="31" line2="29" col2="31" start="2525" end="2525">,</OP-COMMA>
      <SYMBOL_FORMALS line1="29" col1="33" line2="29" col2="51" start="2527" end="2545">lowerDetectionLimit</SYMBOL_FORMALS>
      <EQ_FORMALS line1="29" col1="53" line2="29" col2="53" start="2547" end="2547">=</EQ_FORMALS>
      <expr line1="29" col1="55" line2="29" col2="55" start="2549" end="2549">
        <NUM_CONST line1="29" col1="55" line2="29" col2="55" start="2549" end="2549">0</NUM_CONST>
      </expr>
      <OP-COMMA line1="29" col1="56" line2="29" col2="56" start="2550" end="2550">,</OP-COMMA>
      <SYMBOL_FORMALS line1="30" col1="25" line2="30" col2="36" start="2605" end="2616">exprs_values</SYMBOL_FORMALS>
      <EQ_FORMALS line1="30" col1="38" line2="30" col2="38" start="2618" end="2618">=</EQ_FORMALS>
      <expr line1="30" col1="40" line2="30" col2="47" start="2620" end="2627">
        <STR_CONST line1="30" col1="40" line2="30" col2="47" start="2620" end="2627">"counts"</STR_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="30" col1="48" line2="30" col2="48" start="2628" end="2628">)</OP-RIGHT-PAREN>
      <expr line1="30" col1="50" line2="32" col2="1" start="2630" end="2753">
        <OP-LEFT-BRACE line1="30" col1="50" line2="30" col2="50" start="2630" end="2630">{</OP-LEFT-BRACE>
        <expr line1="31" col1="5" line2="31" col2="57" start="2671" end="2723">
          <expr line1="31" col1="5" line2="31" col2="35" start="2671" end="2701">
            <expr line1="31" col1="5" line2="31" col2="9" start="2671" end="2675">
              <SYMBOL_FUNCTION_CALL line1="31" col1="5" line2="31" col2="9" start="2671" end="2675">assay</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="31" col1="10" line2="31" col2="10" start="2676" end="2676">(</OP-LEFT-PAREN>
            <expr line1="31" col1="11" line2="31" col2="16" start="2677" end="2682">
              <SYMBOL line1="31" col1="11" line2="31" col2="16" start="2677" end="2682">object</SYMBOL>
            </expr>
            <OP-COMMA line1="31" col1="17" line2="31" col2="17" start="2683" end="2683">,</OP-COMMA>
            <SYMBOL_SUB line1="31" col1="19" line2="31" col2="19" start="2685" end="2685">i</SYMBOL_SUB>
            <EQ_SUB line1="31" col1="21" line2="31" col2="21" start="2687" end="2687">=</EQ_SUB>
            <expr line1="31" col1="23" line2="31" col2="34" start="2689" end="2700">
              <SYMBOL line1="31" col1="23" line2="31" col2="34" start="2689" end="2700">exprs_values</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="31" col1="35" line2="31" col2="35" start="2701" end="2701">)</OP-RIGHT-PAREN>
          </expr>
          <GT line1="31" col1="37" line2="31" col2="37" start="2703" end="2703">&gt;</GT>
          <expr line1="31" col1="39" line2="31" col2="57" start="2705" end="2723">
            <SYMBOL line1="31" col1="39" line2="31" col2="57" start="2705" end="2723">lowerDetectionLimit</SYMBOL>
          </expr>
        </expr>
        <OP-RIGHT-BRACE line1="32" col1="1" line2="32" col2="1" start="2753" end="2753">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <COMMENT line1="34" col1="1" line2="34" col2="47" start="2925" end="2971">#' Count the number of expressed genes per cell</COMMENT>
  <COMMENT line1="35" col1="1" line2="35" col2="2" start="3011" end="3012">#'</COMMENT>
  <COMMENT line1="36" col1="1" line2="36" col2="2" start="3097" end="3098">#'</COMMENT>
  <COMMENT line1="37" col1="1" line2="37" col2="60" start="3183" end="3242">#' @param object a \code{\link{SingleCellExperiment}} object</COMMENT>
  <COMMENT line1="38" col1="1" line2="38" col2="77" start="3269" end="3345">#' @param lowerDetectionLimit numeric scalar providing the value above which </COMMENT>
  <COMMENT line1="39" col1="1" line2="39" col2="56" start="3355" end="3410">#' observations are deemed to be expressed. Defaults to </COMMENT>
  <COMMENT line1="40" col1="1" line2="40" col2="37" start="3441" end="3477">#' \code{object@lowerDetectionLimit}.</COMMENT>
  <COMMENT line1="41" col1="1" line2="41" col2="73" start="3527" end="3599">#' @param exprs_values character scalar indicating whether the count data</COMMENT>
  <COMMENT line1="42" col1="1" line2="42" col2="74" start="3613" end="3686">#' (\code{"counts"}), the log-transformed count data (\code{"logcounts"}),</COMMENT>
  <COMMENT line1="43" col1="1" line2="43" col2="78" start="3699" end="3776">#' transcript-per-million (\code{"tpm"}), counts-per-million (\code{"cpm"}) or</COMMENT>
  <COMMENT line1="44" col1="1" line2="44" col2="79" start="3785" end="3863">#' FPKM (\code{"fpkm"}) should be used to define if an observation is expressed</COMMENT>
  <COMMENT line1="45" col1="1" line2="45" col2="72" start="3871" end="3942">#' or not. Defaults to the first available value of those options in the</COMMENT>
  <COMMENT line1="46" col1="1" line2="46" col2="74" start="3957" end="4030">#' order shown. However, if \code{is_exprs(object)} is present, it will be</COMMENT>
  <COMMENT line1="47" col1="1" line2="47" col2="81" start="4043" end="4123">#' used directly; \code{exprs_values} and \code{lowerDetectionLimit} are ignored.</COMMENT>
  <COMMENT line1="48" col1="1" line2="48" col2="76" start="4129" end="4204">#' @param byrow logical scalar indicating if \code{TRUE} to count expressing</COMMENT>
  <COMMENT line1="49" col1="1" line2="49" col2="72" start="4215" end="4286">#' cells per feature (i.e. gene) and if \code{FALSE} to count expressing</COMMENT>
  <COMMENT line1="50" col1="1" line2="50" col2="34" start="4301" end="4334">#' features (i.e. genes) per cell.</COMMENT>
  <COMMENT line1="51" col1="1" line2="51" col2="78" start="4387" end="4464">#' @param subset_row logical, integeror character vector indicating which rows</COMMENT>
  <COMMENT line1="52" col1="1" line2="52" col2="72" start="4473" end="4544">#' (i.e. features/genes) to use when calculating the number of expressed</COMMENT>
  <COMMENT line1="53" col1="1" line2="53" col2="50" start="4559" end="4608">#' features in each cell, when \code{byrow=FALSE}.</COMMENT>
  <COMMENT line1="54" col1="1" line2="54" col2="82" start="4645" end="4726">#' @param subset_col logical, integer or character vector indicating which columns</COMMENT>
  <COMMENT line1="55" col1="1" line2="55" col2="77" start="4731" end="4807">#' (i.e., cells) to use to calculate the number of cells expressing each gene</COMMENT>
  <COMMENT line1="56" col1="1" line2="56" col2="26" start="4817" end="4842">#' when \code{byrow=TRUE}.</COMMENT>
  <COMMENT line1="57" col1="1" line2="57" col2="2" start="4903" end="4904">#'</COMMENT>
  <COMMENT line1="58" col1="1" line2="58" col2="80" start="4989" end="5068">#' @description An efficient internal function that avoids the need to construct</COMMENT>
  <COMMENT line1="59" col1="1" line2="59" col2="80" start="5075" end="5154">#' 'is_exprs_mat' by counting the number of expressed genes per cell on the fly.</COMMENT>
  <COMMENT line1="60" col1="1" line2="60" col2="2" start="5161" end="5162">#'</COMMENT>
  <COMMENT line1="61" col1="1" line2="61" col2="75" start="5247" end="5321">#' @return a numeric vector of the same length as the number of features if</COMMENT>
  <COMMENT line1="62" col1="1" line2="62" col2="76" start="5333" end="5408">#' \code{byrow} argument is \code{TRUE} and the same length as the number of</COMMENT>
  <COMMENT line1="63" col1="1" line2="63" col2="40" start="5419" end="5458">#' cells if \code{byrow} is \code{FALSE}</COMMENT>
  <COMMENT line1="64" col1="1" line2="64" col2="2" start="5505" end="5506">#'</COMMENT>
  <COMMENT line1="65" col1="1" line2="65" col2="31" start="5591" end="5621">#' @import SingleCellExperiment</COMMENT>
  <COMMENT line1="66" col1="1" line2="66" col2="10" start="5677" end="5686">#' @export</COMMENT>
  <COMMENT line1="67" col1="1" line2="67" col2="12" start="5763" end="5774">#' @examples</COMMENT>
  <COMMENT line1="68" col1="1" line2="68" col2="28" start="5849" end="5876">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="69" col1="1" line2="69" col2="31" start="5935" end="5965">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="70" col1="1" line2="70" col2="39" start="6021" end="6059">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="71" col1="1" line2="71" col2="77" start="6107" end="6183">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="72" col1="1" line2="72" col2="28" start="6193" end="6220">#' nexprs(example_sce)[1:10]</COMMENT>
  <COMMENT line1="73" col1="1" line2="73" col2="42" start="6279" end="6320">#' nexprs(example_sce, byrow = TRUE)[1:10]</COMMENT>
  <COMMENT line1="74" col1="1" line2="74" col2="2" start="6365" end="6366">#'</COMMENT>
  <expr line1="75" col1="1" line2="90" col2="1" start="6451" end="7741">
    <expr line1="75" col1="1" line2="75" col2="6" start="6451" end="6456">
      <SYMBOL line1="75" col1="1" line2="75" col2="6" start="6451" end="6456">nexprs</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="75" col1="8" line2="75" col2="9" start="6458" end="6459">&lt;-</LEFT_ASSIGN>
    <expr line1="75" col1="11" line2="90" col2="1" start="6461" end="7741">
      <FUNCTION line1="75" col1="11" line2="75" col2="18" start="6461" end="6468">function</FUNCTION>
      <OP-LEFT-PAREN line1="75" col1="19" line2="75" col2="19" start="6469" end="6469">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="75" col1="20" line2="75" col2="25" start="6470" end="6475">object</SYMBOL_FORMALS>
      <OP-COMMA line1="75" col1="26" line2="75" col2="26" start="6476" end="6476">,</OP-COMMA>
      <SYMBOL_FORMALS line1="75" col1="28" line2="75" col2="46" start="6478" end="6496">lowerDetectionLimit</SYMBOL_FORMALS>
      <EQ_FORMALS line1="75" col1="48" line2="75" col2="48" start="6498" end="6498">=</EQ_FORMALS>
      <expr line1="75" col1="50" line2="75" col2="50" start="6500" end="6500">
        <NUM_CONST line1="75" col1="50" line2="75" col2="50" start="6500" end="6500">0</NUM_CONST>
      </expr>
      <OP-COMMA line1="75" col1="51" line2="75" col2="51" start="6501" end="6501">,</OP-COMMA>
      <SYMBOL_FORMALS line1="75" col1="53" line2="75" col2="64" start="6503" end="6514">exprs_values</SYMBOL_FORMALS>
      <EQ_FORMALS line1="75" col1="66" line2="75" col2="66" start="6516" end="6516">=</EQ_FORMALS>
      <expr line1="75" col1="68" line2="75" col2="75" start="6518" end="6525">
        <STR_CONST line1="75" col1="68" line2="75" col2="75" start="6518" end="6525">"counts"</STR_CONST>
      </expr>
      <OP-COMMA line1="75" col1="76" line2="75" col2="76" start="6526" end="6526">,</OP-COMMA>
      <SYMBOL_FORMALS line1="76" col1="20" line2="76" col2="24" start="6556" end="6560">byrow</SYMBOL_FORMALS>
      <EQ_FORMALS line1="76" col1="26" line2="76" col2="26" start="6562" end="6562">=</EQ_FORMALS>
      <expr line1="76" col1="28" line2="76" col2="32" start="6564" end="6568">
        <NUM_CONST line1="76" col1="28" line2="76" col2="32" start="6564" end="6568">FALSE</NUM_CONST>
      </expr>
      <OP-COMMA line1="76" col1="33" line2="76" col2="33" start="6569" end="6569">,</OP-COMMA>
      <SYMBOL_FORMALS line1="76" col1="35" line2="76" col2="44" start="6571" end="6580">subset_row</SYMBOL_FORMALS>
      <EQ_FORMALS line1="76" col1="46" line2="76" col2="46" start="6582" end="6582">=</EQ_FORMALS>
      <expr line1="76" col1="48" line2="76" col2="51" start="6584" end="6587">
        <NULL_CONST line1="76" col1="48" line2="76" col2="51" start="6584" end="6587">NULL</NULL_CONST>
      </expr>
      <OP-COMMA line1="76" col1="52" line2="76" col2="52" start="6588" end="6588">,</OP-COMMA>
      <SYMBOL_FORMALS line1="76" col1="54" line2="76" col2="63" start="6590" end="6599">subset_col</SYMBOL_FORMALS>
      <EQ_FORMALS line1="76" col1="65" line2="76" col2="65" start="6601" end="6601">=</EQ_FORMALS>
      <expr line1="76" col1="67" line2="76" col2="70" start="6603" end="6606">
        <NULL_CONST line1="76" col1="67" line2="76" col2="70" start="6603" end="6606">NULL</NULL_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="76" col1="71" line2="76" col2="71" start="6607" end="6607">)</OP-RIGHT-PAREN>
      <expr line1="76" col1="73" line2="90" col2="1" start="6609" end="7741">
        <OP-LEFT-BRACE line1="76" col1="73" line2="76" col2="73" start="6609" end="6609">{</OP-LEFT-BRACE>
        <expr line1="77" col1="5" line2="77" col2="48" start="6627" end="6670">
          <expr line1="77" col1="5" line2="77" col2="13" start="6627" end="6635">
            <SYMBOL line1="77" col1="5" line2="77" col2="13" start="6627" end="6635">exprs_mat</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="77" col1="15" line2="77" col2="16" start="6637" end="6638">&lt;-</LEFT_ASSIGN>
          <expr line1="77" col1="18" line2="77" col2="48" start="6640" end="6670">
            <expr line1="77" col1="18" line2="77" col2="22" start="6640" end="6644">
              <SYMBOL_FUNCTION_CALL line1="77" col1="18" line2="77" col2="22" start="6640" end="6644">assay</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="77" col1="23" line2="77" col2="23" start="6645" end="6645">(</OP-LEFT-PAREN>
            <expr line1="77" col1="24" line2="77" col2="29" start="6646" end="6651">
              <SYMBOL line1="77" col1="24" line2="77" col2="29" start="6646" end="6651">object</SYMBOL>
            </expr>
            <OP-COMMA line1="77" col1="30" line2="77" col2="30" start="6652" end="6652">,</OP-COMMA>
            <SYMBOL_SUB line1="77" col1="32" line2="77" col2="32" start="6654" end="6654">i</SYMBOL_SUB>
            <EQ_SUB line1="77" col1="34" line2="77" col2="34" start="6656" end="6656">=</EQ_SUB>
            <expr line1="77" col1="36" line2="77" col2="47" start="6658" end="6669">
              <SYMBOL line1="77" col1="36" line2="77" col2="47" start="6658" end="6669">exprs_values</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="77" col1="48" line2="77" col2="48" start="6670" end="6670">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="78" col1="5" line2="78" col2="77" start="6713" end="6785">
          <expr line1="78" col1="5" line2="78" col2="14" start="6713" end="6722">
            <SYMBOL line1="78" col1="5" line2="78" col2="14" start="6713" end="6722">subset_row</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="78" col1="16" line2="78" col2="17" start="6724" end="6725">&lt;-</LEFT_ASSIGN>
          <expr line1="78" col1="19" line2="78" col2="77" start="6727" end="6785">
            <expr line1="78" col1="19" line2="78" col2="31" start="6727" end="6739">
              <SYMBOL_FUNCTION_CALL line1="78" col1="19" line2="78" col2="31" start="6727" end="6739">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="78" col1="32" line2="78" col2="32" start="6740" end="6740">(</OP-LEFT-PAREN>
            <expr line1="78" col1="33" line2="78" col2="42" start="6741" end="6750">
              <SYMBOL line1="78" col1="33" line2="78" col2="42" start="6741" end="6750">subset_row</SYMBOL>
            </expr>
            <OP-COMMA line1="78" col1="43" line2="78" col2="43" start="6751" end="6751">,</OP-COMMA>
            <SYMBOL_SUB line1="78" col1="45" line2="78" col2="50" start="6753" end="6758">target</SYMBOL_SUB>
            <EQ_SUB line1="78" col1="52" line2="78" col2="52" start="6760" end="6760">=</EQ_SUB>
            <expr line1="78" col1="54" line2="78" col2="62" start="6762" end="6770">
              <SYMBOL line1="78" col1="54" line2="78" col2="62" start="6762" end="6770">exprs_mat</SYMBOL>
            </expr>
            <OP-COMMA line1="78" col1="63" line2="78" col2="63" start="6771" end="6771">,</OP-COMMA>
            <SYMBOL_SUB line1="78" col1="65" line2="78" col2="69" start="6773" end="6777">byrow</SYMBOL_SUB>
            <EQ_SUB line1="78" col1="71" line2="78" col2="71" start="6779" end="6779">=</EQ_SUB>
            <expr line1="78" col1="73" line2="78" col2="76" start="6781" end="6784">
              <NUM_CONST line1="78" col1="73" line2="78" col2="76" start="6781" end="6784">TRUE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="78" col1="77" line2="78" col2="77" start="6785" end="6785">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="79" col1="5" line2="79" col2="78" start="6799" end="6872">
          <expr line1="79" col1="5" line2="79" col2="14" start="6799" end="6808">
            <SYMBOL line1="79" col1="5" line2="79" col2="14" start="6799" end="6808">subset_col</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="79" col1="16" line2="79" col2="17" start="6810" end="6811">&lt;-</LEFT_ASSIGN>
          <expr line1="79" col1="19" line2="79" col2="78" start="6813" end="6872">
            <expr line1="79" col1="19" line2="79" col2="31" start="6813" end="6825">
              <SYMBOL_FUNCTION_CALL line1="79" col1="19" line2="79" col2="31" start="6813" end="6825">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="79" col1="32" line2="79" col2="32" start="6826" end="6826">(</OP-LEFT-PAREN>
            <expr line1="79" col1="33" line2="79" col2="42" start="6827" end="6836">
              <SYMBOL line1="79" col1="33" line2="79" col2="42" start="6827" end="6836">subset_col</SYMBOL>
            </expr>
            <OP-COMMA line1="79" col1="43" line2="79" col2="43" start="6837" end="6837">,</OP-COMMA>
            <SYMBOL_SUB line1="79" col1="45" line2="79" col2="50" start="6839" end="6844">target</SYMBOL_SUB>
            <EQ_SUB line1="79" col1="52" line2="79" col2="52" start="6846" end="6846">=</EQ_SUB>
            <expr line1="79" col1="54" line2="79" col2="62" start="6848" end="6856">
              <SYMBOL line1="79" col1="54" line2="79" col2="62" start="6848" end="6856">exprs_mat</SYMBOL>
            </expr>
            <OP-COMMA line1="79" col1="63" line2="79" col2="63" start="6857" end="6857">,</OP-COMMA>
            <SYMBOL_SUB line1="79" col1="65" line2="79" col2="69" start="6859" end="6863">byrow</SYMBOL_SUB>
            <EQ_SUB line1="79" col1="71" line2="79" col2="71" start="6865" end="6865">=</EQ_SUB>
            <expr line1="79" col1="73" line2="79" col2="77" start="6867" end="6871">
              <NUM_CONST line1="79" col1="73" line2="79" col2="77" start="6867" end="6871">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="79" col1="78" line2="79" col2="78" start="6872" end="6872">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="81" col1="5" line2="89" col2="5" start="6971" end="7659">
          <IF line1="81" col1="5" line2="81" col2="6" start="6971" end="6972">if</IF>
          <OP-LEFT-PAREN line1="81" col1="8" line2="81" col2="8" start="6974" end="6974">(</OP-LEFT-PAREN>
          <expr line1="81" col1="9" line2="81" col2="14" start="6975" end="6980">
            <OP-EXCLAMATION line1="81" col1="9" line2="81" col2="9" start="6975" end="6975">!</OP-EXCLAMATION>
            <expr line1="81" col1="10" line2="81" col2="14" start="6976" end="6980">
              <SYMBOL line1="81" col1="10" line2="81" col2="14" start="6976" end="6980">byrow</SYMBOL>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="81" col1="15" line2="81" col2="15" start="6981" end="6981">)</OP-RIGHT-PAREN>
          <expr line1="81" col1="17" line2="85" col2="5" start="6983" end="7315">
            <OP-LEFT-BRACE line1="81" col1="17" line2="81" col2="17" start="6983" end="6983">{</OP-LEFT-BRACE>
            <expr line1="82" col1="9" line2="83" col2="39" start="7061" end="7177">
              <expr line1="82" col1="9" line2="82" col2="20" start="7061" end="7072">
                <SYMBOL line1="82" col1="9" line2="82" col2="20" start="7061" end="7072">margin.stats</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="82" col1="22" line2="82" col2="23" start="7074" end="7075">&lt;-</LEFT_ASSIGN>
              <expr line1="82" col1="25" line2="83" col2="39" start="7077" end="7177">
                <expr line1="82" col1="25" line2="82" col2="29" start="7077" end="7081">
                  <SYMBOL_FUNCTION_CALL line1="82" col1="25" line2="82" col2="29" start="7077" end="7081">.Call</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="82" col1="30" line2="82" col2="30" start="7082" end="7082">(</OP-LEFT-PAREN>
                <expr line1="82" col1="31" line2="82" col2="48" start="7083" end="7100">
                  <SYMBOL line1="82" col1="31" line2="82" col2="48" start="7083" end="7100">cxx_margin_summary</SYMBOL>
                </expr>
                <OP-COMMA line1="82" col1="49" line2="82" col2="49" start="7101" end="7101">,</OP-COMMA>
                <expr line1="82" col1="51" line2="82" col2="59" start="7103" end="7111">
                  <SYMBOL line1="82" col1="51" line2="82" col2="59" start="7103" end="7111">exprs_mat</SYMBOL>
                </expr>
                <OP-COMMA line1="82" col1="60" line2="82" col2="60" start="7112" end="7112">,</OP-COMMA>
                <expr line1="82" col1="62" line2="82" col2="80" start="7114" end="7132">
                  <SYMBOL line1="82" col1="62" line2="82" col2="80" start="7114" end="7132">lowerDetectionLimit</SYMBOL>
                </expr>
                <OP-COMMA line1="82" col1="81" line2="82" col2="81" start="7133" end="7133">,</OP-COMMA>
                <expr line1="83" col1="17" line2="83" col2="31" start="7155" end="7169">
                  <expr line1="83" col1="17" line2="83" col2="26" start="7155" end="7164">
                    <SYMBOL line1="83" col1="17" line2="83" col2="26" start="7155" end="7164">subset_row</SYMBOL>
                  </expr>
                  <OP-MINUS line1="83" col1="28" line2="83" col2="28" start="7166" end="7166">-</OP-MINUS>
                  <expr line1="83" col1="30" line2="83" col2="31" start="7168" end="7169">
                    <NUM_CONST line1="83" col1="30" line2="83" col2="31" start="7168" end="7169">1L</NUM_CONST>
                  </expr>
                </expr>
                <OP-COMMA line1="83" col1="32" line2="83" col2="32" start="7170" end="7170">,</OP-COMMA>
                <expr line1="83" col1="34" line2="83" col2="38" start="7172" end="7176">
                  <NUM_CONST line1="83" col1="34" line2="83" col2="38" start="7172" end="7176">FALSE</NUM_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="83" col1="39" line2="83" col2="39" start="7177" end="7177">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <expr line1="84" col1="9" line2="84" col2="45" start="7233" end="7269">
              <expr line1="84" col1="9" line2="84" col2="14" start="7233" end="7238">
                <SYMBOL_FUNCTION_CALL line1="84" col1="9" line2="84" col2="14" start="7233" end="7238">return</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="84" col1="15" line2="84" col2="15" start="7239" end="7239">(</OP-LEFT-PAREN>
              <expr line1="84" col1="16" line2="84" col2="44" start="7240" end="7268">
                <expr line1="84" col1="16" line2="84" col2="32" start="7240" end="7256">
                  <expr line1="84" col1="16" line2="84" col2="27" start="7240" end="7251">
                    <SYMBOL line1="84" col1="16" line2="84" col2="27" start="7240" end="7251">margin.stats</SYMBOL>
                  </expr>
                  <LBB line1="84" col1="28" line2="84" col2="29" start="7252" end="7253">[[</LBB>
                  <expr line1="84" col1="30" line2="84" col2="30" start="7254" end="7254">
                    <NUM_CONST line1="84" col1="30" line2="84" col2="30" start="7254" end="7254">2</NUM_CONST>
                  </expr>
                  <OP-RIGHT-BRACKET line1="84" col1="31" line2="84" col2="31" start="7255" end="7255">]</OP-RIGHT-BRACKET>
                  <OP-RIGHT-BRACKET line1="84" col1="32" line2="84" col2="32" start="7256" end="7256">]</OP-RIGHT-BRACKET>
                </expr>
                <OP-LEFT-BRACKET line1="84" col1="33" line2="84" col2="33" start="7257" end="7257">[</OP-LEFT-BRACKET>
                <expr line1="84" col1="34" line2="84" col2="43" start="7258" end="7267">
                  <SYMBOL line1="84" col1="34" line2="84" col2="43" start="7258" end="7267">subset_col</SYMBOL>
                </expr>
                <OP-RIGHT-BRACKET line1="84" col1="44" line2="84" col2="44" start="7268" end="7268">]</OP-RIGHT-BRACKET>
              </expr>
              <OP-RIGHT-PAREN line1="84" col1="45" line2="84" col2="45" start="7269" end="7269">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-BRACE line1="85" col1="5" line2="85" col2="5" start="7315" end="7315">}</OP-RIGHT-BRACE>
          </expr>
          <ELSE line1="85" col1="7" line2="85" col2="10" start="7317" end="7320">else</ELSE>
          <expr line1="85" col1="12" line2="89" col2="5" start="7322" end="7659">
            <OP-LEFT-BRACE line1="85" col1="12" line2="85" col2="12" start="7322" end="7322">{</OP-LEFT-BRACE>
            <expr line1="86" col1="9" line2="87" col2="38" start="7405" end="7520">
              <expr line1="86" col1="9" line2="86" col2="20" start="7405" end="7416">
                <SYMBOL line1="86" col1="9" line2="86" col2="20" start="7405" end="7416">margin.stats</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="86" col1="22" line2="86" col2="23" start="7418" end="7419">&lt;-</LEFT_ASSIGN>
              <expr line1="86" col1="25" line2="87" col2="38" start="7421" end="7520">
                <expr line1="86" col1="25" line2="86" col2="29" start="7421" end="7425">
                  <SYMBOL_FUNCTION_CALL line1="86" col1="25" line2="86" col2="29" start="7421" end="7425">.Call</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="86" col1="30" line2="86" col2="30" start="7426" end="7426">(</OP-LEFT-PAREN>
                <expr line1="86" col1="31" line2="86" col2="48" start="7427" end="7444">
                  <SYMBOL line1="86" col1="31" line2="86" col2="48" start="7427" end="7444">cxx_margin_summary</SYMBOL>
                </expr>
                <OP-COMMA line1="86" col1="49" line2="86" col2="49" start="7445" end="7445">,</OP-COMMA>
                <expr line1="86" col1="51" line2="86" col2="59" start="7447" end="7455">
                  <SYMBOL line1="86" col1="51" line2="86" col2="59" start="7447" end="7455">exprs_mat</SYMBOL>
                </expr>
                <OP-COMMA line1="86" col1="60" line2="86" col2="60" start="7456" end="7456">,</OP-COMMA>
                <expr line1="86" col1="62" line2="86" col2="80" start="7458" end="7476">
                  <SYMBOL line1="86" col1="62" line2="86" col2="80" start="7458" end="7476">lowerDetectionLimit</SYMBOL>
                </expr>
                <OP-COMMA line1="86" col1="81" line2="86" col2="81" start="7477" end="7477">,</OP-COMMA>
                <expr line1="87" col1="17" line2="87" col2="31" start="7499" end="7513">
                  <expr line1="87" col1="17" line2="87" col2="26" start="7499" end="7508">
                    <SYMBOL line1="87" col1="17" line2="87" col2="26" start="7499" end="7508">subset_col</SYMBOL>
                  </expr>
                  <OP-MINUS line1="87" col1="28" line2="87" col2="28" start="7510" end="7510">-</OP-MINUS>
                  <expr line1="87" col1="30" line2="87" col2="31" start="7512" end="7513">
                    <NUM_CONST line1="87" col1="30" line2="87" col2="31" start="7512" end="7513">1L</NUM_CONST>
                  </expr>
                </expr>
                <OP-COMMA line1="87" col1="32" line2="87" col2="32" start="7514" end="7514">,</OP-COMMA>
                <expr line1="87" col1="34" line2="87" col2="37" start="7516" end="7519">
                  <NUM_CONST line1="87" col1="34" line2="87" col2="37" start="7516" end="7519">TRUE</NUM_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="87" col1="38" line2="87" col2="38" start="7520" end="7520">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <expr line1="88" col1="9" line2="88" col2="45" start="7577" end="7613">
              <expr line1="88" col1="9" line2="88" col2="14" start="7577" end="7582">
                <SYMBOL_FUNCTION_CALL line1="88" col1="9" line2="88" col2="14" start="7577" end="7582">return</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="88" col1="15" line2="88" col2="15" start="7583" end="7583">(</OP-LEFT-PAREN>
              <expr line1="88" col1="16" line2="88" col2="44" start="7584" end="7612">
                <expr line1="88" col1="16" line2="88" col2="32" start="7584" end="7600">
                  <expr line1="88" col1="16" line2="88" col2="27" start="7584" end="7595">
                    <SYMBOL line1="88" col1="16" line2="88" col2="27" start="7584" end="7595">margin.stats</SYMBOL>
                  </expr>
                  <LBB line1="88" col1="28" line2="88" col2="29" start="7596" end="7597">[[</LBB>
                  <expr line1="88" col1="30" line2="88" col2="30" start="7598" end="7598">
                    <NUM_CONST line1="88" col1="30" line2="88" col2="30" start="7598" end="7598">2</NUM_CONST>
                  </expr>
                  <OP-RIGHT-BRACKET line1="88" col1="31" line2="88" col2="31" start="7599" end="7599">]</OP-RIGHT-BRACKET>
                  <OP-RIGHT-BRACKET line1="88" col1="32" line2="88" col2="32" start="7600" end="7600">]</OP-RIGHT-BRACKET>
                </expr>
                <OP-LEFT-BRACKET line1="88" col1="33" line2="88" col2="33" start="7601" end="7601">[</OP-LEFT-BRACKET>
                <expr line1="88" col1="34" line2="88" col2="43" start="7602" end="7611">
                  <SYMBOL line1="88" col1="34" line2="88" col2="43" start="7602" end="7611">subset_row</SYMBOL>
                </expr>
                <OP-RIGHT-BRACKET line1="88" col1="44" line2="88" col2="44" start="7612" end="7612">]</OP-RIGHT-BRACKET>
              </expr>
              <OP-RIGHT-PAREN line1="88" col1="45" line2="88" col2="45" start="7613" end="7613">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-BRACE line1="89" col1="5" line2="89" col2="5" start="7659" end="7659">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <OP-RIGHT-BRACE line1="90" col1="1" line2="90" col2="1" start="7741" end="7741">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <COMMENT line1="92" col1="1" line2="92" col2="42" start="7913" end="7954">#' Calculate transcripts-per-million (TPM)</COMMENT>
  <COMMENT line1="93" col1="1" line2="93" col2="2" start="7999" end="8000">#'</COMMENT>
  <COMMENT line1="94" col1="1" line2="94" col2="80" start="8085" end="8164">#' Calculate transcripts-per-million (TPM) values for expression from counts for</COMMENT>
  <COMMENT line1="95" col1="1" line2="95" col2="21" start="8171" end="8191">#' a set of features.</COMMENT>
  <COMMENT line1="96" col1="1" line2="96" col2="2" start="8257" end="8258">#'</COMMENT>
  <COMMENT line1="97" col1="1" line2="97" col2="53" start="8343" end="8395">#' @param object a \code{SingleCellExperiment} object</COMMENT>
  <COMMENT line1="98" col1="1" line2="98" col2="73" start="8429" end="8501">#' @param effective_length vector of class \code{"numeric"} providing the</COMMENT>
  <COMMENT line1="99" col1="1" line2="99" col2="78" start="8515" end="8592">#' effective length for each feature in the \code{SingleCellExperiment} object</COMMENT>
  <COMMENT line1="100" col1="1" line2="100" col2="75" start="8601" end="8675">#' @param calc_from character string indicating whether to compute TPM from</COMMENT>
  <COMMENT line1="101" col1="1" line2="101" col2="57" start="8687" end="8743">#' \code{"counts"}, \code{"normcounts"} or \code{"fpkm"}.</COMMENT>
  <COMMENT line1="102" col1="1" line2="102" col2="79" start="8773" end="8851">#' Default is to use \code{"counts"}, in which case the \code{effective_length}</COMMENT>
  <COMMENT line1="103" col1="1" line2="103" col2="29" start="8859" end="8887">#' argument must be supplied.</COMMENT>
  <COMMENT line1="104" col1="1" line2="104" col2="2" start="8945" end="8946">#'</COMMENT>
  <COMMENT line1="105" col1="1" line2="105" col2="32" start="9031" end="9062">#' @return Matrix of TPM values.</COMMENT>
  <COMMENT line1="106" col1="1" line2="106" col2="10" start="9117" end="9126">#' @export</COMMENT>
  <COMMENT line1="107" col1="1" line2="107" col2="12" start="9203" end="9214">#' @examples</COMMENT>
  <COMMENT line1="108" col1="1" line2="108" col2="28" start="9289" end="9316">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="109" col1="1" line2="109" col2="31" start="9375" end="9405">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="110" col1="1" line2="110" col2="39" start="9461" end="9499">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="111" col1="1" line2="111" col2="77" start="9547" end="9623">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="112" col1="1" line2="112" col2="73" start="9633" end="9705">#' tpm(example_sce) &lt;- calculateTPM(example_sce, effective_length = 5e04,</COMMENT>
  <COMMENT line1="113" col1="1" line2="113" col2="28" start="9719" end="9746">#'     calc_from = "counts")</COMMENT>
  <COMMENT line1="114" col1="1" line2="114" col2="2" start="9805" end="9806">#'</COMMENT>
  <COMMENT line1="115" col1="1" line2="115" col2="25" start="9891" end="9915">#' ## calculate from FPKM</COMMENT>
  <COMMENT line1="116" col1="1" line2="116" col2="75" start="9977" end="10051">#' fpkm(example_sce) &lt;- calculateFPKM(example_sce, effective_length = 5e04,</COMMENT>
  <COMMENT line1="117" col1="1" line2="117" col2="28" start="10063" end="10090">#' use.size.factors = FALSE)</COMMENT>
  <COMMENT line1="118" col1="1" line2="118" col2="73" start="10149" end="10221">#' tpm(example_sce) &lt;- calculateTPM(example_sce, effective_length = 5e04,</COMMENT>
  <COMMENT line1="119" col1="1" line2="119" col2="58" start="10235" end="10292">#'                                     calc_from = "fpkm")</COMMENT>
  <expr line1="120" col1="1" line2="143" col2="1" start="10321" end="12299">
    <expr line1="120" col1="1" line2="120" col2="12" start="10321" end="10332">
      <SYMBOL line1="120" col1="1" line2="120" col2="12" start="10321" end="10332">calculateTPM</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="120" col1="14" line2="120" col2="15" start="10334" end="10335">&lt;-</LEFT_ASSIGN>
    <expr line1="120" col1="17" line2="143" col2="1" start="10337" end="12299">
      <FUNCTION line1="120" col1="17" line2="120" col2="24" start="10337" end="10344">function</FUNCTION>
      <OP-LEFT-PAREN line1="120" col1="25" line2="120" col2="25" start="10345" end="10345">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="120" col1="26" line2="120" col2="31" start="10346" end="10351">object</SYMBOL_FORMALS>
      <OP-COMMA line1="120" col1="32" line2="120" col2="32" start="10352" end="10352">,</OP-COMMA>
      <SYMBOL_FORMALS line1="120" col1="34" line2="120" col2="49" start="10354" end="10369">effective_length</SYMBOL_FORMALS>
      <EQ_FORMALS line1="120" col1="51" line2="120" col2="51" start="10371" end="10371">=</EQ_FORMALS>
      <expr line1="120" col1="53" line2="120" col2="56" start="10373" end="10376">
        <NULL_CONST line1="120" col1="53" line2="120" col2="56" start="10373" end="10376">NULL</NULL_CONST>
      </expr>
      <OP-COMMA line1="120" col1="57" line2="120" col2="57" start="10377" end="10377">,</OP-COMMA>
      <SYMBOL_FORMALS line1="121" col1="26" line2="121" col2="34" start="10432" end="10440">calc_from</SYMBOL_FORMALS>
      <EQ_FORMALS line1="121" col1="36" line2="121" col2="36" start="10442" end="10442">=</EQ_FORMALS>
      <expr line1="121" col1="38" line2="121" col2="45" start="10444" end="10451">
        <STR_CONST line1="121" col1="38" line2="121" col2="45" start="10444" end="10451">"counts"</STR_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="121" col1="46" line2="121" col2="46" start="10452" end="10452">)</OP-RIGHT-PAREN>
      <expr line1="121" col1="48" line2="143" col2="1" start="10454" end="12299">
        <OP-LEFT-BRACE line1="121" col1="48" line2="121" col2="48" start="10454" end="10454">{</OP-LEFT-BRACE>
        <expr line1="122" col1="5" line2="123" col2="54" start="10497" end="10632">
          <IF line1="122" col1="5" line2="122" col2="6" start="10497" end="10498">if</IF>
          <OP-LEFT-PAREN line1="122" col1="8" line2="122" col2="8" start="10500" end="10500">(</OP-LEFT-PAREN>
          <expr line1="122" col1="10" line2="122" col2="53" start="10502" end="10545">
            <OP-EXCLAMATION line1="122" col1="10" line2="122" col2="10" start="10502" end="10502">!</OP-EXCLAMATION>
            <expr line1="122" col1="11" line2="122" col2="53" start="10503" end="10545">
              <expr line1="122" col1="11" line2="122" col2="21" start="10503" end="10513">
                <SYMBOL_PACKAGE line1="122" col1="11" line2="122" col2="17" start="10503" end="10509">methods</SYMBOL_PACKAGE>
                <NS_GET line1="122" col1="18" line2="122" col2="19" start="10510" end="10511">::</NS_GET>
                <SYMBOL_FUNCTION_CALL line1="122" col1="20" line2="122" col2="21" start="10512" end="10513">is</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="122" col1="22" line2="122" col2="22" start="10514" end="10514">(</OP-LEFT-PAREN>
              <expr line1="122" col1="23" line2="122" col2="28" start="10515" end="10520">
                <SYMBOL line1="122" col1="23" line2="122" col2="28" start="10515" end="10520">object</SYMBOL>
              </expr>
              <OP-COMMA line1="122" col1="29" line2="122" col2="29" start="10521" end="10521">,</OP-COMMA>
              <expr line1="122" col1="31" line2="122" col2="52" start="10523" end="10544">
                <STR_CONST line1="122" col1="31" line2="122" col2="52" start="10523" end="10544">"SingleCellExperiment"</STR_CONST>
              </expr>
              <OP-RIGHT-PAREN line1="122" col1="53" line2="122" col2="53" start="10545" end="10545">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="122" col1="55" line2="122" col2="55" start="10547" end="10547">)</OP-RIGHT-PAREN>
          <expr line1="123" col1="9" line2="123" col2="54" start="10587" end="10632">
            <expr line1="123" col1="9" line2="123" col2="12" start="10587" end="10590">
              <SYMBOL_FUNCTION_CALL line1="123" col1="9" line2="123" col2="12" start="10587" end="10590">stop</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="123" col1="13" line2="123" col2="13" start="10591" end="10591">(</OP-LEFT-PAREN>
            <expr line1="123" col1="14" line2="123" col2="53" start="10592" end="10631">
              <STR_CONST line1="123" col1="14" line2="123" col2="53" start="10592" end="10631">"object must be an SingleCellExperiment"</STR_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="123" col1="54" line2="123" col2="54" start="10632" end="10632">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <COMMENT line1="124" col1="5" line2="124" col2="39" start="10669" end="10703">## Check that arguments are correct</COMMENT>
        <expr line1="125" col1="5" line2="126" col2="46" start="10755" end="10882">
          <expr line1="125" col1="5" line2="125" col2="13" start="10755" end="10763">
            <SYMBOL line1="125" col1="5" line2="125" col2="13" start="10755" end="10763">calc_from</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="125" col1="15" line2="125" col2="16" start="10765" end="10766">&lt;-</LEFT_ASSIGN>
          <expr line1="125" col1="18" line2="126" col2="46" start="10768" end="10882">
            <expr line1="125" col1="18" line2="125" col2="26" start="10768" end="10776">
              <SYMBOL_FUNCTION_CALL line1="125" col1="18" line2="125" col2="26" start="10768" end="10776">match.arg</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="125" col1="27" line2="125" col2="27" start="10777" end="10777">(</OP-LEFT-PAREN>
            <expr line1="125" col1="28" line2="125" col2="36" start="10778" end="10786">
              <SYMBOL line1="125" col1="28" line2="125" col2="36" start="10778" end="10786">calc_from</SYMBOL>
            </expr>
            <OP-COMMA line1="125" col1="37" line2="125" col2="37" start="10787" end="10787">,</OP-COMMA>
            <expr line1="125" col1="39" line2="125" col2="71" start="10789" end="10821">
              <expr line1="125" col1="39" line2="125" col2="39" start="10789" end="10789">
                <SYMBOL_FUNCTION_CALL line1="125" col1="39" line2="125" col2="39" start="10789" end="10789">c</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="125" col1="40" line2="125" col2="40" start="10790" end="10790">(</OP-LEFT-PAREN>
              <expr line1="125" col1="41" line2="125" col2="48" start="10791" end="10798">
                <STR_CONST line1="125" col1="41" line2="125" col2="48" start="10791" end="10798">"counts"</STR_CONST>
              </expr>
              <OP-COMMA line1="125" col1="49" line2="125" col2="49" start="10799" end="10799">,</OP-COMMA>
              <expr line1="125" col1="51" line2="125" col2="62" start="10801" end="10812">
                <STR_CONST line1="125" col1="51" line2="125" col2="62" start="10801" end="10812">"normcounts"</STR_CONST>
              </expr>
              <OP-COMMA line1="125" col1="63" line2="125" col2="63" start="10813" end="10813">,</OP-COMMA>
              <expr line1="125" col1="65" line2="125" col2="70" start="10815" end="10820">
                <STR_CONST line1="125" col1="65" line2="125" col2="70" start="10815" end="10820">"fpkm"</STR_CONST>
              </expr>
              <OP-RIGHT-PAREN line1="125" col1="71" line2="125" col2="71" start="10821" end="10821">)</OP-RIGHT-PAREN>
            </expr>
            <OP-COMMA line1="125" col1="72" line2="125" col2="72" start="10822" end="10822">,</OP-COMMA>
            <SYMBOL_SUB line1="126" col1="28" line2="126" col2="37" start="10864" end="10873">several.ok</SYMBOL_SUB>
            <EQ_SUB line1="126" col1="39" line2="126" col2="39" start="10875" end="10875">=</EQ_SUB>
            <expr line1="126" col1="41" line2="126" col2="45" start="10877" end="10881">
              <NUM_CONST line1="126" col1="41" line2="126" col2="45" start="10877" end="10881">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="126" col1="46" line2="126" col2="46" start="10882" end="10882">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="127" col1="5" line2="131" col2="5" start="10927" end="11271">
          <IF line1="127" col1="5" line2="127" col2="6" start="10927" end="10928">if</IF>
          <OP-LEFT-PAREN line1="127" col1="8" line2="127" col2="8" start="10930" end="10930">(</OP-LEFT-PAREN>
          <expr line1="127" col1="10" line2="127" col2="59" start="10932" end="10981">
            <expr line1="127" col1="10" line2="127" col2="30" start="10932" end="10952">
              <expr line1="127" col1="10" line2="127" col2="18" start="10932" end="10940">
                <SYMBOL line1="127" col1="10" line2="127" col2="18" start="10932" end="10940">calc_from</SYMBOL>
              </expr>
              <EQ line1="127" col1="20" line2="127" col2="21" start="10942" end="10943">==</EQ>
              <expr line1="127" col1="23" line2="127" col2="30" start="10945" end="10952">
                <STR_CONST line1="127" col1="23" line2="127" col2="30" start="10945" end="10952">"counts"</STR_CONST>
              </expr>
            </expr>
            <OR2 line1="127" col1="32" line2="127" col2="33" start="10954" end="10955">||</OR2>
            <expr line1="127" col1="35" line2="127" col2="59" start="10957" end="10981">
              <expr line1="127" col1="35" line2="127" col2="43" start="10957" end="10965">
                <SYMBOL line1="127" col1="35" line2="127" col2="43" start="10957" end="10965">calc_from</SYMBOL>
              </expr>
              <EQ line1="127" col1="45" line2="127" col2="46" start="10967" end="10968">==</EQ>
              <expr line1="127" col1="48" line2="127" col2="59" start="10970" end="10981">
                <STR_CONST line1="127" col1="48" line2="127" col2="59" start="10970" end="10981">"normcounts"</STR_CONST>
              </expr>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="127" col1="61" line2="127" col2="61" start="10983" end="10983">)</OP-RIGHT-PAREN>
          <expr line1="127" col1="63" line2="131" col2="5" start="10985" end="11271">
            <OP-LEFT-BRACE line1="127" col1="63" line2="127" col2="63" start="10985" end="10985">{</OP-LEFT-BRACE>
            <expr line1="128" col1="9" line2="130" col2="34" start="11017" end="11214">
              <IF line1="128" col1="9" line2="128" col2="10" start="11017" end="11018">if</IF>
              <OP-LEFT-PAREN line1="128" col1="12" line2="128" col2="12" start="11020" end="11020">(</OP-LEFT-PAREN>
              <expr line1="128" col1="14" line2="128" col2="38" start="11022" end="11046">
                <expr line1="128" col1="14" line2="128" col2="20" start="11022" end="11028">
                  <SYMBOL_FUNCTION_CALL line1="128" col1="14" line2="128" col2="20" start="11022" end="11028">is.null</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="128" col1="21" line2="128" col2="21" start="11029" end="11029">(</OP-LEFT-PAREN>
                <expr line1="128" col1="22" line2="128" col2="37" start="11030" end="11045">
                  <SYMBOL line1="128" col1="22" line2="128" col2="37" start="11030" end="11045">effective_length</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="128" col1="38" line2="128" col2="38" start="11046" end="11046">)</OP-RIGHT-PAREN>
              </expr>
              <OP-RIGHT-PAREN line1="128" col1="40" line2="128" col2="40" start="11048" end="11048">)</OP-RIGHT-PAREN>
              <expr line1="129" col1="13" line2="130" col2="34" start="11107" end="11214">
                <expr line1="129" col1="13" line2="129" col2="16" start="11107" end="11110">
                  <SYMBOL_FUNCTION_CALL line1="129" col1="13" line2="129" col2="16" start="11107" end="11110">stop</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="129" col1="17" line2="129" col2="17" start="11111" end="11111">(</OP-LEFT-PAREN>
                <expr line1="129" col1="18" line2="130" col2="33" start="11112" end="11213">
                  <STR_CONST line1="129" col1="18" line2="130" col2="33" start="11112" end="11213">"effective_length argument is required if computing 
                 TPM from counts"</STR_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="130" col1="34" line2="130" col2="34" start="11214" end="11214">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="131" col1="5" line2="131" col2="5" start="11271" end="11271">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <COMMENT line1="132" col1="5" line2="132" col2="31" start="11357" end="11383">## Compute values to return</COMMENT>
        <expr line1="133" col1="5" line2="137" col2="57" start="11443" end="11839">
          <expr line1="133" col1="5" line2="133" col2="14" start="11443" end="11452">
            <SYMBOL line1="133" col1="5" line2="133" col2="14" start="11443" end="11452">tpm_to_add</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="133" col1="16" line2="133" col2="17" start="11454" end="11455">&lt;-</LEFT_ASSIGN>
          <expr line1="133" col1="19" line2="137" col2="57" start="11457" end="11839">
            <expr line1="133" col1="19" line2="133" col2="24" start="11457" end="11462">
              <SYMBOL_FUNCTION_CALL line1="133" col1="19" line2="133" col2="24" start="11457" end="11462">switch</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="133" col1="25" line2="133" col2="25" start="11463" end="11463">(</OP-LEFT-PAREN>
            <expr line1="133" col1="26" line2="133" col2="34" start="11464" end="11472">
              <SYMBOL line1="133" col1="26" line2="133" col2="34" start="11464" end="11472">calc_from</SYMBOL>
            </expr>
            <OP-COMMA line1="133" col1="35" line2="133" col2="35" start="11473" end="11473">,</OP-COMMA>
            <SYMBOL_SUB line1="134" col1="26" line2="134" col2="31" start="11550" end="11555">counts</SYMBOL_SUB>
            <EQ_SUB line1="134" col1="33" line2="134" col2="33" start="11557" end="11557">=</EQ_SUB>
            <expr line1="134" col1="35" line2="134" col2="79" start="11559" end="11603">
              <expr line1="134" col1="35" line2="134" col2="45" start="11559" end="11569">
                <SYMBOL_FUNCTION_CALL line1="134" col1="35" line2="134" col2="45" start="11559" end="11569">.countToTpm</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="134" col1="46" line2="134" col2="46" start="11570" end="11570">(</OP-LEFT-PAREN>
              <expr line1="134" col1="47" line2="134" col2="60" start="11571" end="11584">
                <expr line1="134" col1="47" line2="134" col2="52" start="11571" end="11576">
                  <SYMBOL_FUNCTION_CALL line1="134" col1="47" line2="134" col2="52" start="11571" end="11576">counts</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="134" col1="53" line2="134" col2="53" start="11577" end="11577">(</OP-LEFT-PAREN>
                <expr line1="134" col1="54" line2="134" col2="59" start="11578" end="11583">
                  <SYMBOL line1="134" col1="54" line2="134" col2="59" start="11578" end="11583">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="134" col1="60" line2="134" col2="60" start="11584" end="11584">)</OP-RIGHT-PAREN>
              </expr>
              <OP-COMMA line1="134" col1="61" line2="134" col2="61" start="11585" end="11585">,</OP-COMMA>
              <expr line1="134" col1="63" line2="134" col2="78" start="11587" end="11602">
                <SYMBOL line1="134" col1="63" line2="134" col2="78" start="11587" end="11602">effective_length</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="134" col1="79" line2="134" col2="79" start="11603" end="11603">)</OP-RIGHT-PAREN>
            </expr>
            <OP-COMMA line1="134" col1="80" line2="134" col2="80" start="11604" end="11604">,</OP-COMMA>
            <SYMBOL_SUB line1="135" col1="26" line2="135" col2="35" start="11636" end="11645">normcounts</SYMBOL_SUB>
            <EQ_SUB line1="135" col1="37" line2="135" col2="37" start="11647" end="11647">=</EQ_SUB>
            <expr line1="135" col1="39" line2="136" col2="69" start="11649" end="11765">
              <expr line1="135" col1="39" line2="135" col2="49" start="11649" end="11659">
                <SYMBOL_FUNCTION_CALL line1="135" col1="39" line2="135" col2="49" start="11649" end="11659">.countToTpm</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="135" col1="50" line2="135" col2="50" start="11660" end="11660">(</OP-LEFT-PAREN>
              <expr line1="135" col1="51" line2="135" col2="68" start="11661" end="11678">
                <expr line1="135" col1="51" line2="135" col2="60" start="11661" end="11670">
                  <SYMBOL_FUNCTION_CALL line1="135" col1="51" line2="135" col2="60" start="11661" end="11670">normcounts</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="135" col1="61" line2="135" col2="61" start="11671" end="11671">(</OP-LEFT-PAREN>
                <expr line1="135" col1="62" line2="135" col2="67" start="11672" end="11677">
                  <SYMBOL line1="135" col1="62" line2="135" col2="67" start="11672" end="11677">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="135" col1="68" line2="135" col2="68" start="11678" end="11678">)</OP-RIGHT-PAREN>
              </expr>
              <OP-COMMA line1="135" col1="69" line2="135" col2="69" start="11679" end="11679">,</OP-COMMA>
              <expr line1="136" col1="53" line2="136" col2="68" start="11749" end="11764">
                <SYMBOL line1="136" col1="53" line2="136" col2="68" start="11749" end="11764">effective_length</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="136" col1="69" line2="136" col2="69" start="11765" end="11765">)</OP-RIGHT-PAREN>
            </expr>
            <OP-COMMA line1="136" col1="70" line2="136" col2="70" start="11766" end="11766">,</OP-COMMA>
            <SYMBOL_SUB line1="137" col1="26" line2="137" col2="29" start="11808" end="11811">fpkm</SYMBOL_SUB>
            <EQ_SUB line1="137" col1="31" line2="137" col2="31" start="11813" end="11813">=</EQ_SUB>
            <expr line1="137" col1="33" line2="137" col2="56" start="11815" end="11838">
              <expr line1="137" col1="33" line2="137" col2="42" start="11815" end="11824">
                <SYMBOL_FUNCTION_CALL line1="137" col1="33" line2="137" col2="42" start="11815" end="11824">.fpkmToTpm</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="137" col1="43" line2="137" col2="43" start="11825" end="11825">(</OP-LEFT-PAREN>
              <expr line1="137" col1="44" line2="137" col2="55" start="11826" end="11837">
                <expr line1="137" col1="44" line2="137" col2="47" start="11826" end="11829">
                  <SYMBOL_FUNCTION_CALL line1="137" col1="44" line2="137" col2="47" start="11826" end="11829">fpkm</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="137" col1="48" line2="137" col2="48" start="11830" end="11830">(</OP-LEFT-PAREN>
                <expr line1="137" col1="49" line2="137" col2="54" start="11831" end="11836">
                  <SYMBOL line1="137" col1="49" line2="137" col2="54" start="11831" end="11836">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="137" col1="55" line2="137" col2="55" start="11837" end="11837">)</OP-RIGHT-PAREN>
              </expr>
              <OP-RIGHT-PAREN line1="137" col1="56" line2="137" col2="56" start="11838" end="11838">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-PAREN line1="137" col1="57" line2="137" col2="57" start="11839" end="11839">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <COMMENT line1="139" col1="5" line2="139" col2="24" start="11959" end="11978">## Return TPM values</COMMENT>
        <expr line1="140" col1="5" line2="140" col2="44" start="12045" end="12084">
          <expr line1="140" col1="5" line2="140" col2="24" start="12045" end="12064">
            <expr line1="140" col1="5" line2="140" col2="12" start="12045" end="12052">
              <SYMBOL_FUNCTION_CALL line1="140" col1="5" line2="140" col2="12" start="12045" end="12052">rownames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="140" col1="13" line2="140" col2="13" start="12053" end="12053">(</OP-LEFT-PAREN>
            <expr line1="140" col1="14" line2="140" col2="23" start="12054" end="12063">
              <SYMBOL line1="140" col1="14" line2="140" col2="23" start="12054" end="12063">tpm_to_add</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="140" col1="24" line2="140" col2="24" start="12064" end="12064">)</OP-RIGHT-PAREN>
          </expr>
          <LEFT_ASSIGN line1="140" col1="26" line2="140" col2="27" start="12066" end="12067">&lt;-</LEFT_ASSIGN>
          <expr line1="140" col1="29" line2="140" col2="44" start="12069" end="12084">
            <expr line1="140" col1="29" line2="140" col2="36" start="12069" end="12076">
              <SYMBOL_FUNCTION_CALL line1="140" col1="29" line2="140" col2="36" start="12069" end="12076">rownames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="140" col1="37" line2="140" col2="37" start="12077" end="12077">(</OP-LEFT-PAREN>
            <expr line1="140" col1="38" line2="140" col2="43" start="12078" end="12083">
              <SYMBOL line1="140" col1="38" line2="140" col2="43" start="12078" end="12083">object</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="140" col1="44" line2="140" col2="44" start="12084" end="12084">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="141" col1="5" line2="141" col2="44" start="12131" end="12170">
          <expr line1="141" col1="5" line2="141" col2="24" start="12131" end="12150">
            <expr line1="141" col1="5" line2="141" col2="12" start="12131" end="12138">
              <SYMBOL_FUNCTION_CALL line1="141" col1="5" line2="141" col2="12" start="12131" end="12138">colnames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="141" col1="13" line2="141" col2="13" start="12139" end="12139">(</OP-LEFT-PAREN>
            <expr line1="141" col1="14" line2="141" col2="23" start="12140" end="12149">
              <SYMBOL line1="141" col1="14" line2="141" col2="23" start="12140" end="12149">tpm_to_add</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="141" col1="24" line2="141" col2="24" start="12150" end="12150">)</OP-RIGHT-PAREN>
          </expr>
          <LEFT_ASSIGN line1="141" col1="26" line2="141" col2="27" start="12152" end="12153">&lt;-</LEFT_ASSIGN>
          <expr line1="141" col1="29" line2="141" col2="44" start="12155" end="12170">
            <expr line1="141" col1="29" line2="141" col2="36" start="12155" end="12162">
              <SYMBOL_FUNCTION_CALL line1="141" col1="29" line2="141" col2="36" start="12155" end="12162">colnames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="141" col1="37" line2="141" col2="37" start="12163" end="12163">(</OP-LEFT-PAREN>
            <expr line1="141" col1="38" line2="141" col2="43" start="12164" end="12169">
              <SYMBOL line1="141" col1="38" line2="141" col2="43" start="12164" end="12169">object</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="141" col1="44" line2="141" col2="44" start="12170" end="12170">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="142" col1="5" line2="142" col2="14" start="12217" end="12226">
          <SYMBOL line1="142" col1="5" line2="142" col2="14" start="12217" end="12226">tpm_to_add</SYMBOL>
        </expr>
        <OP-RIGHT-BRACE line1="143" col1="1" line2="143" col2="1" start="12299" end="12299">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <expr line1="145" col1="1" line2="155" col2="1" start="12471" end="13331">
    <expr line1="145" col1="1" line2="145" col2="11" start="12471" end="12481">
      <SYMBOL line1="145" col1="1" line2="145" col2="11" start="12471" end="12481">.countToTpm</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="145" col1="13" line2="145" col2="14" start="12483" end="12484">&lt;-</LEFT_ASSIGN>
    <expr line1="145" col1="16" line2="155" col2="1" start="12486" end="13331">
      <FUNCTION line1="145" col1="16" line2="145" col2="23" start="12486" end="12493">function</FUNCTION>
      <OP-LEFT-PAREN line1="145" col1="24" line2="145" col2="24" start="12494" end="12494">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="145" col1="25" line2="145" col2="30" start="12495" end="12500">counts</SYMBOL_FORMALS>
      <OP-COMMA line1="145" col1="31" line2="145" col2="31" start="12501" end="12501">,</OP-COMMA>
      <SYMBOL_FORMALS line1="145" col1="33" line2="145" col2="39" start="12503" end="12509">eff_len</SYMBOL_FORMALS>
      <OP-RIGHT-PAREN line1="145" col1="40" line2="145" col2="40" start="12510" end="12510">)</OP-RIGHT-PAREN>
      <expr line1="145" col1="42" line2="155" col2="1" start="12512" end="13331">
        <OP-LEFT-BRACE line1="145" col1="42" line2="145" col2="42" start="12512" end="12512">{</OP-LEFT-BRACE>
        <COMMENT line1="146" col1="5" line2="146" col2="53" start="12561" end="12609">## Expecting a count matrix of nfeatures x ncells</COMMENT>
        <COMMENT line1="147" col1="5" line2="147" col2="60" start="12647" end="12702">## can't have any zero counts, so expect to apply offset</COMMENT>
        <expr line1="148" col1="5" line2="148" col2="21" start="12733" end="12749">
          <expr line1="148" col1="5" line2="148" col2="11" start="12733" end="12739">
            <SYMBOL line1="148" col1="5" line2="148" col2="11" start="12733" end="12739">counts0</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="148" col1="13" line2="148" col2="14" start="12741" end="12742">&lt;-</LEFT_ASSIGN>
          <expr line1="148" col1="16" line2="148" col2="21" start="12744" end="12749">
            <SYMBOL line1="148" col1="16" line2="148" col2="21" start="12744" end="12749">counts</SYMBOL>
          </expr>
        </expr>
        <expr line1="149" col1="5" line2="149" col2="30" start="12819" end="12844">
          <expr line1="149" col1="5" line2="149" col2="24" start="12819" end="12838">
            <expr line1="149" col1="5" line2="149" col2="11" start="12819" end="12825">
              <SYMBOL line1="149" col1="5" line2="149" col2="11" start="12819" end="12825">counts0</SYMBOL>
            </expr>
            <OP-LEFT-BRACKET line1="149" col1="12" line2="149" col2="12" start="12826" end="12826">[</OP-LEFT-BRACKET>
            <expr line1="149" col1="13" line2="149" col2="23" start="12827" end="12837">
              <expr line1="149" col1="13" line2="149" col2="18" start="12827" end="12832">
                <SYMBOL line1="149" col1="13" line2="149" col2="18" start="12827" end="12832">counts</SYMBOL>
              </expr>
              <EQ line1="149" col1="20" line2="149" col2="21" start="12834" end="12835">==</EQ>
              <expr line1="149" col1="23" line2="149" col2="23" start="12837" end="12837">
                <NUM_CONST line1="149" col1="23" line2="149" col2="23" start="12837" end="12837">0</NUM_CONST>
              </expr>
            </expr>
            <OP-RIGHT-BRACKET line1="149" col1="24" line2="149" col2="24" start="12838" end="12838">]</OP-RIGHT-BRACKET>
          </expr>
          <LEFT_ASSIGN line1="149" col1="26" line2="149" col2="27" start="12840" end="12841">&lt;-</LEFT_ASSIGN>
          <expr line1="149" col1="29" line2="149" col2="30" start="12843" end="12844">
            <NUM_CONST line1="149" col1="29" line2="149" col2="30" start="12843" end="12844">NA</NUM_CONST>
          </expr>
        </expr>
        <expr line1="150" col1="5" line2="150" col2="39" start="12905" end="12939">
          <expr line1="150" col1="5" line2="150" col2="8" start="12905" end="12908">
            <SYMBOL line1="150" col1="5" line2="150" col2="8" start="12905" end="12908">rate</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="150" col1="10" line2="150" col2="11" start="12910" end="12911">&lt;-</LEFT_ASSIGN>
          <expr line1="150" col1="13" line2="150" col2="39" start="12913" end="12939">
            <expr line1="150" col1="13" line2="150" col2="24" start="12913" end="12924">
              <expr line1="150" col1="13" line2="150" col2="15" start="12913" end="12915">
                <SYMBOL_FUNCTION_CALL line1="150" col1="13" line2="150" col2="15" start="12913" end="12915">log</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="150" col1="16" line2="150" col2="16" start="12916" end="12916">(</OP-LEFT-PAREN>
              <expr line1="150" col1="17" line2="150" col2="23" start="12917" end="12923">
                <SYMBOL line1="150" col1="17" line2="150" col2="23" start="12917" end="12923">counts0</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="150" col1="24" line2="150" col2="24" start="12924" end="12924">)</OP-RIGHT-PAREN>
            </expr>
            <OP-MINUS line1="150" col1="26" line2="150" col2="26" start="12926" end="12926">-</OP-MINUS>
            <expr line1="150" col1="28" line2="150" col2="39" start="12928" end="12939">
              <expr line1="150" col1="28" line2="150" col2="30" start="12928" end="12930">
                <SYMBOL_FUNCTION_CALL line1="150" col1="28" line2="150" col2="30" start="12928" end="12930">log</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="150" col1="31" line2="150" col2="31" start="12931" end="12931">(</OP-LEFT-PAREN>
              <expr line1="150" col1="32" line2="150" col2="38" start="12932" end="12938">
                <SYMBOL line1="150" col1="32" line2="150" col2="38" start="12932" end="12938">eff_len</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="150" col1="39" line2="150" col2="39" start="12939" end="12939">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
        </expr>
        <expr line1="151" col1="5" line2="151" col2="42" start="12991" end="13028">
          <expr line1="151" col1="5" line2="151" col2="9" start="12991" end="12995">
            <SYMBOL line1="151" col1="5" line2="151" col2="9" start="12991" end="12995">denom</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="151" col1="11" line2="151" col2="12" start="12997" end="12998">&lt;-</LEFT_ASSIGN>
          <expr line1="151" col1="14" line2="151" col2="42" start="13000" end="13028">
            <expr line1="151" col1="14" line2="151" col2="16" start="13000" end="13002">
              <SYMBOL_FUNCTION_CALL line1="151" col1="14" line2="151" col2="16" start="13000" end="13002">log</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="151" col1="17" line2="151" col2="17" start="13003" end="13003">(</OP-LEFT-PAREN>
            <expr line1="151" col1="18" line2="151" col2="41" start="13004" end="13027">
              <expr line1="151" col1="18" line2="151" col2="33" start="13004" end="13019">
                <SYMBOL_FUNCTION_CALL line1="151" col1="18" line2="151" col2="33" start="13004" end="13019">.general_colSums</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="151" col1="34" line2="151" col2="34" start="13020" end="13020">(</OP-LEFT-PAREN>
              <expr line1="151" col1="35" line2="151" col2="40" start="13021" end="13026">
                <SYMBOL line1="151" col1="35" line2="151" col2="40" start="13021" end="13026">counts</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="151" col1="41" line2="151" col2="41" start="13027" end="13027">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-PAREN line1="151" col1="42" line2="151" col2="42" start="13028" end="13028">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="152" col1="5" line2="152" col2="58" start="13077" end="13130">
          <expr line1="152" col1="5" line2="152" col2="7" start="13077" end="13079">
            <SYMBOL line1="152" col1="5" line2="152" col2="7" start="13077" end="13079">out</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="152" col1="9" line2="152" col2="10" start="13081" end="13082">&lt;-</LEFT_ASSIGN>
          <expr line1="152" col1="12" line2="152" col2="58" start="13084" end="13130">
            <expr line1="152" col1="12" line2="152" col2="14" start="13084" end="13086">
              <SYMBOL_FUNCTION_CALL line1="152" col1="12" line2="152" col2="14" start="13084" end="13086">exp</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="152" col1="15" line2="152" col2="15" start="13087" end="13087">(</OP-LEFT-PAREN>
            <expr line1="152" col1="17" line2="152" col2="56" start="13089" end="13128">
              <expr line1="152" col1="17" line2="152" col2="45" start="13089" end="13117">
                <expr line1="152" col1="17" line2="152" col2="17" start="13089" end="13089">
                  <SYMBOL_FUNCTION_CALL line1="152" col1="17" line2="152" col2="17" start="13089" end="13089">t</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="152" col1="18" line2="152" col2="18" start="13090" end="13090">(</OP-LEFT-PAREN>
                <expr line1="152" col1="19" line2="152" col2="44" start="13091" end="13116">
                  <expr line1="152" col1="19" line2="152" col2="36" start="13091" end="13108">
                    <expr line1="152" col1="19" line2="152" col2="19" start="13091" end="13091">
                      <SYMBOL_FUNCTION_CALL line1="152" col1="19" line2="152" col2="19" start="13091" end="13091">t</SYMBOL_FUNCTION_CALL>
                    </expr>
                    <OP-LEFT-PAREN line1="152" col1="20" line2="152" col2="20" start="13092" end="13092">(</OP-LEFT-PAREN>
                    <expr line1="152" col1="21" line2="152" col2="35" start="13093" end="13107">
                      <expr line1="152" col1="21" line2="152" col2="29" start="13093" end="13101">
                        <SYMBOL_FUNCTION_CALL line1="152" col1="21" line2="152" col2="29" start="13093" end="13101">as.matrix</SYMBOL_FUNCTION_CALL>
                      </expr>
                      <OP-LEFT-PAREN line1="152" col1="30" line2="152" col2="30" start="13102" end="13102">(</OP-LEFT-PAREN>
                      <expr line1="152" col1="31" line2="152" col2="34" start="13103" end="13106">
                        <SYMBOL line1="152" col1="31" line2="152" col2="34" start="13103" end="13106">rate</SYMBOL>
                      </expr>
                      <OP-RIGHT-PAREN line1="152" col1="35" line2="152" col2="35" start="13107" end="13107">)</OP-RIGHT-PAREN>
                    </expr>
                    <OP-RIGHT-PAREN line1="152" col1="36" line2="152" col2="36" start="13108" end="13108">)</OP-RIGHT-PAREN>
                  </expr>
                  <OP-MINUS line1="152" col1="38" line2="152" col2="38" start="13110" end="13110">-</OP-MINUS>
                  <expr line1="152" col1="40" line2="152" col2="44" start="13112" end="13116">
                    <SYMBOL line1="152" col1="40" line2="152" col2="44" start="13112" end="13116">denom</SYMBOL>
                  </expr>
                </expr>
                <OP-RIGHT-PAREN line1="152" col1="45" line2="152" col2="45" start="13117" end="13117">)</OP-RIGHT-PAREN>
              </expr>
              <OP-PLUS line1="152" col1="47" line2="152" col2="47" start="13119" end="13119">+</OP-PLUS>
              <expr line1="152" col1="49" line2="152" col2="56" start="13121" end="13128">
                <expr line1="152" col1="49" line2="152" col2="51" start="13121" end="13123">
                  <SYMBOL_FUNCTION_CALL line1="152" col1="49" line2="152" col2="51" start="13121" end="13123">log</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="152" col1="52" line2="152" col2="52" start="13124" end="13124">(</OP-LEFT-PAREN>
                <expr line1="152" col1="53" line2="152" col2="55" start="13125" end="13127">
                  <NUM_CONST line1="152" col1="53" line2="152" col2="55" start="13125" end="13127">1e6</NUM_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="152" col1="56" line2="152" col2="56" start="13128" end="13128">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-PAREN line1="152" col1="58" line2="152" col2="58" start="13130" end="13130">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="153" col1="5" line2="153" col2="24" start="13163" end="13182">
          <expr line1="153" col1="5" line2="153" col2="19" start="13163" end="13177">
            <expr line1="153" col1="5" line2="153" col2="7" start="13163" end="13165">
              <SYMBOL line1="153" col1="5" line2="153" col2="7" start="13163" end="13165">out</SYMBOL>
            </expr>
            <OP-LEFT-BRACKET line1="153" col1="8" line2="153" col2="8" start="13166" end="13166">[</OP-LEFT-BRACKET>
            <expr line1="153" col1="9" line2="153" col2="18" start="13167" end="13176">
              <expr line1="153" col1="9" line2="153" col2="13" start="13167" end="13171">
                <SYMBOL_FUNCTION_CALL line1="153" col1="9" line2="153" col2="13" start="13167" end="13171">is.na</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="153" col1="14" line2="153" col2="14" start="13172" end="13172">(</OP-LEFT-PAREN>
              <expr line1="153" col1="15" line2="153" col2="17" start="13173" end="13175">
                <SYMBOL line1="153" col1="15" line2="153" col2="17" start="13173" end="13175">out</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="153" col1="18" line2="153" col2="18" start="13176" end="13176">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-BRACKET line1="153" col1="19" line2="153" col2="19" start="13177" end="13177">]</OP-RIGHT-BRACKET>
          </expr>
          <LEFT_ASSIGN line1="153" col1="21" line2="153" col2="22" start="13179" end="13180">&lt;-</LEFT_ASSIGN>
          <expr line1="153" col1="24" line2="153" col2="24" start="13182" end="13182">
            <NUM_CONST line1="153" col1="24" line2="153" col2="24" start="13182" end="13182">0</NUM_CONST>
          </expr>
        </expr>
        <expr line1="154" col1="5" line2="154" col2="7" start="13249" end="13251">
          <SYMBOL line1="154" col1="5" line2="154" col2="7" start="13249" end="13251">out</SYMBOL>
        </expr>
        <OP-RIGHT-BRACE line1="155" col1="1" line2="155" col2="1" start="13331" end="13331">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <expr line1="157" col1="1" line2="171" col2="1" start="13503" end="14707">
    <expr line1="157" col1="1" line2="157" col2="12" start="13503" end="13514">
      <SYMBOL line1="157" col1="1" line2="157" col2="12" start="13503" end="13514">.countToFpkm</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="157" col1="14" line2="157" col2="15" start="13516" end="13517">&lt;-</LEFT_ASSIGN>
    <expr line1="157" col1="17" line2="171" col2="1" start="13519" end="14707">
      <FUNCTION line1="157" col1="17" line2="157" col2="24" start="13519" end="13526">function</FUNCTION>
      <OP-LEFT-PAREN line1="157" col1="25" line2="157" col2="25" start="13527" end="13527">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="157" col1="26" line2="157" col2="31" start="13528" end="13533">counts</SYMBOL_FORMALS>
      <OP-COMMA line1="157" col1="32" line2="157" col2="32" start="13534" end="13534">,</OP-COMMA>
      <SYMBOL_FORMALS line1="157" col1="34" line2="157" col2="40" start="13536" end="13542">eff_len</SYMBOL_FORMALS>
      <OP-RIGHT-PAREN line1="157" col1="41" line2="157" col2="41" start="13543" end="13543">)</OP-RIGHT-PAREN>
      <expr line1="157" col1="43" line2="171" col2="1" start="13545" end="14707">
        <OP-LEFT-BRACE line1="157" col1="43" line2="157" col2="43" start="13545" end="13545">{</OP-LEFT-BRACE>
        <COMMENT line1="158" col1="5" line2="158" col2="53" start="13593" end="13641">## Expecting a count matrix of nfeatures x ncells</COMMENT>
        <COMMENT line1="159" col1="5" line2="159" col2="42" start="13679" end="13716">## Need to be careful with zero counts</COMMENT>
        <expr line1="160" col1="5" line2="160" col2="21" start="13765" end="13781">
          <expr line1="160" col1="5" line2="160" col2="11" start="13765" end="13771">
            <SYMBOL line1="160" col1="5" line2="160" col2="11" start="13765" end="13771">counts0</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="160" col1="13" line2="160" col2="14" start="13773" end="13774">&lt;-</LEFT_ASSIGN>
          <expr line1="160" col1="16" line2="160" col2="21" start="13776" end="13781">
            <SYMBOL line1="160" col1="16" line2="160" col2="21" start="13776" end="13781">counts</SYMBOL>
          </expr>
        </expr>
        <expr line1="161" col1="5" line2="161" col2="30" start="13851" end="13876">
          <expr line1="161" col1="5" line2="161" col2="24" start="13851" end="13870">
            <expr line1="161" col1="5" line2="161" col2="11" start="13851" end="13857">
              <SYMBOL line1="161" col1="5" line2="161" col2="11" start="13851" end="13857">counts0</SYMBOL>
            </expr>
            <OP-LEFT-BRACKET line1="161" col1="12" line2="161" col2="12" start="13858" end="13858">[</OP-LEFT-BRACKET>
            <expr line1="161" col1="13" line2="161" col2="23" start="13859" end="13869">
              <expr line1="161" col1="13" line2="161" col2="18" start="13859" end="13864">
                <SYMBOL line1="161" col1="13" line2="161" col2="18" start="13859" end="13864">counts</SYMBOL>
              </expr>
              <EQ line1="161" col1="20" line2="161" col2="21" start="13866" end="13867">==</EQ>
              <expr line1="161" col1="23" line2="161" col2="23" start="13869" end="13869">
                <NUM_CONST line1="161" col1="23" line2="161" col2="23" start="13869" end="13869">0</NUM_CONST>
              </expr>
            </expr>
            <OP-RIGHT-BRACKET line1="161" col1="24" line2="161" col2="24" start="13870" end="13870">]</OP-RIGHT-BRACKET>
          </expr>
          <LEFT_ASSIGN line1="161" col1="26" line2="161" col2="27" start="13872" end="13873">&lt;-</LEFT_ASSIGN>
          <expr line1="161" col1="29" line2="161" col2="30" start="13875" end="13876">
            <NUM_CONST line1="161" col1="29" line2="161" col2="30" start="13875" end="13876">NA</NUM_CONST>
          </expr>
        </expr>
        <expr line1="162" col1="5" line2="162" col2="68" start="13937" end="14000">
          <expr line1="162" col1="5" line2="162" col2="14" start="13937" end="13946">
            <SYMBOL line1="162" col1="5" line2="162" col2="14" start="13937" end="13946">subset_row</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="162" col1="16" line2="162" col2="17" start="13948" end="13949">&lt;-</LEFT_ASSIGN>
          <expr line1="162" col1="19" line2="162" col2="68" start="13951" end="14000">
            <expr line1="162" col1="19" line2="162" col2="31" start="13951" end="13963">
              <SYMBOL_FUNCTION_CALL line1="162" col1="19" line2="162" col2="31" start="13951" end="13963">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="162" col1="32" line2="162" col2="32" start="13964" end="13964">(</OP-LEFT-PAREN>
            <expr line1="162" col1="33" line2="162" col2="36" start="13965" end="13968">
              <NULL_CONST line1="162" col1="33" line2="162" col2="36" start="13965" end="13968">NULL</NULL_CONST>
            </expr>
            <OP-COMMA line1="162" col1="37" line2="162" col2="37" start="13969" end="13969">,</OP-COMMA>
            <SYMBOL_SUB line1="162" col1="39" line2="162" col2="44" start="13971" end="13976">target</SYMBOL_SUB>
            <EQ_SUB line1="162" col1="46" line2="162" col2="46" start="13978" end="13978">=</EQ_SUB>
            <expr line1="162" col1="48" line2="162" col2="53" start="13980" end="13985">
              <SYMBOL line1="162" col1="48" line2="162" col2="53" start="13980" end="13985">counts</SYMBOL>
            </expr>
            <OP-COMMA line1="162" col1="54" line2="162" col2="54" start="13986" end="13986">,</OP-COMMA>
            <SYMBOL_SUB line1="162" col1="56" line2="162" col2="60" start="13988" end="13992">byrow</SYMBOL_SUB>
            <EQ_SUB line1="162" col1="62" line2="162" col2="62" start="13994" end="13994">=</EQ_SUB>
            <expr line1="162" col1="64" line2="162" col2="67" start="13996" end="13999">
              <NUM_CONST line1="162" col1="64" line2="162" col2="67" start="13996" end="13999">TRUE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="162" col1="68" line2="162" col2="68" start="14000" end="14000">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="163" col1="5" line2="164" col2="49" start="14023" end="14153">
          <expr line1="163" col1="5" line2="163" col2="16" start="14023" end="14034">
            <SYMBOL line1="163" col1="5" line2="163" col2="16" start="14023" end="14034">margin.stats</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="163" col1="18" line2="163" col2="19" start="14036" end="14037">&lt;-</LEFT_ASSIGN>
          <expr line1="163" col1="21" line2="164" col2="49" start="14039" end="14153">
            <expr line1="163" col1="21" line2="163" col2="25" start="14039" end="14043">
              <SYMBOL_FUNCTION_CALL line1="163" col1="21" line2="163" col2="25" start="14039" end="14043">.Call</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="163" col1="26" line2="163" col2="26" start="14044" end="14044">(</OP-LEFT-PAREN>
            <expr line1="163" col1="27" line2="163" col2="44" start="14045" end="14062">
              <SYMBOL line1="163" col1="27" line2="163" col2="44" start="14045" end="14062">cxx_margin_summary</SYMBOL>
            </expr>
            <OP-COMMA line1="163" col1="45" line2="163" col2="45" start="14063" end="14063">,</OP-COMMA>
            <expr line1="163" col1="47" line2="163" col2="52" start="14065" end="14070">
              <SYMBOL line1="163" col1="47" line2="163" col2="52" start="14065" end="14070">counts</SYMBOL>
            </expr>
            <OP-COMMA line1="163" col1="53" line2="163" col2="53" start="14071" end="14071">,</OP-COMMA>
            <expr line1="163" col1="55" line2="163" col2="55" start="14073" end="14073">
              <NUM_CONST line1="163" col1="55" line2="163" col2="55" start="14073" end="14073">0</NUM_CONST>
            </expr>
            <OP-COMMA line1="163" col1="56" line2="163" col2="56" start="14074" end="14074">,</OP-COMMA>
            <expr line1="164" col1="27" line2="164" col2="41" start="14131" end="14145">
              <expr line1="164" col1="27" line2="164" col2="36" start="14131" end="14140">
                <SYMBOL line1="164" col1="27" line2="164" col2="36" start="14131" end="14140">subset_row</SYMBOL>
              </expr>
              <OP-MINUS line1="164" col1="38" line2="164" col2="38" start="14142" end="14142">-</OP-MINUS>
              <expr line1="164" col1="40" line2="164" col2="41" start="14144" end="14145">
                <NUM_CONST line1="164" col1="40" line2="164" col2="41" start="14144" end="14145">1L</NUM_CONST>
              </expr>
            </expr>
            <OP-COMMA line1="164" col1="42" line2="164" col2="42" start="14146" end="14146">,</OP-COMMA>
            <expr line1="164" col1="44" line2="164" col2="48" start="14148" end="14152">
              <NUM_CONST line1="164" col1="44" line2="164" col2="48" start="14148" end="14152">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="164" col1="49" line2="164" col2="49" start="14153" end="14153">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="165" col1="5" line2="165" col2="26" start="14195" end="14216">
          <expr line1="165" col1="5" line2="165" col2="5" start="14195" end="14195">
            <SYMBOL line1="165" col1="5" line2="165" col2="5" start="14195" end="14195">N</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="165" col1="7" line2="165" col2="8" start="14197" end="14198">&lt;-</LEFT_ASSIGN>
          <expr line1="165" col1="10" line2="165" col2="26" start="14200" end="14216">
            <expr line1="165" col1="10" line2="165" col2="21" start="14200" end="14211">
              <SYMBOL line1="165" col1="10" line2="165" col2="21" start="14200" end="14211">margin.stats</SYMBOL>
            </expr>
            <LBB line1="165" col1="22" line2="165" col2="23" start="14212" end="14213">[[</LBB>
            <expr line1="165" col1="24" line2="165" col2="24" start="14214" end="14214">
              <NUM_CONST line1="165" col1="24" line2="165" col2="24" start="14214" end="14214">1</NUM_CONST>
            </expr>
            <OP-RIGHT-BRACKET line1="165" col1="25" line2="165" col2="25" start="14215" end="14215">]</OP-RIGHT-BRACKET>
            <OP-RIGHT-BRACKET line1="165" col1="26" line2="165" col2="26" start="14216" end="14216">]</OP-RIGHT-BRACKET>
          </expr>
        </expr>
        <expr line1="166" col1="5" line2="166" col2="53" start="14281" end="14329">
          <expr line1="166" col1="5" line2="166" col2="11" start="14281" end="14287">
            <SYMBOL line1="166" col1="5" line2="166" col2="11" start="14281" end="14287">logfpkm</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="166" col1="13" line2="166" col2="14" start="14289" end="14290">&lt;-</LEFT_ASSIGN>
          <expr line1="166" col1="16" line2="166" col2="53" start="14292" end="14329">
            <expr line1="166" col1="16" line2="166" col2="38" start="14292" end="14314">
              <expr line1="166" col1="16" line2="166" col2="27" start="14292" end="14303">
                <expr line1="166" col1="16" line2="166" col2="18" start="14292" end="14294">
                  <SYMBOL_FUNCTION_CALL line1="166" col1="16" line2="166" col2="18" start="14292" end="14294">log</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="166" col1="19" line2="166" col2="19" start="14295" end="14295">(</OP-LEFT-PAREN>
                <expr line1="166" col1="20" line2="166" col2="26" start="14296" end="14302">
                  <SYMBOL line1="166" col1="20" line2="166" col2="26" start="14296" end="14302">counts0</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="166" col1="27" line2="166" col2="27" start="14303" end="14303">)</OP-RIGHT-PAREN>
              </expr>
              <OP-PLUS line1="166" col1="29" line2="166" col2="29" start="14305" end="14305">+</OP-PLUS>
              <expr line1="166" col1="31" line2="166" col2="38" start="14307" end="14314">
                <expr line1="166" col1="31" line2="166" col2="33" start="14307" end="14309">
                  <SYMBOL_FUNCTION_CALL line1="166" col1="31" line2="166" col2="33" start="14307" end="14309">log</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="166" col1="34" line2="166" col2="34" start="14310" end="14310">(</OP-LEFT-PAREN>
                <expr line1="166" col1="35" line2="166" col2="37" start="14311" end="14313">
                  <NUM_CONST line1="166" col1="35" line2="166" col2="37" start="14311" end="14313">1e9</NUM_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="166" col1="38" line2="166" col2="38" start="14314" end="14314">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-MINUS line1="166" col1="40" line2="166" col2="40" start="14316" end="14316">-</OP-MINUS>
            <expr line1="166" col1="42" line2="166" col2="53" start="14318" end="14329">
              <expr line1="166" col1="42" line2="166" col2="44" start="14318" end="14320">
                <SYMBOL_FUNCTION_CALL line1="166" col1="42" line2="166" col2="44" start="14318" end="14320">log</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="166" col1="45" line2="166" col2="45" start="14321" end="14321">(</OP-LEFT-PAREN>
              <expr line1="166" col1="46" line2="166" col2="52" start="14322" end="14328">
                <SYMBOL line1="166" col1="46" line2="166" col2="52" start="14322" end="14328">eff_len</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="166" col1="53" line2="166" col2="53" start="14329" end="14329">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
        </expr>
        <expr line1="167" col1="5" line2="167" col2="37" start="14367" end="14399">
          <expr line1="167" col1="5" line2="167" col2="11" start="14367" end="14373">
            <SYMBOL line1="167" col1="5" line2="167" col2="11" start="14367" end="14373">logfpkm</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="167" col1="13" line2="167" col2="14" start="14375" end="14376">&lt;-</LEFT_ASSIGN>
          <expr line1="167" col1="16" line2="167" col2="37" start="14378" end="14399">
            <expr line1="167" col1="16" line2="167" col2="16" start="14378" end="14378">
              <SYMBOL_FUNCTION_CALL line1="167" col1="16" line2="167" col2="16" start="14378" end="14378">t</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="167" col1="17" line2="167" col2="17" start="14379" end="14379">(</OP-LEFT-PAREN>
            <expr line1="167" col1="18" line2="167" col2="36" start="14380" end="14398">
              <expr line1="167" col1="18" line2="167" col2="27" start="14380" end="14389">
                <expr line1="167" col1="18" line2="167" col2="18" start="14380" end="14380">
                  <SYMBOL_FUNCTION_CALL line1="167" col1="18" line2="167" col2="18" start="14380" end="14380">t</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="167" col1="19" line2="167" col2="19" start="14381" end="14381">(</OP-LEFT-PAREN>
                <expr line1="167" col1="20" line2="167" col2="26" start="14382" end="14388">
                  <SYMBOL line1="167" col1="20" line2="167" col2="26" start="14382" end="14388">logfpkm</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="167" col1="27" line2="167" col2="27" start="14389" end="14389">)</OP-RIGHT-PAREN>
              </expr>
              <OP-MINUS line1="167" col1="29" line2="167" col2="29" start="14391" end="14391">-</OP-MINUS>
              <expr line1="167" col1="31" line2="167" col2="36" start="14393" end="14398">
                <expr line1="167" col1="31" line2="167" col2="33" start="14393" end="14395">
                  <SYMBOL_FUNCTION_CALL line1="167" col1="31" line2="167" col2="33" start="14393" end="14395">log</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="167" col1="34" line2="167" col2="34" start="14396" end="14396">(</OP-LEFT-PAREN>
                <expr line1="167" col1="35" line2="167" col2="35" start="14397" end="14397">
                  <SYMBOL line1="167" col1="35" line2="167" col2="35" start="14397" end="14397">N</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="167" col1="36" line2="167" col2="36" start="14398" end="14398">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-PAREN line1="167" col1="37" line2="167" col2="37" start="14399" end="14399">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="168" col1="5" line2="168" col2="25" start="14453" end="14473">
          <expr line1="168" col1="5" line2="168" col2="7" start="14453" end="14455">
            <SYMBOL line1="168" col1="5" line2="168" col2="7" start="14453" end="14455">out</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="168" col1="9" line2="168" col2="10" start="14457" end="14458">&lt;-</LEFT_ASSIGN>
          <expr line1="168" col1="12" line2="168" col2="25" start="14460" end="14473">
            <expr line1="168" col1="12" line2="168" col2="14" start="14460" end="14462">
              <SYMBOL_FUNCTION_CALL line1="168" col1="12" line2="168" col2="14" start="14460" end="14462">exp</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="168" col1="15" line2="168" col2="15" start="14463" end="14463">(</OP-LEFT-PAREN>
            <expr line1="168" col1="17" line2="168" col2="23" start="14465" end="14471">
              <SYMBOL line1="168" col1="17" line2="168" col2="23" start="14465" end="14471">logfpkm</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="168" col1="25" line2="168" col2="25" start="14473" end="14473">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="169" col1="5" line2="169" col2="24" start="14539" end="14558">
          <expr line1="169" col1="5" line2="169" col2="19" start="14539" end="14553">
            <expr line1="169" col1="5" line2="169" col2="7" start="14539" end="14541">
              <SYMBOL line1="169" col1="5" line2="169" col2="7" start="14539" end="14541">out</SYMBOL>
            </expr>
            <OP-LEFT-BRACKET line1="169" col1="8" line2="169" col2="8" start="14542" end="14542">[</OP-LEFT-BRACKET>
            <expr line1="169" col1="9" line2="169" col2="18" start="14543" end="14552">
              <expr line1="169" col1="9" line2="169" col2="13" start="14543" end="14547">
                <SYMBOL_FUNCTION_CALL line1="169" col1="9" line2="169" col2="13" start="14543" end="14547">is.na</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="169" col1="14" line2="169" col2="14" start="14548" end="14548">(</OP-LEFT-PAREN>
              <expr line1="169" col1="15" line2="169" col2="17" start="14549" end="14551">
                <SYMBOL line1="169" col1="15" line2="169" col2="17" start="14549" end="14551">out</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="169" col1="18" line2="169" col2="18" start="14552" end="14552">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-BRACKET line1="169" col1="19" line2="169" col2="19" start="14553" end="14553">]</OP-RIGHT-BRACKET>
          </expr>
          <LEFT_ASSIGN line1="169" col1="21" line2="169" col2="22" start="14555" end="14556">&lt;-</LEFT_ASSIGN>
          <expr line1="169" col1="24" line2="169" col2="24" start="14558" end="14558">
            <NUM_CONST line1="169" col1="24" line2="169" col2="24" start="14558" end="14558">0</NUM_CONST>
          </expr>
        </expr>
        <expr line1="170" col1="5" line2="170" col2="7" start="14625" end="14627">
          <SYMBOL line1="170" col1="5" line2="170" col2="7" start="14625" end="14627">out</SYMBOL>
        </expr>
        <OP-RIGHT-BRACE line1="171" col1="1" line2="171" col2="1" start="14707" end="14707">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <expr line1="173" col1="1" line2="179" col2="1" start="14879" end="15395">
    <expr line1="173" col1="1" line2="173" col2="10" start="14879" end="14888">
      <SYMBOL line1="173" col1="1" line2="173" col2="10" start="14879" end="14888">.fpkmToTpm</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="173" col1="12" line2="173" col2="13" start="14890" end="14891">&lt;-</LEFT_ASSIGN>
    <expr line1="173" col1="15" line2="179" col2="1" start="14893" end="15395">
      <FUNCTION line1="173" col1="15" line2="173" col2="22" start="14893" end="14900">function</FUNCTION>
      <OP-LEFT-PAREN line1="173" col1="23" line2="173" col2="23" start="14901" end="14901">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="173" col1="24" line2="173" col2="27" start="14902" end="14905">fpkm</SYMBOL_FORMALS>
      <OP-RIGHT-PAREN line1="173" col1="28" line2="173" col2="28" start="14906" end="14906">)</OP-RIGHT-PAREN>
      <expr line1="173" col1="30" line2="179" col2="1" start="14908" end="15395">
        <OP-LEFT-BRACE line1="173" col1="30" line2="173" col2="30" start="14908" end="14908">{</OP-LEFT-BRACE>
        <COMMENT line1="174" col1="5" line2="174" col2="53" start="14969" end="15017">## Expecting an FPKM matrix of nfeatures x ncells</COMMENT>
        <expr line1="175" col1="5" line2="175" col2="66" start="15055" end="15116">
          <expr line1="175" col1="5" line2="175" col2="14" start="15055" end="15064">
            <SYMBOL line1="175" col1="5" line2="175" col2="14" start="15055" end="15064">subset_row</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="175" col1="16" line2="175" col2="17" start="15066" end="15067">&lt;-</LEFT_ASSIGN>
          <expr line1="175" col1="19" line2="175" col2="66" start="15069" end="15116">
            <expr line1="175" col1="19" line2="175" col2="31" start="15069" end="15081">
              <SYMBOL_FUNCTION_CALL line1="175" col1="19" line2="175" col2="31" start="15069" end="15081">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="175" col1="32" line2="175" col2="32" start="15082" end="15082">(</OP-LEFT-PAREN>
            <expr line1="175" col1="33" line2="175" col2="36" start="15083" end="15086">
              <NULL_CONST line1="175" col1="33" line2="175" col2="36" start="15083" end="15086">NULL</NULL_CONST>
            </expr>
            <OP-COMMA line1="175" col1="37" line2="175" col2="37" start="15087" end="15087">,</OP-COMMA>
            <SYMBOL_SUB line1="175" col1="39" line2="175" col2="44" start="15089" end="15094">target</SYMBOL_SUB>
            <EQ_SUB line1="175" col1="46" line2="175" col2="46" start="15096" end="15096">=</EQ_SUB>
            <expr line1="175" col1="48" line2="175" col2="51" start="15098" end="15101">
              <SYMBOL line1="175" col1="48" line2="175" col2="51" start="15098" end="15101">fpkm</SYMBOL>
            </expr>
            <OP-COMMA line1="175" col1="52" line2="175" col2="52" start="15102" end="15102">,</OP-COMMA>
            <SYMBOL_SUB line1="175" col1="54" line2="175" col2="58" start="15104" end="15108">byrow</SYMBOL_SUB>
            <EQ_SUB line1="175" col1="60" line2="175" col2="60" start="15110" end="15110">=</EQ_SUB>
            <expr line1="175" col1="62" line2="175" col2="65" start="15112" end="15115">
              <NUM_CONST line1="175" col1="62" line2="175" col2="65" start="15112" end="15115">TRUE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="175" col1="66" line2="175" col2="66" start="15116" end="15116">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="176" col1="5" line2="177" col2="49" start="15141" end="15271">
          <expr line1="176" col1="5" line2="176" col2="16" start="15141" end="15152">
            <SYMBOL line1="176" col1="5" line2="176" col2="16" start="15141" end="15152">margin.stats</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="176" col1="18" line2="176" col2="19" start="15154" end="15155">&lt;-</LEFT_ASSIGN>
          <expr line1="176" col1="21" line2="177" col2="49" start="15157" end="15271">
            <expr line1="176" col1="21" line2="176" col2="25" start="15157" end="15161">
              <SYMBOL_FUNCTION_CALL line1="176" col1="21" line2="176" col2="25" start="15157" end="15161">.Call</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="176" col1="26" line2="176" col2="26" start="15162" end="15162">(</OP-LEFT-PAREN>
            <expr line1="176" col1="27" line2="176" col2="44" start="15163" end="15180">
              <SYMBOL line1="176" col1="27" line2="176" col2="44" start="15163" end="15180">cxx_margin_summary</SYMBOL>
            </expr>
            <OP-COMMA line1="176" col1="45" line2="176" col2="45" start="15181" end="15181">,</OP-COMMA>
            <expr line1="176" col1="47" line2="176" col2="50" start="15183" end="15186">
              <SYMBOL line1="176" col1="47" line2="176" col2="50" start="15183" end="15186">fpkm</SYMBOL>
            </expr>
            <OP-COMMA line1="176" col1="51" line2="176" col2="51" start="15187" end="15187">,</OP-COMMA>
            <expr line1="176" col1="53" line2="176" col2="53" start="15189" end="15189">
              <NUM_CONST line1="176" col1="53" line2="176" col2="53" start="15189" end="15189">0</NUM_CONST>
            </expr>
            <OP-COMMA line1="176" col1="54" line2="176" col2="54" start="15190" end="15190">,</OP-COMMA>
            <expr line1="177" col1="27" line2="177" col2="41" start="15249" end="15263">
              <expr line1="177" col1="27" line2="177" col2="36" start="15249" end="15258">
                <SYMBOL line1="177" col1="27" line2="177" col2="36" start="15249" end="15258">subset_row</SYMBOL>
              </expr>
              <OP-MINUS line1="177" col1="38" line2="177" col2="38" start="15260" end="15260">-</OP-MINUS>
              <expr line1="177" col1="40" line2="177" col2="41" start="15262" end="15263">
                <NUM_CONST line1="177" col1="40" line2="177" col2="41" start="15262" end="15263">1L</NUM_CONST>
              </expr>
            </expr>
            <OP-COMMA line1="177" col1="42" line2="177" col2="42" start="15264" end="15264">,</OP-COMMA>
            <expr line1="177" col1="44" line2="177" col2="48" start="15266" end="15270">
              <NUM_CONST line1="177" col1="44" line2="177" col2="48" start="15266" end="15270">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="177" col1="49" line2="177" col2="49" start="15271" end="15271">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="178" col1="5" line2="178" col2="73" start="15313" end="15381">
          <expr line1="178" col1="5" line2="178" col2="7" start="15313" end="15315">
            <SYMBOL_FUNCTION_CALL line1="178" col1="5" line2="178" col2="7" start="15313" end="15315">exp</SYMBOL_FUNCTION_CALL>
          </expr>
          <OP-LEFT-PAREN line1="178" col1="8" line2="178" col2="8" start="15316" end="15316">(</OP-LEFT-PAREN>
          <expr line1="178" col1="10" line2="178" col2="71" start="15318" end="15379">
            <expr line1="178" col1="10" line2="178" col2="60" start="15318" end="15368">
              <expr line1="178" col1="10" line2="178" col2="10" start="15318" end="15318">
                <SYMBOL_FUNCTION_CALL line1="178" col1="10" line2="178" col2="10" start="15318" end="15318">t</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="178" col1="11" line2="178" col2="11" start="15319" end="15319">(</OP-LEFT-PAREN>
              <expr line1="178" col1="12" line2="178" col2="59" start="15320" end="15367">
                <expr line1="178" col1="12" line2="178" col2="34" start="15320" end="15342">
                  <expr line1="178" col1="12" line2="178" col2="12" start="15320" end="15320">
                    <SYMBOL_FUNCTION_CALL line1="178" col1="12" line2="178" col2="12" start="15320" end="15320">t</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="178" col1="13" line2="178" col2="13" start="15321" end="15321">(</OP-LEFT-PAREN>
                  <expr line1="178" col1="14" line2="178" col2="33" start="15322" end="15341">
                    <expr line1="178" col1="14" line2="178" col2="16" start="15322" end="15324">
                      <SYMBOL_FUNCTION_CALL line1="178" col1="14" line2="178" col2="16" start="15322" end="15324">log</SYMBOL_FUNCTION_CALL>
                    </expr>
                    <OP-LEFT-PAREN line1="178" col1="17" line2="178" col2="17" start="15325" end="15325">(</OP-LEFT-PAREN>
                    <expr line1="178" col1="18" line2="178" col2="32" start="15326" end="15340">
                      <expr line1="178" col1="18" line2="178" col2="26" start="15326" end="15334">
                        <SYMBOL_FUNCTION_CALL line1="178" col1="18" line2="178" col2="26" start="15326" end="15334">as.matrix</SYMBOL_FUNCTION_CALL>
                      </expr>
                      <OP-LEFT-PAREN line1="178" col1="27" line2="178" col2="27" start="15335" end="15335">(</OP-LEFT-PAREN>
                      <expr line1="178" col1="28" line2="178" col2="31" start="15336" end="15339">
                        <SYMBOL line1="178" col1="28" line2="178" col2="31" start="15336" end="15339">fpkm</SYMBOL>
                      </expr>
                      <OP-RIGHT-PAREN line1="178" col1="32" line2="178" col2="32" start="15340" end="15340">)</OP-RIGHT-PAREN>
                    </expr>
                    <OP-RIGHT-PAREN line1="178" col1="33" line2="178" col2="33" start="15341" end="15341">)</OP-RIGHT-PAREN>
                  </expr>
                  <OP-RIGHT-PAREN line1="178" col1="34" line2="178" col2="34" start="15342" end="15342">)</OP-RIGHT-PAREN>
                </expr>
                <OP-MINUS line1="178" col1="36" line2="178" col2="36" start="15344" end="15344">-</OP-MINUS>
                <expr line1="178" col1="38" line2="178" col2="59" start="15346" end="15367">
                  <expr line1="178" col1="38" line2="178" col2="40" start="15346" end="15348">
                    <SYMBOL_FUNCTION_CALL line1="178" col1="38" line2="178" col2="40" start="15346" end="15348">log</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="178" col1="41" line2="178" col2="41" start="15349" end="15349">(</OP-LEFT-PAREN>
                  <expr line1="178" col1="42" line2="178" col2="58" start="15350" end="15366">
                    <expr line1="178" col1="42" line2="178" col2="53" start="15350" end="15361">
                      <SYMBOL line1="178" col1="42" line2="178" col2="53" start="15350" end="15361">margin.stats</SYMBOL>
                    </expr>
                    <LBB line1="178" col1="54" line2="178" col2="55" start="15362" end="15363">[[</LBB>
                    <expr line1="178" col1="56" line2="178" col2="56" start="15364" end="15364">
                      <NUM_CONST line1="178" col1="56" line2="178" col2="56" start="15364" end="15364">1</NUM_CONST>
                    </expr>
                    <OP-RIGHT-BRACKET line1="178" col1="57" line2="178" col2="57" start="15365" end="15365">]</OP-RIGHT-BRACKET>
                    <OP-RIGHT-BRACKET line1="178" col1="58" line2="178" col2="58" start="15366" end="15366">]</OP-RIGHT-BRACKET>
                  </expr>
                  <OP-RIGHT-PAREN line1="178" col1="59" line2="178" col2="59" start="15367" end="15367">)</OP-RIGHT-PAREN>
                </expr>
              </expr>
              <OP-RIGHT-PAREN line1="178" col1="60" line2="178" col2="60" start="15368" end="15368">)</OP-RIGHT-PAREN>
            </expr>
            <OP-PLUS line1="178" col1="62" line2="178" col2="62" start="15370" end="15370">+</OP-PLUS>
            <expr line1="178" col1="64" line2="178" col2="71" start="15372" end="15379">
              <expr line1="178" col1="64" line2="178" col2="66" start="15372" end="15374">
                <SYMBOL_FUNCTION_CALL line1="178" col1="64" line2="178" col2="66" start="15372" end="15374">log</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="178" col1="67" line2="178" col2="67" start="15375" end="15375">(</OP-LEFT-PAREN>
              <expr line1="178" col1="68" line2="178" col2="70" start="15376" end="15378">
                <NUM_CONST line1="178" col1="68" line2="178" col2="70" start="15376" end="15378">1e6</NUM_CONST>
              </expr>
              <OP-RIGHT-PAREN line1="178" col1="71" line2="178" col2="71" start="15379" end="15379">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="178" col1="73" line2="178" col2="73" start="15381" end="15381">)</OP-RIGHT-PAREN>
        </expr>
        <OP-RIGHT-BRACE line1="179" col1="1" line2="179" col2="1" start="15395" end="15395">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <expr line1="181" col1="1" line2="183" col2="1" start="15567" end="15739">
    <expr line1="181" col1="1" line2="181" col2="17" start="15567" end="15583">
      <SYMBOL line1="181" col1="1" line2="181" col2="17" start="15567" end="15583">.countToEffCounts</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="181" col1="19" line2="181" col2="20" start="15585" end="15586">&lt;-</LEFT_ASSIGN>
    <expr line1="181" col1="22" line2="183" col2="1" start="15588" end="15739">
      <FUNCTION line1="181" col1="22" line2="181" col2="29" start="15588" end="15595">function</FUNCTION>
      <OP-LEFT-PAREN line1="181" col1="30" line2="181" col2="30" start="15596" end="15596">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="181" col1="31" line2="181" col2="36" start="15597" end="15602">counts</SYMBOL_FORMALS>
      <OP-COMMA line1="181" col1="37" line2="181" col2="37" start="15603" end="15603">,</OP-COMMA>
      <SYMBOL_FORMALS line1="181" col1="39" line2="181" col2="41" start="15605" end="15607">len</SYMBOL_FORMALS>
      <OP-COMMA line1="181" col1="42" line2="181" col2="42" start="15608" end="15608">,</OP-COMMA>
      <SYMBOL_FORMALS line1="181" col1="44" line2="181" col2="50" start="15610" end="15616">eff_len</SYMBOL_FORMALS>
      <OP-RIGHT-PAREN line1="181" col1="51" line2="181" col2="51" start="15617" end="15617">)</OP-RIGHT-PAREN>
      <expr line1="181" col1="53" line2="183" col2="1" start="15619" end="15739">
        <OP-LEFT-BRACE line1="181" col1="53" line2="181" col2="53" start="15619" end="15619">{</OP-LEFT-BRACE>
        <expr line1="182" col1="5" line2="182" col2="28" start="15657" end="15680">
          <expr line1="182" col1="5" line2="182" col2="10" start="15657" end="15662">
            <SYMBOL line1="182" col1="5" line2="182" col2="10" start="15657" end="15662">counts</SYMBOL>
          </expr>
          <OP-STAR line1="182" col1="12" line2="182" col2="12" start="15664" end="15664">*</OP-STAR>
          <expr line1="182" col1="14" line2="182" col2="28" start="15666" end="15680">
            <OP-LEFT-PAREN line1="182" col1="14" line2="182" col2="14" start="15666" end="15666">(</OP-LEFT-PAREN>
            <expr line1="182" col1="15" line2="182" col2="27" start="15667" end="15679">
              <expr line1="182" col1="15" line2="182" col2="17" start="15667" end="15669">
                <SYMBOL line1="182" col1="15" line2="182" col2="17" start="15667" end="15669">len</SYMBOL>
              </expr>
              <OP-SLASH line1="182" col1="19" line2="182" col2="19" start="15671" end="15671">/</OP-SLASH>
              <expr line1="182" col1="21" line2="182" col2="27" start="15673" end="15679">
                <SYMBOL line1="182" col1="21" line2="182" col2="27" start="15673" end="15679">eff_len</SYMBOL>
              </expr>
            </expr>
            <OP-RIGHT-PAREN line1="182" col1="28" line2="182" col2="28" start="15680" end="15680">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <OP-RIGHT-BRACE line1="183" col1="1" line2="183" col2="1" start="15739" end="15739">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <COMMENT line1="186" col1="1" line2="186" col2="37" start="15997" end="16033">#' Calculate counts per million (CPM)</COMMENT>
  <COMMENT line1="187" col1="1" line2="187" col2="2" start="16083" end="16084">#'</COMMENT>
  <COMMENT line1="188" col1="1" line2="188" col2="64" start="16169" end="16232">#' Calculate count-per-million (CPM) values from the count data.</COMMENT>
  <COMMENT line1="189" col1="1" line2="189" col2="2" start="16255" end="16256">#'</COMMENT>
  <COMMENT line1="190" col1="1" line2="190" col2="54" start="16341" end="16394">#' @param object an \code{SingleCellExperiment} object</COMMENT>
  <COMMENT line1="191" col1="1" line2="191" col2="62" start="16427" end="16488">#' @param use.size.factors a logical scalar specifying whether</COMMENT>
  <COMMENT line1="192" col1="1" line2="192" col2="65" start="16513" end="16577">#' the size factors should be used to construct effective library</COMMENT>
  <COMMENT line1="193" col1="1" line2="193" col2="62" start="16599" end="16660">#' sizes, or if the library size should be directly defined as</COMMENT>
  <COMMENT line1="194" col1="1" line2="194" col2="35" start="16685" end="16719">#' the sum of counts for each cell.</COMMENT>
  <COMMENT line1="195" col1="1" line2="195" col2="2" start="16771" end="16772">#'</COMMENT>
  <COMMENT line1="196" col1="1" line2="196" col2="32" start="16857" end="16888">#' @return Matrix of CPM values.</COMMENT>
  <COMMENT line1="197" col1="1" line2="197" col2="10" start="16943" end="16952">#' @export</COMMENT>
  <COMMENT line1="198" col1="1" line2="198" col2="12" start="17029" end="17040">#' @examples</COMMENT>
  <COMMENT line1="199" col1="1" line2="199" col2="28" start="17115" end="17142">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="200" col1="1" line2="200" col2="31" start="17201" end="17231">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="201" col1="1" line2="201" col2="39" start="17287" end="17325">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="202" col1="1" line2="202" col2="77" start="17373" end="17449">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="203" col1="1" line2="203" col2="74" start="17459" end="17532">#' cpm(example_sce) &lt;- calculateCPM(example_sce, use.size.factors = FALSE)</COMMENT>
  <COMMENT line1="204" col1="1" line2="204" col2="2" start="17545" end="17546">#'</COMMENT>
  <expr line1="205" col1="1" line2="242" col2="1" start="17631" end="20813">
    <expr line1="205" col1="1" line2="205" col2="12" start="17631" end="17642">
      <SYMBOL line1="205" col1="1" line2="205" col2="12" start="17631" end="17642">calculateCPM</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="205" col1="14" line2="205" col2="15" start="17644" end="17645">&lt;-</LEFT_ASSIGN>
    <expr line1="205" col1="17" line2="242" col2="1" start="17647" end="20813">
      <FUNCTION line1="205" col1="17" line2="205" col2="24" start="17647" end="17654">function</FUNCTION>
      <OP-LEFT-PAREN line1="205" col1="25" line2="205" col2="25" start="17655" end="17655">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="205" col1="26" line2="205" col2="31" start="17656" end="17661">object</SYMBOL_FORMALS>
      <OP-COMMA line1="205" col1="32" line2="205" col2="32" start="17662" end="17662">,</OP-COMMA>
      <SYMBOL_FORMALS line1="205" col1="34" line2="205" col2="49" start="17664" end="17679">use.size.factors</SYMBOL_FORMALS>
      <EQ_FORMALS line1="205" col1="51" line2="205" col2="51" start="17681" end="17681">=</EQ_FORMALS>
      <expr line1="205" col1="53" line2="205" col2="56" start="17683" end="17686">
        <NUM_CONST line1="205" col1="53" line2="205" col2="56" start="17683" end="17686">TRUE</NUM_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="205" col1="57" line2="205" col2="57" start="17687" end="17687">)</OP-RIGHT-PAREN>
      <expr line1="205" col1="59" line2="242" col2="1" start="17689" end="20813">
        <OP-LEFT-BRACE line1="205" col1="59" line2="205" col2="59" start="17689" end="17689">{</OP-LEFT-BRACE>
        <expr line1="206" col1="5" line2="207" col2="54" start="17721" end="17856">
          <IF line1="206" col1="5" line2="206" col2="6" start="17721" end="17722">if</IF>
          <OP-LEFT-PAREN line1="206" col1="8" line2="206" col2="8" start="17724" end="17724">(</OP-LEFT-PAREN>
          <expr line1="206" col1="10" line2="206" col2="53" start="17726" end="17769">
            <OP-EXCLAMATION line1="206" col1="10" line2="206" col2="10" start="17726" end="17726">!</OP-EXCLAMATION>
            <expr line1="206" col1="11" line2="206" col2="53" start="17727" end="17769">
              <expr line1="206" col1="11" line2="206" col2="21" start="17727" end="17737">
                <SYMBOL_PACKAGE line1="206" col1="11" line2="206" col2="17" start="17727" end="17733">methods</SYMBOL_PACKAGE>
                <NS_GET line1="206" col1="18" line2="206" col2="19" start="17734" end="17735">::</NS_GET>
                <SYMBOL_FUNCTION_CALL line1="206" col1="20" line2="206" col2="21" start="17736" end="17737">is</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="206" col1="22" line2="206" col2="22" start="17738" end="17738">(</OP-LEFT-PAREN>
              <expr line1="206" col1="23" line2="206" col2="28" start="17739" end="17744">
                <SYMBOL line1="206" col1="23" line2="206" col2="28" start="17739" end="17744">object</SYMBOL>
              </expr>
              <OP-COMMA line1="206" col1="29" line2="206" col2="29" start="17745" end="17745">,</OP-COMMA>
              <expr line1="206" col1="31" line2="206" col2="52" start="17747" end="17768">
                <STR_CONST line1="206" col1="31" line2="206" col2="52" start="17747" end="17768">"SingleCellExperiment"</STR_CONST>
              </expr>
              <OP-RIGHT-PAREN line1="206" col1="53" line2="206" col2="53" start="17769" end="17769">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="206" col1="55" line2="206" col2="55" start="17771" end="17771">)</OP-RIGHT-PAREN>
          <expr line1="207" col1="9" line2="207" col2="54" start="17811" end="17856">
            <expr line1="207" col1="9" line2="207" col2="12" start="17811" end="17814">
              <SYMBOL_FUNCTION_CALL line1="207" col1="9" line2="207" col2="12" start="17811" end="17814">stop</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="207" col1="13" line2="207" col2="13" start="17815" end="17815">(</OP-LEFT-PAREN>
            <expr line1="207" col1="14" line2="207" col2="53" start="17816" end="17855">
              <STR_CONST line1="207" col1="14" line2="207" col2="53" start="17816" end="17855">"object must be an SingleCellExperiment"</STR_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="207" col1="54" line2="207" col2="54" start="17856" end="17856">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="208" col1="5" line2="208" col2="32" start="17893" end="17920">
          <expr line1="208" col1="5" line2="208" col2="14" start="17893" end="17902">
            <SYMBOL line1="208" col1="5" line2="208" col2="14" start="17893" end="17902">counts_mat</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="208" col1="16" line2="208" col2="17" start="17904" end="17905">&lt;-</LEFT_ASSIGN>
          <expr line1="208" col1="19" line2="208" col2="32" start="17907" end="17920">
            <expr line1="208" col1="19" line2="208" col2="24" start="17907" end="17912">
              <SYMBOL_FUNCTION_CALL line1="208" col1="19" line2="208" col2="24" start="17907" end="17912">counts</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="208" col1="25" line2="208" col2="25" start="17913" end="17913">(</OP-LEFT-PAREN>
            <expr line1="208" col1="26" line2="208" col2="31" start="17914" end="17919">
              <SYMBOL line1="208" col1="26" line2="208" col2="31" start="17914" end="17919">object</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="208" col1="32" line2="208" col2="32" start="17920" end="17920">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="209" col1="5" line2="209" col2="72" start="17979" end="18046">
          <expr line1="209" col1="5" line2="209" col2="14" start="17979" end="17988">
            <SYMBOL line1="209" col1="5" line2="209" col2="14" start="17979" end="17988">subset_row</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="209" col1="16" line2="209" col2="17" start="17990" end="17991">&lt;-</LEFT_ASSIGN>
          <expr line1="209" col1="19" line2="209" col2="72" start="17993" end="18046">
            <expr line1="209" col1="19" line2="209" col2="31" start="17993" end="18005">
              <SYMBOL_FUNCTION_CALL line1="209" col1="19" line2="209" col2="31" start="17993" end="18005">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="209" col1="32" line2="209" col2="32" start="18006" end="18006">(</OP-LEFT-PAREN>
            <expr line1="209" col1="33" line2="209" col2="36" start="18007" end="18010">
              <NULL_CONST line1="209" col1="33" line2="209" col2="36" start="18007" end="18010">NULL</NULL_CONST>
            </expr>
            <OP-COMMA line1="209" col1="37" line2="209" col2="37" start="18011" end="18011">,</OP-COMMA>
            <SYMBOL_SUB line1="209" col1="39" line2="209" col2="44" start="18013" end="18018">target</SYMBOL_SUB>
            <EQ_SUB line1="209" col1="46" line2="209" col2="46" start="18020" end="18020">=</EQ_SUB>
            <expr line1="209" col1="48" line2="209" col2="57" start="18022" end="18031">
              <SYMBOL line1="209" col1="48" line2="209" col2="57" start="18022" end="18031">counts_mat</SYMBOL>
            </expr>
            <OP-COMMA line1="209" col1="58" line2="209" col2="58" start="18032" end="18032">,</OP-COMMA>
            <SYMBOL_SUB line1="209" col1="60" line2="209" col2="64" start="18034" end="18038">byrow</SYMBOL_SUB>
            <EQ_SUB line1="209" col1="66" line2="209" col2="66" start="18040" end="18040">=</EQ_SUB>
            <expr line1="209" col1="68" line2="209" col2="71" start="18042" end="18045">
              <NUM_CONST line1="209" col1="68" line2="209" col2="71" start="18042" end="18045">TRUE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="209" col1="72" line2="209" col2="72" start="18046" end="18046">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="210" col1="5" line2="211" col2="49" start="18065" end="18195">
          <expr line1="210" col1="5" line2="210" col2="16" start="18065" end="18076">
            <SYMBOL line1="210" col1="5" line2="210" col2="16" start="18065" end="18076">margin.stats</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="210" col1="18" line2="210" col2="19" start="18078" end="18079">&lt;-</LEFT_ASSIGN>
          <expr line1="210" col1="21" line2="211" col2="49" start="18081" end="18195">
            <expr line1="210" col1="21" line2="210" col2="25" start="18081" end="18085">
              <SYMBOL_FUNCTION_CALL line1="210" col1="21" line2="210" col2="25" start="18081" end="18085">.Call</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="210" col1="26" line2="210" col2="26" start="18086" end="18086">(</OP-LEFT-PAREN>
            <expr line1="210" col1="27" line2="210" col2="44" start="18087" end="18104">
              <SYMBOL line1="210" col1="27" line2="210" col2="44" start="18087" end="18104">cxx_margin_summary</SYMBOL>
            </expr>
            <OP-COMMA line1="210" col1="45" line2="210" col2="45" start="18105" end="18105">,</OP-COMMA>
            <expr line1="210" col1="47" line2="210" col2="56" start="18107" end="18116">
              <SYMBOL line1="210" col1="47" line2="210" col2="56" start="18107" end="18116">counts_mat</SYMBOL>
            </expr>
            <OP-COMMA line1="210" col1="57" line2="210" col2="57" start="18117" end="18117">,</OP-COMMA>
            <expr line1="210" col1="59" line2="210" col2="59" start="18119" end="18119">
              <NUM_CONST line1="210" col1="59" line2="210" col2="59" start="18119" end="18119">0</NUM_CONST>
            </expr>
            <OP-COMMA line1="210" col1="60" line2="210" col2="60" start="18120" end="18120">,</OP-COMMA>
            <expr line1="211" col1="27" line2="211" col2="41" start="18173" end="18187">
              <expr line1="211" col1="27" line2="211" col2="36" start="18173" end="18182">
                <SYMBOL line1="211" col1="27" line2="211" col2="36" start="18173" end="18182">subset_row</SYMBOL>
              </expr>
              <OP-MINUS line1="211" col1="38" line2="211" col2="38" start="18184" end="18184">-</OP-MINUS>
              <expr line1="211" col1="40" line2="211" col2="41" start="18186" end="18187">
                <NUM_CONST line1="211" col1="40" line2="211" col2="41" start="18186" end="18187">1L</NUM_CONST>
              </expr>
            </expr>
            <OP-COMMA line1="211" col1="42" line2="211" col2="42" start="18188" end="18188">,</OP-COMMA>
            <expr line1="211" col1="44" line2="211" col2="48" start="18190" end="18194">
              <NUM_CONST line1="211" col1="44" line2="211" col2="48" start="18190" end="18194">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="211" col1="49" line2="211" col2="49" start="18195" end="18195">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="212" col1="5" line2="222" col2="5" start="18237" end="19097">
          <IF line1="212" col1="5" line2="212" col2="6" start="18237" end="18238">if</IF>
          <OP-LEFT-PAREN line1="212" col1="8" line2="212" col2="8" start="18240" end="18240">(</OP-LEFT-PAREN>
          <expr line1="212" col1="9" line2="212" col2="24" start="18241" end="18256">
            <SYMBOL line1="212" col1="9" line2="212" col2="24" start="18241" end="18256">use.size.factors</SYMBOL>
          </expr>
          <OP-RIGHT-PAREN line1="212" col1="25" line2="212" col2="25" start="18257" end="18257">)</OP-RIGHT-PAREN>
          <expr line1="212" col1="27" line2="219" col2="5" start="18259" end="18839">
            <OP-LEFT-BRACE line1="212" col1="27" line2="212" col2="27" start="18259" end="18259">{</OP-LEFT-BRACE>
            <expr line1="213" col1="9" line2="213" col2="43" start="18327" end="18361">
              <expr line1="213" col1="9" line2="213" col2="15" start="18327" end="18333">
                <SYMBOL line1="213" col1="9" line2="213" col2="15" start="18327" end="18333">sf.list</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="213" col1="17" line2="213" col2="18" start="18335" end="18336">&lt;-</LEFT_ASSIGN>
              <expr line1="213" col1="20" line2="213" col2="43" start="18338" end="18361">
                <expr line1="213" col1="20" line2="213" col2="35" start="18338" end="18353">
                  <SYMBOL_FUNCTION_CALL line1="213" col1="20" line2="213" col2="35" start="18338" end="18353">.get_all_sf_sets</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="213" col1="36" line2="213" col2="36" start="18354" end="18354">(</OP-LEFT-PAREN>
                <expr line1="213" col1="37" line2="213" col2="42" start="18355" end="18360">
                  <SYMBOL line1="213" col1="37" line2="213" col2="42" start="18355" end="18360">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="213" col1="43" line2="213" col2="43" start="18361" end="18361">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <expr line1="214" col1="9" line2="218" col2="9" start="18413" end="18757">
              <IF line1="214" col1="9" line2="214" col2="10" start="18413" end="18414">if</IF>
              <OP-LEFT-PAREN line1="214" col1="12" line2="214" col2="12" start="18416" end="18416">(</OP-LEFT-PAREN>
              <expr line1="214" col1="13" line2="214" col2="46" start="18417" end="18450">
                <expr line1="214" col1="13" line2="214" col2="19" start="18417" end="18423">
                  <SYMBOL_FUNCTION_CALL line1="214" col1="13" line2="214" col2="19" start="18417" end="18423">is.null</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="214" col1="20" line2="214" col2="20" start="18424" end="18424">(</OP-LEFT-PAREN>
                <expr line1="214" col1="21" line2="214" col2="45" start="18425" end="18449">
                  <expr line1="214" col1="21" line2="214" col2="40" start="18425" end="18444">
                    <expr line1="214" col1="21" line2="214" col2="27" start="18425" end="18431">
                      <SYMBOL line1="214" col1="21" line2="214" col2="27" start="18425" end="18431">sf.list</SYMBOL>
                    </expr>
                    <OP-DOLLAR line1="214" col1="28" line2="214" col2="28" start="18432" end="18432">$</OP-DOLLAR>
                    <SYMBOL line1="214" col1="29" line2="214" col2="40" start="18433" end="18444">size.factors</SYMBOL>
                  </expr>
                  <LBB line1="214" col1="41" line2="214" col2="42" start="18445" end="18446">[[</LBB>
                  <expr line1="214" col1="43" line2="214" col2="43" start="18447" end="18447">
                    <NUM_CONST line1="214" col1="43" line2="214" col2="43" start="18447" end="18447">1</NUM_CONST>
                  </expr>
                  <OP-RIGHT-BRACKET line1="214" col1="44" line2="214" col2="44" start="18448" end="18448">]</OP-RIGHT-BRACKET>
                  <OP-RIGHT-BRACKET line1="214" col1="45" line2="214" col2="45" start="18449" end="18449">]</OP-RIGHT-BRACKET>
                </expr>
                <OP-RIGHT-PAREN line1="214" col1="46" line2="214" col2="46" start="18450" end="18450">)</OP-RIGHT-PAREN>
              </expr>
              <OP-RIGHT-PAREN line1="214" col1="47" line2="214" col2="47" start="18451" end="18451">)</OP-RIGHT-PAREN>
              <expr line1="214" col1="49" line2="218" col2="9" start="18453" end="18757">
                <OP-LEFT-BRACE line1="214" col1="49" line2="214" col2="49" start="18453" end="18453">{</OP-LEFT-BRACE>
                <expr line1="215" col1="13" line2="216" col2="49" start="18503" end="18625">
                  <expr line1="215" col1="13" line2="215" col2="19" start="18503" end="18509">
                    <SYMBOL_FUNCTION_CALL line1="215" col1="13" line2="215" col2="19" start="18503" end="18509">warning</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="215" col1="20" line2="215" col2="20" start="18510" end="18510">(</OP-LEFT-PAREN>
                  <expr line1="215" col1="21" line2="216" col2="48" start="18511" end="18624">
                    <STR_CONST line1="215" col1="21" line2="216" col2="48" start="18511" end="18624">"size factors requested but not specified, 
                    using library sizes instead"</STR_CONST>
                  </expr>
                  <OP-RIGHT-PAREN line1="216" col1="49" line2="216" col2="49" start="18625" end="18625">)</OP-RIGHT-PAREN>
                </expr>
                <expr line1="217" col1="13" line2="217" col2="58" start="18675" end="18720">
                  <expr line1="217" col1="13" line2="217" col2="37" start="18675" end="18699">
                    <expr line1="217" col1="13" line2="217" col2="32" start="18675" end="18694">
                      <expr line1="217" col1="13" line2="217" col2="19" start="18675" end="18681">
                        <SYMBOL line1="217" col1="13" line2="217" col2="19" start="18675" end="18681">sf.list</SYMBOL>
                      </expr>
                      <OP-DOLLAR line1="217" col1="20" line2="217" col2="20" start="18682" end="18682">$</OP-DOLLAR>
                      <SYMBOL line1="217" col1="21" line2="217" col2="32" start="18683" end="18694">size.factors</SYMBOL>
                    </expr>
                    <LBB line1="217" col1="33" line2="217" col2="34" start="18695" end="18696">[[</LBB>
                    <expr line1="217" col1="35" line2="217" col2="35" start="18697" end="18697">
                      <NUM_CONST line1="217" col1="35" line2="217" col2="35" start="18697" end="18697">1</NUM_CONST>
                    </expr>
                    <OP-RIGHT-BRACKET line1="217" col1="36" line2="217" col2="36" start="18698" end="18698">]</OP-RIGHT-BRACKET>
                    <OP-RIGHT-BRACKET line1="217" col1="37" line2="217" col2="37" start="18699" end="18699">]</OP-RIGHT-BRACKET>
                  </expr>
                  <LEFT_ASSIGN line1="217" col1="39" line2="217" col2="40" start="18701" end="18702">&lt;-</LEFT_ASSIGN>
                  <expr line1="217" col1="42" line2="217" col2="58" start="18704" end="18720">
                    <expr line1="217" col1="42" line2="217" col2="53" start="18704" end="18715">
                      <SYMBOL line1="217" col1="42" line2="217" col2="53" start="18704" end="18715">margin.stats</SYMBOL>
                    </expr>
                    <LBB line1="217" col1="54" line2="217" col2="55" start="18716" end="18717">[[</LBB>
                    <expr line1="217" col1="56" line2="217" col2="56" start="18718" end="18718">
                      <NUM_CONST line1="217" col1="56" line2="217" col2="56" start="18718" end="18718">1</NUM_CONST>
                    </expr>
                    <OP-RIGHT-BRACKET line1="217" col1="57" line2="217" col2="57" start="18719" end="18719">]</OP-RIGHT-BRACKET>
                    <OP-RIGHT-BRACKET line1="217" col1="58" line2="217" col2="58" start="18720" end="18720">]</OP-RIGHT-BRACKET>
                  </expr>
                </expr>
                <OP-RIGHT-BRACE line1="218" col1="9" line2="218" col2="9" start="18757" end="18757">}</OP-RIGHT-BRACE>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="219" col1="5" line2="219" col2="5" start="18839" end="18839">}</OP-RIGHT-BRACE>
          </expr>
          <ELSE line1="219" col1="7" line2="219" col2="10" start="18841" end="18844">else</ELSE>
          <expr line1="219" col1="12" line2="222" col2="5" start="18846" end="19097">
            <OP-LEFT-BRACE line1="219" col1="12" line2="219" col2="12" start="18846" end="18846">{</OP-LEFT-BRACE>
            <expr line1="220" col1="9" line2="221" col2="53" start="18929" end="19059">
              <expr line1="220" col1="9" line2="220" col2="15" start="18929" end="18935">
                <SYMBOL line1="220" col1="9" line2="220" col2="15" start="18929" end="18935">sf.list</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="220" col1="17" line2="220" col2="18" start="18937" end="18938">&lt;-</LEFT_ASSIGN>
              <expr line1="220" col1="20" line2="221" col2="53" start="18940" end="19059">
                <expr line1="220" col1="20" line2="220" col2="23" start="18940" end="18943">
                  <SYMBOL_FUNCTION_CALL line1="220" col1="20" line2="220" col2="23" start="18940" end="18943">list</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="220" col1="24" line2="220" col2="24" start="18944" end="18944">(</OP-LEFT-PAREN>
                <SYMBOL_SUB line1="220" col1="25" line2="220" col2="36" start="18945" end="18956">size.factors</SYMBOL_SUB>
                <EQ_SUB line1="220" col1="38" line2="220" col2="38" start="18958" end="18958">=</EQ_SUB>
                <expr line1="220" col1="40" line2="220" col2="62" start="18960" end="18982">
                  <expr line1="220" col1="40" line2="220" col2="43" start="18960" end="18963">
                    <SYMBOL_FUNCTION_CALL line1="220" col1="40" line2="220" col2="43" start="18960" end="18963">list</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="220" col1="44" line2="220" col2="44" start="18964" end="18964">(</OP-LEFT-PAREN>
                  <expr line1="220" col1="45" line2="220" col2="61" start="18965" end="18981">
                    <expr line1="220" col1="45" line2="220" col2="56" start="18965" end="18976">
                      <SYMBOL line1="220" col1="45" line2="220" col2="56" start="18965" end="18976">margin.stats</SYMBOL>
                    </expr>
                    <LBB line1="220" col1="57" line2="220" col2="58" start="18977" end="18978">[[</LBB>
                    <expr line1="220" col1="59" line2="220" col2="59" start="18979" end="18979">
                      <NUM_CONST line1="220" col1="59" line2="220" col2="59" start="18979" end="18979">1</NUM_CONST>
                    </expr>
                    <OP-RIGHT-BRACKET line1="220" col1="60" line2="220" col2="60" start="18980" end="18980">]</OP-RIGHT-BRACKET>
                    <OP-RIGHT-BRACKET line1="220" col1="61" line2="220" col2="61" start="18981" end="18981">]</OP-RIGHT-BRACKET>
                  </expr>
                  <OP-RIGHT-PAREN line1="220" col1="62" line2="220" col2="62" start="18982" end="18982">)</OP-RIGHT-PAREN>
                </expr>
                <OP-COMMA line1="220" col1="63" line2="220" col2="63" start="18983" end="18983">,</OP-COMMA>
                <SYMBOL_SUB line1="221" col1="25" line2="221" col2="29" start="19031" end="19035">index</SYMBOL_SUB>
                <EQ_SUB line1="221" col1="31" line2="221" col2="31" start="19037" end="19037">=</EQ_SUB>
                <expr line1="221" col1="33" line2="221" col2="52" start="19039" end="19058">
                  <expr line1="221" col1="33" line2="221" col2="35" start="19039" end="19041">
                    <SYMBOL_FUNCTION_CALL line1="221" col1="33" line2="221" col2="35" start="19039" end="19041">rep</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="221" col1="36" line2="221" col2="36" start="19042" end="19042">(</OP-LEFT-PAREN>
                  <expr line1="221" col1="37" line2="221" col2="37" start="19043" end="19043">
                    <NUM_CONST line1="221" col1="37" line2="221" col2="37" start="19043" end="19043">1</NUM_CONST>
                  </expr>
                  <OP-COMMA line1="221" col1="38" line2="221" col2="38" start="19044" end="19044">,</OP-COMMA>
                  <expr line1="221" col1="40" line2="221" col2="51" start="19046" end="19057">
                    <expr line1="221" col1="40" line2="221" col2="43" start="19046" end="19049">
                      <SYMBOL_FUNCTION_CALL line1="221" col1="40" line2="221" col2="43" start="19046" end="19049">nrow</SYMBOL_FUNCTION_CALL>
                    </expr>
                    <OP-LEFT-PAREN line1="221" col1="44" line2="221" col2="44" start="19050" end="19050">(</OP-LEFT-PAREN>
                    <expr line1="221" col1="45" line2="221" col2="50" start="19051" end="19056">
                      <SYMBOL line1="221" col1="45" line2="221" col2="50" start="19051" end="19056">object</SYMBOL>
                    </expr>
                    <OP-RIGHT-PAREN line1="221" col1="51" line2="221" col2="51" start="19057" end="19057">)</OP-RIGHT-PAREN>
                  </expr>
                  <OP-RIGHT-PAREN line1="221" col1="52" line2="221" col2="52" start="19058" end="19058">)</OP-RIGHT-PAREN>
                </expr>
                <OP-RIGHT-PAREN line1="221" col1="53" line2="221" col2="53" start="19059" end="19059">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="222" col1="5" line2="222" col2="5" start="19097" end="19097">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <COMMENT line1="224" col1="5" line2="224" col2="51" start="19269" end="19315"># Scaling the size factors to the library size.</COMMENT>
        <expr line1="225" col1="5" line2="225" col2="25" start="19355" end="19375">
          <expr line1="225" col1="5" line2="225" col2="11" start="19355" end="19361">
            <SYMBOL line1="225" col1="5" line2="225" col2="11" start="19355" end="19361">cpm_mat</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="225" col1="13" line2="225" col2="14" start="19363" end="19364">&lt;-</LEFT_ASSIGN>
          <expr line1="225" col1="16" line2="225" col2="25" start="19366" end="19375">
            <SYMBOL line1="225" col1="16" line2="225" col2="25" start="19366" end="19375">counts_mat</SYMBOL>
          </expr>
        </expr>
        <expr line1="226" col1="5" line2="226" col2="44" start="19441" end="19480">
          <expr line1="226" col1="5" line2="226" col2="17" start="19441" end="19453">
            <SYMBOL line1="226" col1="5" line2="226" col2="17" start="19441" end="19453">mean.lib.size</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="226" col1="19" line2="226" col2="20" start="19455" end="19456">&lt;-</LEFT_ASSIGN>
          <expr line1="226" col1="22" line2="226" col2="44" start="19458" end="19480">
            <expr line1="226" col1="22" line2="226" col2="25" start="19458" end="19461">
              <SYMBOL_FUNCTION_CALL line1="226" col1="22" line2="226" col2="25" start="19458" end="19461">mean</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="226" col1="26" line2="226" col2="26" start="19462" end="19462">(</OP-LEFT-PAREN>
            <expr line1="226" col1="27" line2="226" col2="43" start="19463" end="19479">
              <expr line1="226" col1="27" line2="226" col2="38" start="19463" end="19474">
                <SYMBOL line1="226" col1="27" line2="226" col2="38" start="19463" end="19474">margin.stats</SYMBOL>
              </expr>
              <LBB line1="226" col1="39" line2="226" col2="40" start="19475" end="19476">[[</LBB>
              <expr line1="226" col1="41" line2="226" col2="41" start="19477" end="19477">
                <NUM_CONST line1="226" col1="41" line2="226" col2="41" start="19477" end="19477">1</NUM_CONST>
              </expr>
              <OP-RIGHT-BRACKET line1="226" col1="42" line2="226" col2="42" start="19478" end="19478">]</OP-RIGHT-BRACKET>
              <OP-RIGHT-BRACKET line1="226" col1="43" line2="226" col2="43" start="19479" end="19479">]</OP-RIGHT-BRACKET>
            </expr>
            <OP-RIGHT-PAREN line1="226" col1="44" line2="226" col2="44" start="19480" end="19480">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="227" col1="5" line2="227" col2="61" start="19527" end="19583">
          <expr line1="227" col1="5" line2="227" col2="11" start="19527" end="19533">
            <SYMBOL line1="227" col1="5" line2="227" col2="11" start="19527" end="19533">by.type</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="227" col1="13" line2="227" col2="14" start="19535" end="19536">&lt;-</LEFT_ASSIGN>
          <expr line1="227" col1="16" line2="227" col2="61" start="19538" end="19583">
            <expr line1="227" col1="16" line2="227" col2="20" start="19538" end="19542">
              <SYMBOL_FUNCTION_CALL line1="227" col1="16" line2="227" col2="20" start="19538" end="19542">split</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="227" col1="21" line2="227" col2="21" start="19543" end="19543">(</OP-LEFT-PAREN>
            <expr line1="227" col1="22" line2="227" col2="45" start="19544" end="19567">
              <expr line1="227" col1="22" line2="227" col2="30" start="19544" end="19552">
                <SYMBOL_FUNCTION_CALL line1="227" col1="22" line2="227" col2="30" start="19544" end="19552">seq_along</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="227" col1="31" line2="227" col2="31" start="19553" end="19553">(</OP-LEFT-PAREN>
              <expr line1="227" col1="32" line2="227" col2="44" start="19554" end="19566">
                <expr line1="227" col1="32" line2="227" col2="38" start="19554" end="19560">
                  <SYMBOL line1="227" col1="32" line2="227" col2="38" start="19554" end="19560">sf.list</SYMBOL>
                </expr>
                <OP-DOLLAR line1="227" col1="39" line2="227" col2="39" start="19561" end="19561">$</OP-DOLLAR>
                <SYMBOL line1="227" col1="40" line2="227" col2="44" start="19562" end="19566">index</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="227" col1="45" line2="227" col2="45" start="19567" end="19567">)</OP-RIGHT-PAREN>
            </expr>
            <OP-COMMA line1="227" col1="46" line2="227" col2="46" start="19568" end="19568">,</OP-COMMA>
            <expr line1="227" col1="48" line2="227" col2="60" start="19570" end="19582">
              <expr line1="227" col1="48" line2="227" col2="54" start="19570" end="19576">
                <SYMBOL line1="227" col1="48" line2="227" col2="54" start="19570" end="19576">sf.list</SYMBOL>
              </expr>
              <OP-DOLLAR line1="227" col1="55" line2="227" col2="55" start="19577" end="19577">$</OP-DOLLAR>
              <SYMBOL line1="227" col1="56" line2="227" col2="60" start="19578" end="19582">index</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="227" col1="61" line2="227" col2="61" start="19583" end="19583">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="229" col1="5" line2="236" col2="5" start="19699" end="20301">
          <FOR line1="229" col1="5" line2="229" col2="7" start="19699" end="19701">for</FOR>
          <forcond line1="229" col1="9" line2="229" col2="33" start="19703" end="19727">
            <OP-LEFT-PAREN line1="229" col1="9" line2="229" col2="9" start="19703" end="19703">(</OP-LEFT-PAREN>
            <SYMBOL line1="229" col1="10" line2="229" col2="10" start="19704" end="19704">g</SYMBOL>
            <IN line1="229" col1="12" line2="229" col2="13" start="19706" end="19707">in</IN>
            <expr line1="229" col1="15" line2="229" col2="32" start="19709" end="19726">
              <expr line1="229" col1="15" line2="229" col2="23" start="19709" end="19717">
                <SYMBOL_FUNCTION_CALL line1="229" col1="15" line2="229" col2="23" start="19709" end="19717">seq_along</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="229" col1="24" line2="229" col2="24" start="19718" end="19718">(</OP-LEFT-PAREN>
              <expr line1="229" col1="25" line2="229" col2="31" start="19719" end="19725">
                <SYMBOL line1="229" col1="25" line2="229" col2="31" start="19719" end="19725">by.type</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="229" col1="32" line2="229" col2="32" start="19726" end="19726">)</OP-RIGHT-PAREN>
            </expr>
            <OP-RIGHT-PAREN line1="229" col1="33" line2="229" col2="33" start="19727" end="19727">)</OP-RIGHT-PAREN>
          </forcond>
          <expr line1="229" col1="35" line2="236" col2="5" start="19729" end="20301">
            <OP-LEFT-BRACE line1="229" col1="35" line2="229" col2="35" start="19729" end="19729">{</OP-LEFT-BRACE>
            <expr line1="230" col1="9" line2="230" col2="30" start="19789" end="19810">
              <expr line1="230" col1="9" line2="230" col2="14" start="19789" end="19794">
                <SYMBOL line1="230" col1="9" line2="230" col2="14" start="19789" end="19794">chosen</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="230" col1="16" line2="230" col2="17" start="19796" end="19797">&lt;-</LEFT_ASSIGN>
              <expr line1="230" col1="19" line2="230" col2="30" start="19799" end="19810">
                <expr line1="230" col1="19" line2="230" col2="25" start="19799" end="19805">
                  <SYMBOL line1="230" col1="19" line2="230" col2="25" start="19799" end="19805">by.type</SYMBOL>
                </expr>
                <LBB line1="230" col1="26" line2="230" col2="27" start="19806" end="19807">[[</LBB>
                <expr line1="230" col1="28" line2="230" col2="28" start="19808" end="19808">
                  <SYMBOL line1="230" col1="28" line2="230" col2="28" start="19808" end="19808">g</SYMBOL>
                </expr>
                <OP-RIGHT-BRACKET line1="230" col1="29" line2="230" col2="29" start="19809" end="19809">]</OP-RIGHT-BRACKET>
                <OP-RIGHT-BRACKET line1="230" col1="30" line2="230" col2="30" start="19810" end="19810">]</OP-RIGHT-BRACKET>
              </expr>
            </expr>
            <expr line1="231" col1="9" line2="231" col2="39" start="19875" end="19905">
              <expr line1="231" col1="9" line2="231" col2="10" start="19875" end="19876">
                <SYMBOL line1="231" col1="9" line2="231" col2="10" start="19875" end="19876">sf</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="231" col1="12" line2="231" col2="13" start="19878" end="19879">&lt;-</LEFT_ASSIGN>
              <expr line1="231" col1="15" line2="231" col2="39" start="19881" end="19905">
                <expr line1="231" col1="15" line2="231" col2="34" start="19881" end="19900">
                  <expr line1="231" col1="15" line2="231" col2="21" start="19881" end="19887">
                    <SYMBOL line1="231" col1="15" line2="231" col2="21" start="19881" end="19887">sf.list</SYMBOL>
                  </expr>
                  <OP-DOLLAR line1="231" col1="22" line2="231" col2="22" start="19888" end="19888">$</OP-DOLLAR>
                  <SYMBOL line1="231" col1="23" line2="231" col2="34" start="19889" end="19900">size.factors</SYMBOL>
                </expr>
                <LBB line1="231" col1="35" line2="231" col2="36" start="19901" end="19902">[[</LBB>
                <expr line1="231" col1="37" line2="231" col2="37" start="19903" end="19903">
                  <SYMBOL line1="231" col1="37" line2="231" col2="37" start="19903" end="19903">g</SYMBOL>
                </expr>
                <OP-RIGHT-BRACKET line1="231" col1="38" line2="231" col2="38" start="19904" end="19904">]</OP-RIGHT-BRACKET>
                <OP-RIGHT-BRACKET line1="231" col1="39" line2="231" col2="39" start="19905" end="19905">]</OP-RIGHT-BRACKET>
              </expr>
            </expr>
            <expr line1="232" col1="9" line2="232" col2="50" start="19961" end="20002">
              <expr line1="232" col1="9" line2="232" col2="17" start="19961" end="19969">
                <SYMBOL line1="232" col1="9" line2="232" col2="17" start="19961" end="19969">scaled.sf</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="232" col1="19" line2="232" col2="20" start="19971" end="19972">&lt;-</LEFT_ASSIGN>
              <expr line1="232" col1="22" line2="232" col2="50" start="19974" end="20002">
                <expr line1="232" col1="22" line2="232" col2="34" start="19974" end="19986">
                  <expr line1="232" col1="22" line2="232" col2="23" start="19974" end="19975">
                    <SYMBOL line1="232" col1="22" line2="232" col2="23" start="19974" end="19975">sf</SYMBOL>
                  </expr>
                  <OP-SLASH line1="232" col1="25" line2="232" col2="25" start="19977" end="19977">/</OP-SLASH>
                  <expr line1="232" col1="27" line2="232" col2="34" start="19979" end="19986">
                    <expr line1="232" col1="27" line2="232" col2="30" start="19979" end="19982">
                      <SYMBOL_FUNCTION_CALL line1="232" col1="27" line2="232" col2="30" start="19979" end="19982">mean</SYMBOL_FUNCTION_CALL>
                    </expr>
                    <OP-LEFT-PAREN line1="232" col1="31" line2="232" col2="31" start="19983" end="19983">(</OP-LEFT-PAREN>
                    <expr line1="232" col1="32" line2="232" col2="33" start="19984" end="19985">
                      <SYMBOL line1="232" col1="32" line2="232" col2="33" start="19984" end="19985">sf</SYMBOL>
                    </expr>
                    <OP-RIGHT-PAREN line1="232" col1="34" line2="232" col2="34" start="19986" end="19986">)</OP-RIGHT-PAREN>
                  </expr>
                </expr>
                <OP-STAR line1="232" col1="36" line2="232" col2="36" start="19988" end="19988">*</OP-STAR>
                <expr line1="232" col1="38" line2="232" col2="50" start="19990" end="20002">
                  <SYMBOL line1="232" col1="38" line2="232" col2="50" start="19990" end="20002">mean.lib.size</SYMBOL>
                </expr>
              </expr>
            </expr>
            <expr line1="233" col1="9" line2="235" col2="64" start="20047" end="20274">
              <expr line1="233" col1="9" line2="233" col2="24" start="20047" end="20062">
                <expr line1="233" col1="9" line2="233" col2="15" start="20047" end="20053">
                  <SYMBOL line1="233" col1="9" line2="233" col2="15" start="20047" end="20053">cpm_mat</SYMBOL>
                </expr>
                <OP-LEFT-BRACKET line1="233" col1="16" line2="233" col2="16" start="20054" end="20054">[</OP-LEFT-BRACKET>
                <expr line1="233" col1="17" line2="233" col2="22" start="20055" end="20060">
                  <SYMBOL line1="233" col1="17" line2="233" col2="22" start="20055" end="20060">chosen</SYMBOL>
                </expr>
                <OP-COMMA line1="233" col1="23" line2="233" col2="23" start="20061" end="20061">,</OP-COMMA>
                <OP-RIGHT-BRACKET line1="233" col1="24" line2="233" col2="24" start="20062" end="20062">]</OP-RIGHT-BRACKET>
              </expr>
              <LEFT_ASSIGN line1="233" col1="26" line2="233" col2="27" start="20064" end="20065">&lt;-</LEFT_ASSIGN>
              <expr line1="233" col1="29" line2="235" col2="64" start="20067" end="20274">
                <expr line1="233" col1="29" line2="233" col2="42" start="20067" end="20080">
                  <SYMBOL_FUNCTION_CALL line1="233" col1="29" line2="233" col2="42" start="20067" end="20080">.compute_exprs</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="233" col1="43" line2="233" col2="43" start="20081" end="20081">(</OP-LEFT-PAREN>
                <expr line1="234" col1="13" line2="234" col2="44" start="20137" end="20168">
                  <expr line1="234" col1="13" line2="234" col2="22" start="20137" end="20146">
                    <SYMBOL line1="234" col1="13" line2="234" col2="22" start="20137" end="20146">counts_mat</SYMBOL>
                  </expr>
                  <OP-LEFT-BRACKET line1="234" col1="23" line2="234" col2="23" start="20147" end="20147">[</OP-LEFT-BRACKET>
                  <expr line1="234" col1="24" line2="234" col2="29" start="20148" end="20153">
                    <SYMBOL line1="234" col1="24" line2="234" col2="29" start="20148" end="20153">chosen</SYMBOL>
                  </expr>
                  <OP-COMMA line1="234" col1="30" line2="234" col2="30" start="20154" end="20154">,</OP-COMMA>
                  <OP-COMMA line1="234" col1="31" line2="234" col2="31" start="20155" end="20155">,</OP-COMMA>
                  <SYMBOL_SUB line1="234" col1="32" line2="234" col2="35" start="20156" end="20159">drop</SYMBOL_SUB>
                  <EQ_SUB line1="234" col1="37" line2="234" col2="37" start="20161" end="20161">=</EQ_SUB>
                  <expr line1="234" col1="39" line2="234" col2="43" start="20163" end="20167">
                    <NUM_CONST line1="234" col1="39" line2="234" col2="43" start="20163" end="20167">FALSE</NUM_CONST>
                  </expr>
                  <OP-RIGHT-BRACKET line1="234" col1="44" line2="234" col2="44" start="20168" end="20168">]</OP-RIGHT-BRACKET>
                </expr>
                <OP-COMMA line1="234" col1="45" line2="234" col2="45" start="20169" end="20169">,</OP-COMMA>
                <expr line1="234" col1="47" line2="234" col2="48" start="20171" end="20172">
                  <SYMBOL line1="234" col1="47" line2="234" col2="48" start="20171" end="20172">sf</SYMBOL>
                </expr>
                <OP-COMMA line1="234" col1="49" line2="234" col2="49" start="20173" end="20173">,</OP-COMMA>
                <SYMBOL_SUB line1="234" col1="51" line2="234" col2="59" start="20175" end="20183">sf_to_use</SYMBOL_SUB>
                <EQ_SUB line1="234" col1="61" line2="234" col2="61" start="20185" end="20185">=</EQ_SUB>
                <expr line1="234" col1="63" line2="234" col2="66" start="20187" end="20190">
                  <NULL_CONST line1="234" col1="63" line2="234" col2="66" start="20187" end="20190">NULL</NULL_CONST>
                </expr>
                <OP-COMMA line1="234" col1="67" line2="234" col2="67" start="20191" end="20191">,</OP-COMMA>
                <SYMBOL_SUB line1="234" col1="69" line2="234" col2="71" start="20193" end="20195">log</SYMBOL_SUB>
                <EQ_SUB line1="234" col1="73" line2="234" col2="73" start="20197" end="20197">=</EQ_SUB>
                <expr line1="234" col1="75" line2="234" col2="79" start="20199" end="20203">
                  <NUM_CONST line1="234" col1="75" line2="234" col2="79" start="20199" end="20203">FALSE</NUM_CONST>
                </expr>
                <OP-COMMA line1="234" col1="80" line2="234" col2="80" start="20204" end="20204">,</OP-COMMA>
                <SYMBOL_SUB line1="235" col1="13" line2="235" col2="15" start="20223" end="20225">sum</SYMBOL_SUB>
                <EQ_SUB line1="235" col1="17" line2="235" col2="17" start="20227" end="20227">=</EQ_SUB>
                <expr line1="235" col1="19" line2="235" col2="23" start="20229" end="20233">
                  <NUM_CONST line1="235" col1="19" line2="235" col2="23" start="20229" end="20233">FALSE</NUM_CONST>
                </expr>
                <OP-COMMA line1="235" col1="24" line2="235" col2="24" start="20234" end="20234">,</OP-COMMA>
                <SYMBOL_SUB line1="235" col1="26" line2="235" col2="35" start="20236" end="20245">subset_row</SYMBOL_SUB>
                <EQ_SUB line1="235" col1="37" line2="235" col2="37" start="20247" end="20247">=</EQ_SUB>
                <expr line1="235" col1="39" line2="235" col2="42" start="20249" end="20252">
                  <NULL_CONST line1="235" col1="39" line2="235" col2="42" start="20249" end="20252">NULL</NULL_CONST>
                </expr>
                <OP-COMMA line1="235" col1="43" line2="235" col2="43" start="20253" end="20253">,</OP-COMMA>
                <SYMBOL_SUB line1="235" col1="46" line2="235" col2="59" start="20256" end="20269">logExprsOffset</SYMBOL_SUB>
                <EQ_SUB line1="235" col1="61" line2="235" col2="61" start="20271" end="20271">=</EQ_SUB>
                <expr line1="235" col1="63" line2="235" col2="63" start="20273" end="20273">
                  <NUM_CONST line1="235" col1="63" line2="235" col2="63" start="20273" end="20273">0</NUM_CONST>
                </expr>
                <OP-RIGHT-PAREN line1="235" col1="64" line2="235" col2="64" start="20274" end="20274">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="236" col1="5" line2="236" col2="5" start="20301" end="20301">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <COMMENT line1="238" col1="5" line2="238" col2="27" start="20473" end="20495"># Restoring attributes.</COMMENT>
        <expr line1="239" col1="5" line2="239" col2="41" start="20559" end="20595">
          <expr line1="239" col1="5" line2="239" col2="21" start="20559" end="20575">
            <expr line1="239" col1="5" line2="239" col2="12" start="20559" end="20566">
              <SYMBOL_FUNCTION_CALL line1="239" col1="5" line2="239" col2="12" start="20559" end="20566">rownames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="239" col1="13" line2="239" col2="13" start="20567" end="20567">(</OP-LEFT-PAREN>
            <expr line1="239" col1="14" line2="239" col2="20" start="20568" end="20574">
              <SYMBOL line1="239" col1="14" line2="239" col2="20" start="20568" end="20574">cpm_mat</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="239" col1="21" line2="239" col2="21" start="20575" end="20575">)</OP-RIGHT-PAREN>
          </expr>
          <LEFT_ASSIGN line1="239" col1="23" line2="239" col2="24" start="20577" end="20578">&lt;-</LEFT_ASSIGN>
          <expr line1="239" col1="26" line2="239" col2="41" start="20580" end="20595">
            <expr line1="239" col1="26" line2="239" col2="33" start="20580" end="20587">
              <SYMBOL_FUNCTION_CALL line1="239" col1="26" line2="239" col2="33" start="20580" end="20587">rownames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="239" col1="34" line2="239" col2="34" start="20588" end="20588">(</OP-LEFT-PAREN>
            <expr line1="239" col1="35" line2="239" col2="40" start="20589" end="20594">
              <SYMBOL line1="239" col1="35" line2="239" col2="40" start="20589" end="20594">object</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="239" col1="41" line2="239" col2="41" start="20595" end="20595">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="240" col1="5" line2="240" col2="41" start="20645" end="20681">
          <expr line1="240" col1="5" line2="240" col2="21" start="20645" end="20661">
            <expr line1="240" col1="5" line2="240" col2="12" start="20645" end="20652">
              <SYMBOL_FUNCTION_CALL line1="240" col1="5" line2="240" col2="12" start="20645" end="20652">colnames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="240" col1="13" line2="240" col2="13" start="20653" end="20653">(</OP-LEFT-PAREN>
            <expr line1="240" col1="14" line2="240" col2="20" start="20654" end="20660">
              <SYMBOL line1="240" col1="14" line2="240" col2="20" start="20654" end="20660">cpm_mat</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="240" col1="21" line2="240" col2="21" start="20661" end="20661">)</OP-RIGHT-PAREN>
          </expr>
          <LEFT_ASSIGN line1="240" col1="23" line2="240" col2="24" start="20663" end="20664">&lt;-</LEFT_ASSIGN>
          <expr line1="240" col1="26" line2="240" col2="41" start="20666" end="20681">
            <expr line1="240" col1="26" line2="240" col2="33" start="20666" end="20673">
              <SYMBOL_FUNCTION_CALL line1="240" col1="26" line2="240" col2="33" start="20666" end="20673">colnames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="240" col1="34" line2="240" col2="34" start="20674" end="20674">(</OP-LEFT-PAREN>
            <expr line1="240" col1="35" line2="240" col2="40" start="20675" end="20680">
              <SYMBOL line1="240" col1="35" line2="240" col2="40" start="20675" end="20680">object</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="240" col1="41" line2="240" col2="41" start="20681" end="20681">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="241" col1="5" line2="241" col2="19" start="20731" end="20745">
          <expr line1="241" col1="5" line2="241" col2="10" start="20731" end="20736">
            <SYMBOL_FUNCTION_CALL line1="241" col1="5" line2="241" col2="10" start="20731" end="20736">return</SYMBOL_FUNCTION_CALL>
          </expr>
          <OP-LEFT-PAREN line1="241" col1="11" line2="241" col2="11" start="20737" end="20737">(</OP-LEFT-PAREN>
          <expr line1="241" col1="12" line2="241" col2="18" start="20738" end="20744">
            <SYMBOL line1="241" col1="12" line2="241" col2="18" start="20738" end="20744">cpm_mat</SYMBOL>
          </expr>
          <OP-RIGHT-PAREN line1="241" col1="19" line2="241" col2="19" start="20745" end="20745">)</OP-RIGHT-PAREN>
        </expr>
        <OP-RIGHT-BRACE line1="242" col1="1" line2="242" col2="1" start="20813" end="20813">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <COMMENT line1="245" col1="1" line2="245" col2="75" start="21071" end="21145">#' Calculate fragments per kilobase of exon per million reads mapped (FPKM)</COMMENT>
  <COMMENT line1="246" col1="1" line2="246" col2="2" start="21157" end="21158">#'</COMMENT>
  <COMMENT line1="247" col1="1" line2="247" col2="75" start="21243" end="21317">#' Calculate fragments per kilobase of exon per million reads mapped (FPKM)</COMMENT>
  <COMMENT line1="248" col1="1" line2="248" col2="59" start="21329" end="21387">#' values for expression from counts for a set of features.</COMMENT>
  <COMMENT line1="249" col1="1" line2="249" col2="2" start="21415" end="21416">#'</COMMENT>
  <COMMENT line1="250" col1="1" line2="250" col2="54" start="21501" end="21554">#' @param object an \code{SingleCellExperiment} object</COMMENT>
  <COMMENT line1="251" col1="1" line2="251" col2="73" start="21587" end="21659">#' @param effective_length vector of class \code{"numeric"} providing the</COMMENT>
  <COMMENT line1="252" col1="1" line2="252" col2="64" start="21673" end="21736">#' effective length for each feature in the \code{SCESet} object</COMMENT>
  <COMMENT line1="253" col1="1" line2="253" col2="75" start="21759" end="21833">#' @param use.size.factors a logical scalar, see \code{\link{calculateCPM}}</COMMENT>
  <COMMENT line1="254" col1="1" line2="254" col2="2" start="21845" end="21846">#'</COMMENT>
  <COMMENT line1="255" col1="1" line2="255" col2="33" start="21931" end="21963">#' @return Matrix of FPKM values.</COMMENT>
  <COMMENT line1="256" col1="1" line2="256" col2="10" start="22017" end="22026">#' @export</COMMENT>
  <COMMENT line1="257" col1="1" line2="257" col2="12" start="22103" end="22114">#' @examples</COMMENT>
  <COMMENT line1="258" col1="1" line2="258" col2="28" start="22189" end="22216">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="259" col1="1" line2="259" col2="31" start="22275" end="22305">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="260" col1="1" line2="260" col2="39" start="22361" end="22399">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="261" col1="1" line2="261" col2="77" start="22447" end="22523">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="262" col1="1" line2="262" col2="38" start="22533" end="22570">#' effective_length &lt;- rep(1000, 2000)</COMMENT>
  <COMMENT line1="263" col1="1" line2="263" col2="68" start="22619" end="22686">#' fpkm(example_sce) &lt;- calculateFPKM(example_sce, effective_length,</COMMENT>
  <COMMENT line1="264" col1="1" line2="264" col2="28" start="22705" end="22732">#' use.size.factors = FALSE)</COMMENT>
  <COMMENT line1="265" col1="1" line2="265" col2="2" start="22791" end="22792">#'</COMMENT>
  <expr line1="266" col1="1" line2="272" col2="1" start="22877" end="23393">
    <expr line1="266" col1="1" line2="266" col2="13" start="22877" end="22889">
      <SYMBOL line1="266" col1="1" line2="266" col2="13" start="22877" end="22889">calculateFPKM</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="266" col1="15" line2="266" col2="16" start="22891" end="22892">&lt;-</LEFT_ASSIGN>
    <expr line1="266" col1="18" line2="272" col2="1" start="22894" end="23393">
      <FUNCTION line1="266" col1="18" line2="266" col2="25" start="22894" end="22901">function</FUNCTION>
      <OP-LEFT-PAREN line1="266" col1="26" line2="266" col2="26" start="22902" end="22902">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="266" col1="27" line2="266" col2="32" start="22903" end="22908">object</SYMBOL_FORMALS>
      <OP-COMMA line1="266" col1="33" line2="266" col2="33" start="22909" end="22909">,</OP-COMMA>
      <SYMBOL_FORMALS line1="266" col1="35" line2="266" col2="50" start="22911" end="22926">effective_length</SYMBOL_FORMALS>
      <OP-COMMA line1="266" col1="51" line2="266" col2="51" start="22927" end="22927">,</OP-COMMA>
      <SYMBOL_FORMALS line1="266" col1="53" line2="266" col2="68" start="22929" end="22944">use.size.factors</SYMBOL_FORMALS>
      <EQ_FORMALS line1="266" col1="69" line2="266" col2="69" start="22945" end="22945">=</EQ_FORMALS>
      <expr line1="266" col1="70" line2="266" col2="73" start="22946" end="22949">
        <NUM_CONST line1="266" col1="70" line2="266" col2="73" start="22946" end="22949">TRUE</NUM_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="266" col1="74" line2="266" col2="74" start="22950" end="22950">)</OP-RIGHT-PAREN>
      <expr line1="266" col1="76" line2="272" col2="1" start="22952" end="23393">
        <OP-LEFT-BRACE line1="266" col1="76" line2="266" col2="76" start="22952" end="22952">{</OP-LEFT-BRACE>
        <expr line1="267" col1="5" line2="268" col2="54" start="22967" end="23102">
          <IF line1="267" col1="5" line2="267" col2="6" start="22967" end="22968">if</IF>
          <OP-LEFT-PAREN line1="267" col1="8" line2="267" col2="8" start="22970" end="22970">(</OP-LEFT-PAREN>
          <expr line1="267" col1="10" line2="267" col2="53" start="22972" end="23015">
            <OP-EXCLAMATION line1="267" col1="10" line2="267" col2="10" start="22972" end="22972">!</OP-EXCLAMATION>
            <expr line1="267" col1="11" line2="267" col2="53" start="22973" end="23015">
              <expr line1="267" col1="11" line2="267" col2="21" start="22973" end="22983">
                <SYMBOL_PACKAGE line1="267" col1="11" line2="267" col2="17" start="22973" end="22979">methods</SYMBOL_PACKAGE>
                <NS_GET line1="267" col1="18" line2="267" col2="19" start="22980" end="22981">::</NS_GET>
                <SYMBOL_FUNCTION_CALL line1="267" col1="20" line2="267" col2="21" start="22982" end="22983">is</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="267" col1="22" line2="267" col2="22" start="22984" end="22984">(</OP-LEFT-PAREN>
              <expr line1="267" col1="23" line2="267" col2="28" start="22985" end="22990">
                <SYMBOL line1="267" col1="23" line2="267" col2="28" start="22985" end="22990">object</SYMBOL>
              </expr>
              <OP-COMMA line1="267" col1="29" line2="267" col2="29" start="22991" end="22991">,</OP-COMMA>
              <expr line1="267" col1="31" line2="267" col2="52" start="22993" end="23014">
                <STR_CONST line1="267" col1="31" line2="267" col2="52" start="22993" end="23014">"SingleCellExperiment"</STR_CONST>
              </expr>
              <OP-RIGHT-PAREN line1="267" col1="53" line2="267" col2="53" start="23015" end="23015">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="267" col1="55" line2="267" col2="55" start="23017" end="23017">)</OP-RIGHT-PAREN>
          <expr line1="268" col1="9" line2="268" col2="54" start="23057" end="23102">
            <expr line1="268" col1="9" line2="268" col2="12" start="23057" end="23060">
              <SYMBOL_FUNCTION_CALL line1="268" col1="9" line2="268" col2="12" start="23057" end="23060">stop</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="268" col1="13" line2="268" col2="13" start="23061" end="23061">(</OP-LEFT-PAREN>
            <expr line1="268" col1="14" line2="268" col2="53" start="23062" end="23101">
              <STR_CONST line1="268" col1="14" line2="268" col2="53" start="23062" end="23101">"object must be an SingleCellExperiment"</STR_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="268" col1="54" line2="268" col2="54" start="23102" end="23102">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="269" col1="5" line2="269" col2="69" start="23139" end="23203">
          <expr line1="269" col1="5" line2="269" col2="8" start="23139" end="23142">
            <SYMBOL line1="269" col1="5" line2="269" col2="8" start="23139" end="23142">cpms</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="269" col1="10" line2="269" col2="11" start="23144" end="23145">&lt;-</LEFT_ASSIGN>
          <expr line1="269" col1="13" line2="269" col2="69" start="23147" end="23203">
            <expr line1="269" col1="13" line2="269" col2="24" start="23147" end="23158">
              <SYMBOL_FUNCTION_CALL line1="269" col1="13" line2="269" col2="24" start="23147" end="23158">calculateCPM</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="269" col1="25" line2="269" col2="25" start="23159" end="23159">(</OP-LEFT-PAREN>
            <expr line1="269" col1="26" line2="269" col2="31" start="23160" end="23165">
              <SYMBOL line1="269" col1="26" line2="269" col2="31" start="23160" end="23165">object</SYMBOL>
            </expr>
            <OP-COMMA line1="269" col1="32" line2="269" col2="32" start="23166" end="23166">,</OP-COMMA>
            <SYMBOL_SUB line1="269" col1="34" line2="269" col2="49" start="23168" end="23183">use.size.factors</SYMBOL_SUB>
            <EQ_SUB line1="269" col1="51" line2="269" col2="51" start="23185" end="23185">=</EQ_SUB>
            <expr line1="269" col1="53" line2="269" col2="68" start="23187" end="23202">
              <SYMBOL line1="269" col1="53" line2="269" col2="68" start="23187" end="23202">use.size.factors</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="269" col1="69" line2="269" col2="69" start="23203" end="23203">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="270" col1="5" line2="270" col2="46" start="23225" end="23266">
          <expr line1="270" col1="5" line2="270" col2="20" start="23225" end="23240">
            <SYMBOL line1="270" col1="5" line2="270" col2="20" start="23225" end="23240">effective_length</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="270" col1="22" line2="270" col2="23" start="23242" end="23243">&lt;-</LEFT_ASSIGN>
          <expr line1="270" col1="25" line2="270" col2="46" start="23245" end="23266">
            <expr line1="270" col1="25" line2="270" col2="40" start="23245" end="23260">
              <SYMBOL line1="270" col1="25" line2="270" col2="40" start="23245" end="23260">effective_length</SYMBOL>
            </expr>
            <OP-SLASH line1="270" col1="42" line2="270" col2="42" start="23262" end="23262">/</OP-SLASH>
            <expr line1="270" col1="44" line2="270" col2="46" start="23264" end="23266">
              <NUM_CONST line1="270" col1="44" line2="270" col2="46" start="23264" end="23266">1e3</NUM_CONST>
            </expr>
          </expr>
        </expr>
        <expr line1="271" col1="5" line2="271" col2="27" start="23311" end="23333">
          <expr line1="271" col1="5" line2="271" col2="8" start="23311" end="23314">
            <SYMBOL line1="271" col1="5" line2="271" col2="8" start="23311" end="23314">cpms</SYMBOL>
          </expr>
          <OP-SLASH line1="271" col1="10" line2="271" col2="10" start="23316" end="23316">/</OP-SLASH>
          <expr line1="271" col1="12" line2="271" col2="27" start="23318" end="23333">
            <SYMBOL line1="271" col1="12" line2="271" col2="27" start="23318" end="23333">effective_length</SYMBOL>
          </expr>
        </expr>
        <OP-RIGHT-BRACE line1="272" col1="1" line2="272" col2="1" start="23393" end="23393">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
  <COMMENT line1="275" col1="1" line2="275" col2="71" start="23651" end="23721">#' Calculate average counts, adjusting for size factors or library size</COMMENT>
  <COMMENT line1="276" col1="1" line2="276" col2="2" start="23737" end="23738">#'</COMMENT>
  <COMMENT line1="277" col1="1" line2="277" col2="78" start="23823" end="23900">#' Calculate average counts per feature, adjusting them as appropriate to take</COMMENT>
  <COMMENT line1="278" col1="1" line2="278" col2="74" start="23909" end="23982">#' into account for size factors for normalization or library sizes (total</COMMENT>
  <COMMENT line1="279" col1="1" line2="279" col2="11" start="23995" end="24005">#' counts).</COMMENT>
  <COMMENT line1="280" col1="1" line2="280" col2="2" start="24081" end="24082">#'</COMMENT>
  <COMMENT line1="281" col1="1" line2="281" col2="82" start="24167" end="24248">#' @param object a \code{\link{SingleCellExperiment}} object or a matrix of counts</COMMENT>
  <COMMENT line1="282" col1="1" line2="282" col2="81" start="24253" end="24333">#' @param size.factors numeric(), vector of size factors to use to scale library </COMMENT>
  <COMMENT line1="283" col1="1" line2="283" col2="65" start="24339" end="24403">#' size in computation of counts-per-million. Extracted from the </COMMENT>
  <COMMENT line1="284" col1="1" line2="284" col2="85" start="24425" end="24509">#' object if it is a \code{SingleCellExperiment} object; if object is a matrix, then </COMMENT>
  <COMMENT line1="285" col1="1" line2="285" col2="84" start="24511" end="24594">#' if non-NULL, the provided size factors are used. Default is \code{NULL}, in which</COMMENT>
  <COMMENT line1="286" col1="1" line2="286" col2="74" start="24597" end="24670">#' case size factors are all set to 1 (i.e. library size adjustment only).</COMMENT>
  <COMMENT line1="287" col1="1" line2="287" col2="2" start="24683" end="24684">#'</COMMENT>
  <COMMENT line1="288" col1="1" line2="288" col2="81" start="24769" end="24849">#' @return Vector of average count values with same length as number of features.</COMMENT>
  <COMMENT line1="289" col1="1" line2="289" col2="10" start="24855" end="24864">#' @export</COMMENT>
  <COMMENT line1="290" col1="1" line2="290" col2="12" start="24941" end="24952">#' @examples</COMMENT>
  <COMMENT line1="291" col1="1" line2="291" col2="28" start="25027" end="25054">#' data("sc_example_counts")</COMMENT>
  <COMMENT line1="292" col1="1" line2="292" col2="31" start="25113" end="25143">#' data("sc_example_cell_info")</COMMENT>
  <COMMENT line1="293" col1="1" line2="293" col2="39" start="25199" end="25237">#' example_sce &lt;- SingleCellExperiment(</COMMENT>
  <COMMENT line1="294" col1="1" line2="294" col2="77" start="25285" end="25361">#' assays = list(counts = sc_example_counts), colData = sc_example_cell_info)</COMMENT>
  <COMMENT line1="295" col1="1" line2="295" col2="2" start="25371" end="25372">#'</COMMENT>
  <COMMENT line1="296" col1="1" line2="296" col2="30" start="25457" end="25486">#' ## calculate average counts</COMMENT>
  <COMMENT line1="297" col1="1" line2="297" col2="41" start="25543" end="25583">#' ave_counts &lt;- calcAverage(example_sce)</COMMENT>
  <COMMENT line1="298" col1="1" line2="298" col2="2" start="25629" end="25630">#'</COMMENT>
  <expr line1="299" col1="1" line2="326" col2="1" start="25715" end="28037">
    <expr line1="299" col1="1" line2="299" col2="11" start="25715" end="25725">
      <SYMBOL line1="299" col1="1" line2="299" col2="11" start="25715" end="25725">calcAverage</SYMBOL>
    </expr>
    <LEFT_ASSIGN line1="299" col1="13" line2="299" col2="14" start="25727" end="25728">&lt;-</LEFT_ASSIGN>
    <expr line1="299" col1="16" line2="326" col2="1" start="25730" end="28037">
      <FUNCTION line1="299" col1="16" line2="299" col2="23" start="25730" end="25737">function</FUNCTION>
      <OP-LEFT-PAREN line1="299" col1="24" line2="299" col2="24" start="25738" end="25738">(</OP-LEFT-PAREN>
      <SYMBOL_FORMALS line1="299" col1="25" line2="299" col2="30" start="25739" end="25744">object</SYMBOL_FORMALS>
      <OP-COMMA line1="299" col1="31" line2="299" col2="31" start="25745" end="25745">,</OP-COMMA>
      <SYMBOL_FORMALS line1="299" col1="33" line2="299" col2="44" start="25747" end="25758">size.factors</SYMBOL_FORMALS>
      <EQ_FORMALS line1="299" col1="45" line2="299" col2="45" start="25759" end="25759">=</EQ_FORMALS>
      <expr line1="299" col1="46" line2="299" col2="49" start="25760" end="25763">
        <NULL_CONST line1="299" col1="46" line2="299" col2="49" start="25760" end="25763">NULL</NULL_CONST>
      </expr>
      <OP-RIGHT-PAREN line1="299" col1="50" line2="299" col2="50" start="25764" end="25764">)</OP-RIGHT-PAREN>
      <expr line1="299" col1="52" line2="326" col2="1" start="25766" end="28037">
        <OP-LEFT-BRACE line1="299" col1="52" line2="299" col2="52" start="25766" end="25766">{</OP-LEFT-BRACE>
        <expr line1="300" col1="5" line2="308" col2="5" start="25805" end="26493">
          <IF line1="300" col1="5" line2="300" col2="6" start="25805" end="25806">if</IF>
          <OP-LEFT-PAREN line1="300" col1="8" line2="300" col2="8" start="25808" end="25808">(</OP-LEFT-PAREN>
          <expr line1="300" col1="9" line2="300" col2="51" start="25809" end="25851">
            <expr line1="300" col1="9" line2="300" col2="19" start="25809" end="25819">
              <SYMBOL_PACKAGE line1="300" col1="9" line2="300" col2="15" start="25809" end="25815">methods</SYMBOL_PACKAGE>
              <NS_GET line1="300" col1="16" line2="300" col2="17" start="25816" end="25817">::</NS_GET>
              <SYMBOL_FUNCTION_CALL line1="300" col1="18" line2="300" col2="19" start="25818" end="25819">is</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="300" col1="20" line2="300" col2="20" start="25820" end="25820">(</OP-LEFT-PAREN>
            <expr line1="300" col1="21" line2="300" col2="26" start="25821" end="25826">
              <SYMBOL line1="300" col1="21" line2="300" col2="26" start="25821" end="25826">object</SYMBOL>
            </expr>
            <OP-COMMA line1="300" col1="27" line2="300" col2="27" start="25827" end="25827">,</OP-COMMA>
            <expr line1="300" col1="29" line2="300" col2="50" start="25829" end="25850">
              <STR_CONST line1="300" col1="29" line2="300" col2="50" start="25829" end="25850">"SingleCellExperiment"</STR_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="300" col1="51" line2="300" col2="51" start="25851" end="25851">)</OP-RIGHT-PAREN>
          </expr>
          <OP-RIGHT-PAREN line1="300" col1="52" line2="300" col2="52" start="25852" end="25852">)</OP-RIGHT-PAREN>
          <expr line1="300" col1="54" line2="303" col2="5" start="25854" end="26063">
            <OP-LEFT-BRACE line1="300" col1="54" line2="300" col2="54" start="25854" end="25854">{</OP-LEFT-BRACE>
            <expr line1="301" col1="9" line2="301" col2="43" start="25895" end="25929">
              <expr line1="301" col1="9" line2="301" col2="15" start="25895" end="25901">
                <SYMBOL line1="301" col1="9" line2="301" col2="15" start="25895" end="25901">sf.list</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="301" col1="17" line2="301" col2="18" start="25903" end="25904">&lt;-</LEFT_ASSIGN>
              <expr line1="301" col1="20" line2="301" col2="43" start="25906" end="25929">
                <expr line1="301" col1="20" line2="301" col2="35" start="25906" end="25921">
                  <SYMBOL_FUNCTION_CALL line1="301" col1="20" line2="301" col2="35" start="25906" end="25921">.get_all_sf_sets</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="301" col1="36" line2="301" col2="36" start="25922" end="25922">(</OP-LEFT-PAREN>
                <expr line1="301" col1="37" line2="301" col2="42" start="25923" end="25928">
                  <SYMBOL line1="301" col1="37" line2="301" col2="42" start="25923" end="25928">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="301" col1="43" line2="301" col2="43" start="25929" end="25929">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <expr line1="302" col1="9" line2="302" col2="29" start="25981" end="26001">
              <expr line1="302" col1="9" line2="302" col2="11" start="25981" end="25983">
                <SYMBOL line1="302" col1="9" line2="302" col2="11" start="25981" end="25983">mat</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="302" col1="13" line2="302" col2="14" start="25985" end="25986">&lt;-</LEFT_ASSIGN>
              <expr line1="302" col1="16" line2="302" col2="29" start="25988" end="26001">
                <expr line1="302" col1="16" line2="302" col2="21" start="25988" end="25993">
                  <SYMBOL_FUNCTION_CALL line1="302" col1="16" line2="302" col2="21" start="25988" end="25993">counts</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="302" col1="22" line2="302" col2="22" start="25994" end="25994">(</OP-LEFT-PAREN>
                <expr line1="302" col1="23" line2="302" col2="28" start="25995" end="26000">
                  <SYMBOL line1="302" col1="23" line2="302" col2="28" start="25995" end="26000">object</SYMBOL>
                </expr>
                <OP-RIGHT-PAREN line1="302" col1="29" line2="302" col2="29" start="26001" end="26001">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="303" col1="5" line2="303" col2="5" start="26063" end="26063">}</OP-RIGHT-BRACE>
          </expr>
          <ELSE line1="303" col1="7" line2="303" col2="10" start="26065" end="26068">else</ELSE>
          <expr line1="303" col1="12" line2="308" col2="5" start="26070" end="26493">
            <OP-LEFT-BRACE line1="303" col1="12" line2="303" col2="12" start="26070" end="26070">{</OP-LEFT-BRACE>
            <COMMENT line1="304" col1="9" line2="304" col2="58" start="26153" end="26202"># Using the lone set of size factors, if provided.</COMMENT>
            <expr line1="305" col1="9" line2="306" col2="58" start="26239" end="26374">
              <expr line1="305" col1="9" line2="305" col2="15" start="26239" end="26245">
                <SYMBOL line1="305" col1="9" line2="305" col2="15" start="26239" end="26245">sf.list</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="305" col1="17" line2="305" col2="18" start="26247" end="26248">&lt;-</LEFT_ASSIGN>
              <expr line1="305" col1="20" line2="306" col2="58" start="26250" end="26374">
                <expr line1="305" col1="20" line2="305" col2="23" start="26250" end="26253">
                  <SYMBOL_FUNCTION_CALL line1="305" col1="20" line2="305" col2="23" start="26250" end="26253">list</SYMBOL_FUNCTION_CALL>
                </expr>
                <OP-LEFT-PAREN line1="305" col1="24" line2="305" col2="24" start="26254" end="26254">(</OP-LEFT-PAREN>
                <SYMBOL_SUB line1="305" col1="25" line2="305" col2="29" start="26255" end="26259">index</SYMBOL_SUB>
                <EQ_SUB line1="305" col1="31" line2="305" col2="31" start="26261" end="26261">=</EQ_SUB>
                <expr line1="305" col1="33" line2="305" col2="53" start="26263" end="26283">
                  <expr line1="305" col1="33" line2="305" col2="35" start="26263" end="26265">
                    <SYMBOL_FUNCTION_CALL line1="305" col1="33" line2="305" col2="35" start="26263" end="26265">rep</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="305" col1="36" line2="305" col2="36" start="26266" end="26266">(</OP-LEFT-PAREN>
                  <expr line1="305" col1="37" line2="305" col2="38" start="26267" end="26268">
                    <NUM_CONST line1="305" col1="37" line2="305" col2="38" start="26267" end="26268">1L</NUM_CONST>
                  </expr>
                  <OP-COMMA line1="305" col1="39" line2="305" col2="39" start="26269" end="26269">,</OP-COMMA>
                  <expr line1="305" col1="41" line2="305" col2="52" start="26271" end="26282">
                    <expr line1="305" col1="41" line2="305" col2="44" start="26271" end="26274">
                      <SYMBOL_FUNCTION_CALL line1="305" col1="41" line2="305" col2="44" start="26271" end="26274">nrow</SYMBOL_FUNCTION_CALL>
                    </expr>
                    <OP-LEFT-PAREN line1="305" col1="45" line2="305" col2="45" start="26275" end="26275">(</OP-LEFT-PAREN>
                    <expr line1="305" col1="46" line2="305" col2="51" start="26276" end="26281">
                      <SYMBOL line1="305" col1="46" line2="305" col2="51" start="26276" end="26281">object</SYMBOL>
                    </expr>
                    <OP-RIGHT-PAREN line1="305" col1="52" line2="305" col2="52" start="26282" end="26282">)</OP-RIGHT-PAREN>
                  </expr>
                  <OP-RIGHT-PAREN line1="305" col1="53" line2="305" col2="53" start="26283" end="26283">)</OP-RIGHT-PAREN>
                </expr>
                <OP-COMMA line1="305" col1="54" line2="305" col2="54" start="26284" end="26284">,</OP-COMMA>
                <SYMBOL_SUB line1="306" col1="25" line2="306" col2="36" start="26341" end="26352">size.factors</SYMBOL_SUB>
                <EQ_SUB line1="306" col1="38" line2="306" col2="38" start="26354" end="26354">=</EQ_SUB>
                <expr line1="306" col1="40" line2="306" col2="57" start="26356" end="26373">
                  <expr line1="306" col1="40" line2="306" col2="43" start="26356" end="26359">
                    <SYMBOL_FUNCTION_CALL line1="306" col1="40" line2="306" col2="43" start="26356" end="26359">list</SYMBOL_FUNCTION_CALL>
                  </expr>
                  <OP-LEFT-PAREN line1="306" col1="44" line2="306" col2="44" start="26360" end="26360">(</OP-LEFT-PAREN>
                  <expr line1="306" col1="45" line2="306" col2="56" start="26361" end="26372">
                    <SYMBOL line1="306" col1="45" line2="306" col2="56" start="26361" end="26372">size.factors</SYMBOL>
                  </expr>
                  <OP-RIGHT-PAREN line1="306" col1="57" line2="306" col2="57" start="26373" end="26373">)</OP-RIGHT-PAREN>
                </expr>
                <OP-RIGHT-PAREN line1="306" col1="58" line2="306" col2="58" start="26374" end="26374">)</OP-RIGHT-PAREN>
              </expr>
            </expr>
            <expr line1="307" col1="9" line2="307" col2="21" start="26411" end="26423">
              <expr line1="307" col1="9" line2="307" col2="11" start="26411" end="26413">
                <SYMBOL line1="307" col1="9" line2="307" col2="11" start="26411" end="26413">mat</SYMBOL>
              </expr>
              <LEFT_ASSIGN line1="307" col1="13" line2="307" col2="14" start="26415" end="26416">&lt;-</LEFT_ASSIGN>
              <expr line1="307" col1="16" line2="307" col2="21" start="26418" end="26423">
                <SYMBOL line1="307" col1="16" line2="307" col2="21" start="26418" end="26423">object</SYMBOL>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="308" col1="5" line2="308" col2="5" start="26493" end="26493">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <expr line1="310" col1="5" line2="310" col2="65" start="26665" end="26725">
          <expr line1="310" col1="5" line2="310" col2="14" start="26665" end="26674">
            <SYMBOL line1="310" col1="5" line2="310" col2="14" start="26665" end="26674">subset_row</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="310" col1="16" line2="310" col2="17" start="26676" end="26677">&lt;-</LEFT_ASSIGN>
          <expr line1="310" col1="19" line2="310" col2="65" start="26679" end="26725">
            <expr line1="310" col1="19" line2="310" col2="31" start="26679" end="26691">
              <SYMBOL_FUNCTION_CALL line1="310" col1="19" line2="310" col2="31" start="26679" end="26691">.subset2index</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="310" col1="32" line2="310" col2="32" start="26692" end="26692">(</OP-LEFT-PAREN>
            <expr line1="310" col1="33" line2="310" col2="36" start="26693" end="26696">
              <NULL_CONST line1="310" col1="33" line2="310" col2="36" start="26693" end="26696">NULL</NULL_CONST>
            </expr>
            <OP-COMMA line1="310" col1="37" line2="310" col2="37" start="26697" end="26697">,</OP-COMMA>
            <SYMBOL_SUB line1="310" col1="39" line2="310" col2="44" start="26699" end="26704">target</SYMBOL_SUB>
            <EQ_SUB line1="310" col1="46" line2="310" col2="46" start="26706" end="26706">=</EQ_SUB>
            <expr line1="310" col1="48" line2="310" col2="50" start="26708" end="26710">
              <SYMBOL line1="310" col1="48" line2="310" col2="50" start="26708" end="26710">mat</SYMBOL>
            </expr>
            <OP-COMMA line1="310" col1="51" line2="310" col2="51" start="26711" end="26711">,</OP-COMMA>
            <SYMBOL_SUB line1="310" col1="53" line2="310" col2="57" start="26713" end="26717">byrow</SYMBOL_SUB>
            <EQ_SUB line1="310" col1="59" line2="310" col2="59" start="26719" end="26719">=</EQ_SUB>
            <expr line1="310" col1="61" line2="310" col2="64" start="26721" end="26724">
              <NUM_CONST line1="310" col1="61" line2="310" col2="64" start="26721" end="26724">TRUE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="310" col1="65" line2="310" col2="65" start="26725" end="26725">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="311" col1="5" line2="312" col2="49" start="26751" end="26881">
          <expr line1="311" col1="5" line2="311" col2="16" start="26751" end="26762">
            <SYMBOL line1="311" col1="5" line2="311" col2="16" start="26751" end="26762">margin.stats</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="311" col1="18" line2="311" col2="19" start="26764" end="26765">&lt;-</LEFT_ASSIGN>
          <expr line1="311" col1="21" line2="312" col2="49" start="26767" end="26881">
            <expr line1="311" col1="21" line2="311" col2="25" start="26767" end="26771">
              <SYMBOL_FUNCTION_CALL line1="311" col1="21" line2="311" col2="25" start="26767" end="26771">.Call</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="311" col1="26" line2="311" col2="26" start="26772" end="26772">(</OP-LEFT-PAREN>
            <expr line1="311" col1="27" line2="311" col2="44" start="26773" end="26790">
              <SYMBOL line1="311" col1="27" line2="311" col2="44" start="26773" end="26790">cxx_margin_summary</SYMBOL>
            </expr>
            <OP-COMMA line1="311" col1="45" line2="311" col2="45" start="26791" end="26791">,</OP-COMMA>
            <expr line1="311" col1="47" line2="311" col2="49" start="26793" end="26795">
              <SYMBOL line1="311" col1="47" line2="311" col2="49" start="26793" end="26795">mat</SYMBOL>
            </expr>
            <OP-COMMA line1="311" col1="50" line2="311" col2="50" start="26796" end="26796">,</OP-COMMA>
            <expr line1="311" col1="52" line2="311" col2="52" start="26798" end="26798">
              <NUM_CONST line1="311" col1="52" line2="311" col2="52" start="26798" end="26798">0</NUM_CONST>
            </expr>
            <OP-COMMA line1="311" col1="53" line2="311" col2="53" start="26799" end="26799">,</OP-COMMA>
            <expr line1="312" col1="27" line2="312" col2="41" start="26859" end="26873">
              <expr line1="312" col1="27" line2="312" col2="36" start="26859" end="26868">
                <SYMBOL line1="312" col1="27" line2="312" col2="36" start="26859" end="26868">subset_row</SYMBOL>
              </expr>
              <OP-MINUS line1="312" col1="38" line2="312" col2="38" start="26870" end="26870">-</OP-MINUS>
              <expr line1="312" col1="40" line2="312" col2="41" start="26872" end="26873">
                <NUM_CONST line1="312" col1="40" line2="312" col2="41" start="26872" end="26873">1L</NUM_CONST>
              </expr>
            </expr>
            <OP-COMMA line1="312" col1="42" line2="312" col2="42" start="26874" end="26874">,</OP-COMMA>
            <expr line1="312" col1="44" line2="312" col2="48" start="26876" end="26880">
              <NUM_CONST line1="312" col1="44" line2="312" col2="48" start="26876" end="26880">FALSE</NUM_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="312" col1="49" line2="312" col2="49" start="26881" end="26881">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <COMMENT line1="313" col1="5" line2="313" col2="57" start="26923" end="26975"># Set size factors to library sizes if not available.</COMMENT>
        <expr line1="314" col1="5" line2="316" col2="5" start="27009" end="27181">
          <IF line1="314" col1="5" line2="314" col2="6" start="27009" end="27010">if</IF>
          <OP-LEFT-PAREN line1="314" col1="8" line2="314" col2="8" start="27012" end="27012">(</OP-LEFT-PAREN>
          <expr line1="314" col1="9" line2="314" col2="42" start="27013" end="27046">
            <expr line1="314" col1="9" line2="314" col2="15" start="27013" end="27019">
              <SYMBOL_FUNCTION_CALL line1="314" col1="9" line2="314" col2="15" start="27013" end="27019">is.null</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="314" col1="16" line2="314" col2="16" start="27020" end="27020">(</OP-LEFT-PAREN>
            <expr line1="314" col1="17" line2="314" col2="41" start="27021" end="27045">
              <expr line1="314" col1="17" line2="314" col2="36" start="27021" end="27040">
                <expr line1="314" col1="17" line2="314" col2="23" start="27021" end="27027">
                  <SYMBOL line1="314" col1="17" line2="314" col2="23" start="27021" end="27027">sf.list</SYMBOL>
                </expr>
                <OP-DOLLAR line1="314" col1="24" line2="314" col2="24" start="27028" end="27028">$</OP-DOLLAR>
                <SYMBOL line1="314" col1="25" line2="314" col2="36" start="27029" end="27040">size.factors</SYMBOL>
              </expr>
              <LBB line1="314" col1="37" line2="314" col2="38" start="27041" end="27042">[[</LBB>
              <expr line1="314" col1="39" line2="314" col2="39" start="27043" end="27043">
                <NUM_CONST line1="314" col1="39" line2="314" col2="39" start="27043" end="27043">1</NUM_CONST>
              </expr>
              <OP-RIGHT-BRACKET line1="314" col1="40" line2="314" col2="40" start="27044" end="27044">]</OP-RIGHT-BRACKET>
              <OP-RIGHT-BRACKET line1="314" col1="41" line2="314" col2="41" start="27045" end="27045">]</OP-RIGHT-BRACKET>
            </expr>
            <OP-RIGHT-PAREN line1="314" col1="42" line2="314" col2="42" start="27046" end="27046">)</OP-RIGHT-PAREN>
          </expr>
          <OP-RIGHT-PAREN line1="314" col1="43" line2="314" col2="43" start="27047" end="27047">)</OP-RIGHT-PAREN>
          <expr line1="314" col1="45" line2="316" col2="5" start="27049" end="27181">
            <OP-LEFT-BRACE line1="314" col1="45" line2="314" col2="45" start="27049" end="27049">{</OP-LEFT-BRACE>
            <expr line1="315" col1="9" line2="315" col2="54" start="27099" end="27144">
              <expr line1="315" col1="9" line2="315" col2="33" start="27099" end="27123">
                <expr line1="315" col1="9" line2="315" col2="28" start="27099" end="27118">
                  <expr line1="315" col1="9" line2="315" col2="15" start="27099" end="27105">
                    <SYMBOL line1="315" col1="9" line2="315" col2="15" start="27099" end="27105">sf.list</SYMBOL>
                  </expr>
                  <OP-DOLLAR line1="315" col1="16" line2="315" col2="16" start="27106" end="27106">$</OP-DOLLAR>
                  <SYMBOL line1="315" col1="17" line2="315" col2="28" start="27107" end="27118">size.factors</SYMBOL>
                </expr>
                <LBB line1="315" col1="29" line2="315" col2="30" start="27119" end="27120">[[</LBB>
                <expr line1="315" col1="31" line2="315" col2="31" start="27121" end="27121">
                  <NUM_CONST line1="315" col1="31" line2="315" col2="31" start="27121" end="27121">1</NUM_CONST>
                </expr>
                <OP-RIGHT-BRACKET line1="315" col1="32" line2="315" col2="32" start="27122" end="27122">]</OP-RIGHT-BRACKET>
                <OP-RIGHT-BRACKET line1="315" col1="33" line2="315" col2="33" start="27123" end="27123">]</OP-RIGHT-BRACKET>
              </expr>
              <LEFT_ASSIGN line1="315" col1="35" line2="315" col2="36" start="27125" end="27126">&lt;-</LEFT_ASSIGN>
              <expr line1="315" col1="38" line2="315" col2="54" start="27128" end="27144">
                <expr line1="315" col1="38" line2="315" col2="49" start="27128" end="27139">
                  <SYMBOL line1="315" col1="38" line2="315" col2="49" start="27128" end="27139">margin.stats</SYMBOL>
                </expr>
                <LBB line1="315" col1="50" line2="315" col2="51" start="27140" end="27141">[[</LBB>
                <expr line1="315" col1="52" line2="315" col2="52" start="27142" end="27142">
                  <NUM_CONST line1="315" col1="52" line2="315" col2="52" start="27142" end="27142">1</NUM_CONST>
                </expr>
                <OP-RIGHT-BRACKET line1="315" col1="53" line2="315" col2="53" start="27143" end="27143">]</OP-RIGHT-BRACKET>
                <OP-RIGHT-BRACKET line1="315" col1="54" line2="315" col2="54" start="27144" end="27144">]</OP-RIGHT-BRACKET>
              </expr>
            </expr>
            <OP-RIGHT-BRACE line1="316" col1="5" line2="316" col2="5" start="27181" end="27181">}</OP-RIGHT-BRACE>
          </expr>
        </expr>
        <COMMENT line1="318" col1="5" line2="318" col2="77" start="27353" end="27425"># Computes the average count, adjusting for size factors or library size.</COMMENT>
        <expr line1="319" col1="5" line2="322" col2="48" start="27439" end="27740">
          <expr line1="319" col1="5" line2="319" col2="11" start="27439" end="27445">
            <SYMBOL line1="319" col1="5" line2="319" col2="11" start="27439" end="27445">all.ave</SYMBOL>
          </expr>
          <LEFT_ASSIGN line1="319" col1="13" line2="319" col2="14" start="27447" end="27448">&lt;-</LEFT_ASSIGN>
          <expr line1="319" col1="16" line2="322" col2="48" start="27450" end="27740">
            <expr line1="319" col1="16" line2="319" col2="29" start="27450" end="27463">
              <SYMBOL_FUNCTION_CALL line1="319" col1="16" line2="319" col2="29" start="27450" end="27463">.compute_exprs</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="319" col1="30" line2="319" col2="30" start="27464" end="27464">(</OP-LEFT-PAREN>
            <expr line1="319" col1="31" line2="319" col2="33" start="27465" end="27467">
              <SYMBOL line1="319" col1="31" line2="319" col2="33" start="27465" end="27467">mat</SYMBOL>
            </expr>
            <OP-COMMA line1="319" col1="34" line2="319" col2="34" start="27468" end="27468">,</OP-COMMA>
            <expr line1="319" col1="36" line2="319" col2="55" start="27470" end="27489">
              <expr line1="319" col1="36" line2="319" col2="42" start="27470" end="27476">
                <SYMBOL line1="319" col1="36" line2="319" col2="42" start="27470" end="27476">sf.list</SYMBOL>
              </expr>
              <OP-DOLLAR line1="319" col1="43" line2="319" col2="43" start="27477" end="27477">$</OP-DOLLAR>
              <SYMBOL line1="319" col1="44" line2="319" col2="55" start="27478" end="27489">size.factors</SYMBOL>
            </expr>
            <OP-COMMA line1="319" col1="56" line2="319" col2="56" start="27490" end="27490">,</OP-COMMA>
            <SYMBOL_SUB line1="320" col1="31" line2="320" col2="39" start="27551" end="27559">sf_to_use</SYMBOL_SUB>
            <EQ_SUB line1="320" col1="41" line2="320" col2="41" start="27561" end="27561">=</EQ_SUB>
            <expr line1="320" col1="43" line2="320" col2="55" start="27563" end="27575">
              <expr line1="320" col1="43" line2="320" col2="49" start="27563" end="27569">
                <SYMBOL line1="320" col1="43" line2="320" col2="49" start="27563" end="27569">sf.list</SYMBOL>
              </expr>
              <OP-DOLLAR line1="320" col1="50" line2="320" col2="50" start="27570" end="27570">$</OP-DOLLAR>
              <SYMBOL line1="320" col1="51" line2="320" col2="55" start="27571" end="27575">index</SYMBOL>
            </expr>
            <OP-COMMA line1="320" col1="56" line2="320" col2="56" start="27576" end="27576">,</OP-COMMA>
            <SYMBOL_SUB line1="321" col1="31" line2="321" col2="33" start="27637" end="27639">log</SYMBOL_SUB>
            <EQ_SUB line1="321" col1="35" line2="321" col2="35" start="27641" end="27641">=</EQ_SUB>
            <expr line1="321" col1="37" line2="321" col2="41" start="27643" end="27647">
              <NUM_CONST line1="321" col1="37" line2="321" col2="41" start="27643" end="27647">FALSE</NUM_CONST>
            </expr>
            <OP-COMMA line1="321" col1="42" line2="321" col2="42" start="27648" end="27648">,</OP-COMMA>
            <SYMBOL_SUB line1="321" col1="44" line2="321" col2="46" start="27650" end="27652">sum</SYMBOL_SUB>
            <EQ_SUB line1="321" col1="48" line2="321" col2="48" start="27654" end="27654">=</EQ_SUB>
            <expr line1="321" col1="50" line2="321" col2="53" start="27656" end="27659">
              <NUM_CONST line1="321" col1="50" line2="321" col2="53" start="27656" end="27659">TRUE</NUM_CONST>
            </expr>
            <OP-COMMA line1="321" col1="54" line2="321" col2="54" start="27660" end="27660">,</OP-COMMA>
            <SYMBOL_SUB line1="321" col1="56" line2="321" col2="69" start="27662" end="27675">logExprsOffset</SYMBOL_SUB>
            <EQ_SUB line1="321" col1="71" line2="321" col2="71" start="27677" end="27677">=</EQ_SUB>
            <expr line1="321" col1="73" line2="321" col2="73" start="27679" end="27679">
              <NUM_CONST line1="321" col1="73" line2="321" col2="73" start="27679" end="27679">0</NUM_CONST>
            </expr>
            <OP-COMMA line1="321" col1="74" line2="321" col2="74" start="27680" end="27680">,</OP-COMMA>
            <SYMBOL_SUB line1="322" col1="31" line2="322" col2="40" start="27723" end="27732">subset_row</SYMBOL_SUB>
            <EQ_SUB line1="322" col1="42" line2="322" col2="42" start="27734" end="27734">=</EQ_SUB>
            <expr line1="322" col1="44" line2="322" col2="47" start="27736" end="27739">
              <NULL_CONST line1="322" col1="44" line2="322" col2="47" start="27736" end="27739">NULL</NULL_CONST>
            </expr>
            <OP-RIGHT-PAREN line1="322" col1="48" line2="322" col2="48" start="27740" end="27740">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="324" col1="5" line2="324" col2="35" start="27869" end="27899">
          <expr line1="324" col1="5" line2="324" col2="18" start="27869" end="27882">
            <expr line1="324" col1="5" line2="324" col2="9" start="27869" end="27873">
              <SYMBOL_FUNCTION_CALL line1="324" col1="5" line2="324" col2="9" start="27869" end="27873">names</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="324" col1="10" line2="324" col2="10" start="27874" end="27874">(</OP-LEFT-PAREN>
            <expr line1="324" col1="11" line2="324" col2="17" start="27875" end="27881">
              <SYMBOL line1="324" col1="11" line2="324" col2="17" start="27875" end="27881">all.ave</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="324" col1="18" line2="324" col2="18" start="27882" end="27882">)</OP-RIGHT-PAREN>
          </expr>
          <LEFT_ASSIGN line1="324" col1="20" line2="324" col2="21" start="27884" end="27885">&lt;-</LEFT_ASSIGN>
          <expr line1="324" col1="23" line2="324" col2="35" start="27887" end="27899">
            <expr line1="324" col1="23" line2="324" col2="30" start="27887" end="27894">
              <SYMBOL_FUNCTION_CALL line1="324" col1="23" line2="324" col2="30" start="27887" end="27894">rownames</SYMBOL_FUNCTION_CALL>
            </expr>
            <OP-LEFT-PAREN line1="324" col1="31" line2="324" col2="31" start="27895" end="27895">(</OP-LEFT-PAREN>
            <expr line1="324" col1="32" line2="324" col2="34" start="27896" end="27898">
              <SYMBOL line1="324" col1="32" line2="324" col2="34" start="27896" end="27898">mat</SYMBOL>
            </expr>
            <OP-RIGHT-PAREN line1="324" col1="35" line2="324" col2="35" start="27899" end="27899">)</OP-RIGHT-PAREN>
          </expr>
        </expr>
        <expr line1="325" col1="5" line2="325" col2="31" start="27955" end="27981">
          <expr line1="325" col1="5" line2="325" col2="10" start="27955" end="27960">
            <SYMBOL_FUNCTION_CALL line1="325" col1="5" line2="325" col2="10" start="27955" end="27960">return</SYMBOL_FUNCTION_CALL>
          </expr>
          <OP-LEFT-PAREN line1="325" col1="11" line2="325" col2="11" start="27961" end="27961">(</OP-LEFT-PAREN>
          <expr line1="325" col1="12" line2="325" col2="30" start="27962" end="27980">
            <expr line1="325" col1="12" line2="325" col2="18" start="27962" end="27968">
              <SYMBOL line1="325" col1="12" line2="325" col2="18" start="27962" end="27968">all.ave</SYMBOL>
            </expr>
            <OP-SLASH line1="325" col1="20" line2="325" col2="20" start="27970" end="27970">/</OP-SLASH>
            <expr line1="325" col1="22" line2="325" col2="30" start="27972" end="27980">
              <expr line1="325" col1="22" line2="325" col2="25" start="27972" end="27975">
                <SYMBOL_FUNCTION_CALL line1="325" col1="22" line2="325" col2="25" start="27972" end="27975">ncol</SYMBOL_FUNCTION_CALL>
              </expr>
              <OP-LEFT-PAREN line1="325" col1="26" line2="325" col2="26" start="27976" end="27976">(</OP-LEFT-PAREN>
              <expr line1="325" col1="27" line2="325" col2="29" start="27977" end="27979">
                <SYMBOL line1="325" col1="27" line2="325" col2="29" start="27977" end="27979">mat</SYMBOL>
              </expr>
              <OP-RIGHT-PAREN line1="325" col1="30" line2="325" col2="30" start="27980" end="27980">)</OP-RIGHT-PAREN>
            </expr>
          </expr>
          <OP-RIGHT-PAREN line1="325" col1="31" line2="325" col2="31" start="27981" end="27981">)</OP-RIGHT-PAREN>
        </expr>
        <OP-RIGHT-BRACE line1="326" col1="1" line2="326" col2="1" start="28037" end="28037">}</OP-RIGHT-BRACE>
      </expr>
    </expr>
  </expr>
</exprlist>

